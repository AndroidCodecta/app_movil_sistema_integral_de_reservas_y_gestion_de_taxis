Index: lib/Views/Inicio/inicio_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Archivo: 'inicio_page.dart'\r\n\r\nimport 'dart:convert';\r\nimport 'package:flutter/material.dart';\r\nimport 'package:http/http.dart' as http;\r\nimport '../../Utils/session_manager.dart';\r\nimport '../../Utils/reservas_service.dart';\r\n// IMPORTACI칍N CLAVE: Aqu칤 se define la clase ReservaDetalleModel\r\nimport '../Reservas/reservas_detalle.dart';\r\nimport '../Reservas/reservas_page.dart';\r\nimport '../Historial/historial_page.dart';\r\nimport '../widgets/header.dart';\r\nimport '../widgets/bottom_navigation.dart';\r\n\r\n// ======================================================================\r\n// RESERVA CARD\r\n// ======================================================================\r\nclass ReservaCard extends StatelessWidget {\r\n  // CLASE CORREGIDA: Usar el nombre correcto del modelo\r\n  final ReservaDetalleModel reserva;\r\n  final int? reservaId;\r\n  final Map<String, dynamic>? vehiculoData;\r\n\r\n  const ReservaCard({\r\n    super.key,\r\n    required this.reserva,\r\n    this.reservaId,\r\n    this.vehiculoData,\r\n  });\r\n\r\n  Widget _buildInfoRow(String label, String value) {\r\n    return Padding(\r\n      padding: const EdgeInsets.only(bottom: 4),\r\n      child: RichText(\r\n        text: TextSpan(\r\n          style: const TextStyle(fontSize: 12, color: Colors.black87),\r\n          children: [\r\n            TextSpan(\r\n              text: label,\r\n              style: const TextStyle(fontWeight: FontWeight.w600),\r\n            ),\r\n            TextSpan(text: ' ${value.isEmpty ? 'No especificado' : value}'),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    if (reservaId == null) {\r\n      return Container(\r\n        margin: const EdgeInsets.only(bottom: 16),\r\n        padding: const EdgeInsets.all(16),\r\n        decoration: BoxDecoration(\r\n          color: Colors.red[50],\r\n          borderRadius: BorderRadius.circular(8),\r\n        ),\r\n        child: Text(\"Error: ID de reserva faltante para ${reserva.cliente}\"),\r\n      );\r\n    }\r\n\r\n    // Extraer datos del veh칤culo\r\n    final placa = vehiculoData?['placa']?.toString() ?? 'N/A';\r\n    final marca = vehiculoData?['marca']?.toString() ?? 'N/A';\r\n    final modelo = vehiculoData?['a침o_modelo']?.toString() ?? 'N/A';\r\n\r\n    return GestureDetector(\r\n      onTap: () {\r\n        Navigator.push(\r\n          context,\r\n          MaterialPageRoute(\r\n            builder: (context) =>\r\n                ReservaDetalleCompletoScreen(reservaId: reservaId!),\r\n          ),\r\n        );\r\n      },\r\n      child: Container(\r\n        margin: const EdgeInsets.only(bottom: 16),\r\n        decoration: BoxDecoration(\r\n          color: Colors.white,\r\n          borderRadius: BorderRadius.circular(8),\r\n          boxShadow: [\r\n            BoxShadow(\r\n              color: Colors.grey.withOpacity(0.3),\r\n              spreadRadius: 1,\r\n              blurRadius: 3,\r\n              offset: const Offset(0, 2),\r\n            ),\r\n          ],\r\n        ),\r\n        child: Column(\r\n          children: [\r\n            Row(\r\n              children: [\r\n                Expanded(\r\n                  flex: 1,\r\n                  child: Container(\r\n                    padding: const EdgeInsets.symmetric(vertical: 8),\r\n                    decoration: const BoxDecoration(\r\n                      color: Color.fromARGB(255, 255, 214, 10),\r\n                      borderRadius: BorderRadius.only(\r\n                        topLeft: Radius.circular(8),\r\n                        topRight: Radius.circular(8),\r\n                      ),\r\n                    ),\r\n                    child: const Text(\r\n                      'Reserva',\r\n                      textAlign: TextAlign.center,\r\n                      style: TextStyle(\r\n                        color: Colors.black,\r\n                        fontWeight: FontWeight.w600,\r\n                        fontSize: 14,\r\n                      ),\r\n                    ),\r\n                  ),\r\n                ),\r\n              ],\r\n            ),\r\n            // CONTENIDO\r\n            Padding(\r\n              padding: const EdgeInsets.all(16),\r\n              child: Row(\r\n                crossAxisAlignment: CrossAxisAlignment.start,\r\n                children: [\r\n                  const SizedBox(width: 8),\r\n                  Expanded(\r\n                    flex: 1,\r\n                    child: Column(\r\n                      crossAxisAlignment: CrossAxisAlignment.start,\r\n                      children: [\r\n                        _buildInfoRow('Cliente:', reserva.cliente),\r\n                        _buildInfoRow('Fecha:', reserva.fechaReserva),\r\n                        _buildInfoRow('Hora:', reserva.horaRecogida),\r\n                        _buildInfoRow('Encuentro:', reserva.direccionEncuentro),\r\n                      ],\r\n                    ),\r\n                  ),\r\n                ],\r\n              ),\r\n            ),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\n// ======================================================================\r\n// BOT칍N DE ESTADO DEL CHOFER\r\n// ======================================================================\r\nclass EstadoChoferButton extends StatefulWidget {\r\n  const EstadoChoferButton({super.key});\r\n\r\n  @override\r\n  State<EstadoChoferButton> createState() => _EstadoChoferButtonState();\r\n}\r\n\r\nclass _EstadoChoferButtonState extends State<EstadoChoferButton> {\r\n  bool? activo;\r\n  bool _isLoading = false;\r\n  static const String _baseUrl = \"http://servidorcorman.dyndns.org:7019/api\";\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _fetchEstadoActual();\r\n  }\r\n\r\n  // 1. AL ENTRAR: Usa el endpoint NUEVO para obtener el estado actual\r\n  Future<void> _fetchEstadoActual() async {\r\n    if (!mounted) return;\r\n    setState(() => _isLoading = true);\r\n\r\n    final token = await SessionManager.getToken();\r\n    final userId = await SessionManager.getUserId();\r\n\r\n    if (token == null || userId == null) {\r\n      if (mounted) {\r\n        ScaffoldMessenger.of(\r\n          context,\r\n        ).showSnackBar(const SnackBar(content: Text(\"No hay sesi칩n iniciada\")));\r\n        setState(() => _isLoading = false);\r\n      }\r\n      return;\r\n    }\r\n\r\n    final url = Uri.parse(\"$_baseUrl/chofer/estado_actual\");\r\n\r\n    try {\r\n      final response = await http.post(\r\n        url,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": \"Bearer $token\",\r\n        },\r\n        body: jsonEncode({\"id_user\": userId}),\r\n      );\r\n\r\n      if (response.statusCode == 200) {\r\n        final data = jsonDecode(response.body);\r\n        final estado = data[\"data\"]?[\"estado\"];\r\n\r\n        bool esActivo = false;\r\n        if (estado is int) esActivo = estado == 1;\r\n        if (estado is String) esActivo = estado == \"1\";\r\n\r\n        if (mounted) setState(() => activo = esActivo);\r\n      } else {\r\n        print(\"Error al obtener estado actual: ${response.statusCode}\");\r\n      }\r\n    } catch (e) {\r\n      print(\"Excepci칩n fetching estado: $e\");\r\n    } finally {\r\n      if (mounted) setState(() => _isLoading = false);\r\n    }\r\n  }\r\n\r\n  // 2. AL TOCAR: Usa el endpoint ANTERIOR para cambiar el estado\r\n  Future<void> _cambiarEstado() async {\r\n    if (_isLoading) return;\r\n    setState(() => _isLoading = true);\r\n\r\n    final token = await SessionManager.getToken();\r\n    final userId = await SessionManager.getUserId();\r\n\r\n    if (token == null || userId == null) {\r\n      setState(() => _isLoading = false);\r\n      return;\r\n    }\r\n\r\n    final url = Uri.parse(\"$_baseUrl/chofer/estado\");\r\n\r\n    try {\r\n      final response = await http.post(\r\n        url,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          \"Authorization\": \"Bearer $token\",\r\n        },\r\n        body: jsonEncode({\"id_user\": userId}),\r\n      );\r\n\r\n      if (response.statusCode == 200) {\r\n        // 칄xito: Volvemos a consultar el estado real para asegurar sincronizaci칩n\r\n        await _fetchEstadoActual();\r\n\r\n        if (mounted) {\r\n          ScaffoldMessenger.of(context).showSnackBar(\r\n            const SnackBar(content: Text(\"Estado actualizado correctamente\")),\r\n          );\r\n        }\r\n      } else {\r\n        if (mounted) {\r\n          ScaffoldMessenger.of(context).showSnackBar(\r\n            SnackBar(\r\n              content: Text(\r\n                \"Error ${response.statusCode}: no se pudo cambiar estado\",\r\n              ),\r\n            ),\r\n          );\r\n        }\r\n        setState(() => _isLoading = false);\r\n      }\r\n    } catch (e) {\r\n      if (mounted) {\r\n        ScaffoldMessenger.of(\r\n          context,\r\n        ).showSnackBar(SnackBar(content: Text(\"Error de conexi칩n: $e\")));\r\n      }\r\n      setState(() => _isLoading = false);\r\n    }\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    if (_isLoading && activo == null) {\r\n      return const Center(child: CircularProgressIndicator());\r\n    }\r\n\r\n    if (activo == null) {\r\n      return GestureDetector(\r\n        onTap: _fetchEstadoActual,\r\n        child: const Text(\r\n          \"Estado no disponible. Toca para reintentar.\",\r\n          style: TextStyle(color: Colors.red),\r\n        ),\r\n      );\r\n    }\r\n\r\n    return GestureDetector(\r\n      onTap: _cambiarEstado,\r\n      child: AnimatedContainer(\r\n        duration: const Duration(milliseconds: 300),\r\n        curve: Curves.easeInOut,\r\n        width: 200,\r\n        padding: const EdgeInsets.symmetric(vertical: 10),\r\n        decoration: BoxDecoration(\r\n          color: activo == true\r\n              ? const Color.fromARGB(255, 104, 230, 119)\r\n              : Colors.redAccent,\r\n          borderRadius: BorderRadius.circular(8),\r\n        ),\r\n        child: _isLoading\r\n            ? const SizedBox(\r\n                height: 20,\r\n                width: 20,\r\n                child: CircularProgressIndicator(\r\n                  strokeWidth: 2,\r\n                  color: Colors.white,\r\n                ),\r\n              )\r\n            : Text(\r\n                activo == true ? 'Activo' : 'Inactivo',\r\n                textAlign: TextAlign.center,\r\n                style: const TextStyle(\r\n                  color: Colors.black,\r\n                  fontSize: 14,\r\n                  fontWeight: FontWeight.w600,\r\n                ),\r\n              ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\n// ======================================================================\r\n// WIDGET MODIFICADO: StatusButtons con t칤tulo e 칤cono de historial\r\n// ======================================================================\r\nclass StatusButtons extends StatelessWidget {\r\n  const StatusButtons({super.key});\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    // Widget para el t칤tulo de la secci칩n de Estado\r\n    Widget _buildEstadoTitle(String title, {bool isTop = true}) {\r\n      return Container(\r\n        width: double.infinity,\r\n        padding: const EdgeInsets.symmetric(vertical: 12),\r\n        decoration: BoxDecoration(\r\n          color: const Color.fromRGBO(255, 214, 10, 1),\r\n          borderRadius: BorderRadius.only(\r\n            topLeft: isTop ? const Radius.circular(12) : Radius.zero,\r\n            topRight: isTop ? const Radius.circular(12) : Radius.zero,\r\n          ),\r\n        ),\r\n        child: Text(\r\n          title,\r\n          textAlign: TextAlign.center,\r\n          style: const TextStyle(\r\n            color: Colors.black,\r\n            fontSize: 16,\r\n            fontWeight: FontWeight.w600,\r\n          ),\r\n        ),\r\n      );\r\n    }\r\n\r\n    // Widget para \"Resumen de hoy\" con 칤cono de historial\r\n    Widget _buildResumenConHistorial() {\r\n      return Container(\r\n        width: double.infinity,\r\n        padding: const EdgeInsets.symmetric(vertical: 12, horizontal: 16),\r\n        decoration: const BoxDecoration(\r\n          color: Color.fromRGBO(255, 214, 10, 1),\r\n          borderRadius: BorderRadius.only(\r\n            bottomLeft: Radius.circular(12), // Aplicamos el borde inferior aqu칤\r\n            bottomRight: Radius.circular(12),\r\n          ),\r\n        ),\r\n        child: Row(\r\n          mainAxisAlignment: MainAxisAlignment.spaceBetween,\r\n          children: [\r\n            // Espaciador para centrar el t칤tulo (simula el ancho del 칤cono)\r\n            const SizedBox(width: 40),\r\n\r\n            // T칤tulo centrado\r\n            const Expanded(\r\n              child: Text(\r\n                'Resumen de hoy',\r\n                textAlign: TextAlign.center,\r\n                style: TextStyle(\r\n                  color: Colors.black,\r\n                  fontSize: 16,\r\n                  fontWeight: FontWeight.w600,\r\n                ),\r\n              ),\r\n            ),\r\n\r\n            // 칈cono de historial a la derecha\r\n            GestureDetector(\r\n              onTap: () {\r\n                Navigator.push(\r\n                  context,\r\n                  MaterialPageRoute(\r\n                    builder: (context) => const HistorialPage(),\r\n                  ),\r\n                );\r\n              },\r\n              child: Container(\r\n                padding: const EdgeInsets.all(4),\r\n                decoration: BoxDecoration(\r\n                  color: Colors.black.withOpacity(0.1),\r\n                  borderRadius: BorderRadius.circular(6),\r\n                ),\r\n                child: const Icon(\r\n                  Icons.history,\r\n                  color: Colors.black87,\r\n                  size: 24,\r\n                ),\r\n              ),\r\n            ),\r\n          ],\r\n        ),\r\n      );\r\n    }\r\n\r\n    return Column(\r\n      children: [\r\n        // T칤tulo de Estado\r\n        _buildEstadoTitle('Estado', isTop: true),\r\n        const SizedBox(height: 8),\r\n\r\n        // Bot칩n de Estado\r\n        const EstadoChoferButton(),\r\n        const SizedBox(\r\n          height: 16,\r\n        ), // Aumento el espacio para separar visualmente\r\n        // T칤tulo de Resumen con bot칩n de Historial\r\n        _buildResumenConHistorial(),\r\n      ],\r\n    );\r\n  }\r\n}\r\n\r\n// ======================================================================\r\n// PANTALLA PRINCIPAL (HOME)\r\n// ======================================================================\r\n\r\nclass HomeScreen extends StatefulWidget {\r\n  final List reservas;\r\n\r\n  const HomeScreen({super.key, required this.reservas});\r\n\r\n  @override\r\n  State<HomeScreen> createState() => _HomeScreenState();\r\n}\r\n\r\nclass _HomeScreenState extends State<HomeScreen> {\r\n  List<dynamic> _rawReservas = [];\r\n  bool _isLoading = true;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _loadDataFromApiAndPrefs();\r\n  }\r\n\r\n  Future<void> _loadDataFromApiAndPrefs() async {\r\n    if (!mounted) return;\r\n    setState(() => _isLoading = true);\r\n\r\n    List<dynamic> fetchedReservas = [];\r\n\r\n    try {\r\n      // Usamos el servicio espec칤fico para Reservas del D칤a\r\n      fetchedReservas = await ReservasService.fetchReservasDia();\r\n\r\n      // NOTA: No guardamos en cach칠 aqu칤, asumimos que el servicio lo maneja o se guardar치 en otro lado.\r\n    } catch (e) {\r\n      print(\r\n        'Fallo al obtener reservas de la API: $e. Intentando cargar desde cache.',\r\n      );\r\n\r\n      // Si falla la conexi칩n, intentamos cargar las reservas guardadas localmente\r\n      fetchedReservas = await SessionManager.getReservas();\r\n\r\n      if (mounted && fetchedReservas.isEmpty) {\r\n        ScaffoldMessenger.of(context).showSnackBar(\r\n          const SnackBar(\r\n            content: Text(\r\n              'Error de conexi칩n. Mostrando datos antiguos (o ninguno).',\r\n            ),\r\n          ),\r\n        );\r\n      }\r\n    }\r\n\r\n    if (mounted) {\r\n      setState(() {\r\n        _rawReservas = fetchedReservas;\r\n        _isLoading = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  bool get _shouldShowNoReservasMessage {\r\n    return _buildReservaCards().isEmpty;\r\n  }\r\n\r\n  List<Widget> _buildReservaCards() {\r\n    final validReservas = _rawReservas.where((r) {\r\n      return r != null &&\r\n          r is Map &&\r\n          r.isNotEmpty &&\r\n          r['id'] != null &&\r\n          r['cliente'] != null &&\r\n          r['fecha_hora'] != null &&\r\n          r['d_encuentro'] != null;\r\n    }).toList();\r\n\r\n    if (validReservas.isEmpty) {\r\n      return [];\r\n    }\r\n\r\n    return validReservas\r\n        .map((r) {\r\n          final cliente = r[\"cliente\"] ?? {};\r\n          final vehiculo = r[\"vehiculo\"] ?? {};\r\n\r\n          final int? idReserva = r[\"id\"] is int\r\n              ? r[\"id\"]\r\n              : int.tryParse(r[\"id\"]?.toString() ?? '');\r\n\r\n          if (idReserva == null) {\r\n            return Container();\r\n          }\r\n\r\n          // USO CORREGIDO DEL MODELO\r\n          final reserva = ReservaDetalleModel(\r\n            id: idReserva, // El ID se necesita para el constructor del modelo\r\n            cliente: \"${cliente[\"nombres\"] ?? \"\"} ${cliente[\"apellidos\"] ?? \"\"}\"\r\n                .trim(),\r\n            fechaReserva: (r[\"fecha_hora\"] ?? \"\").toString().split(\" \")[0],\r\n            horaRecogida:\r\n                (r[\"fecha_hora\"] ?? \"\").toString().split(\" \").length > 1\r\n                ? (r[\"fecha_hora\"] as String)\r\n                      .split(\" \")[1]\r\n                      .substring(0, 5) // Ajustado para ser seguro\r\n                : \"\",\r\n            direccionEncuentro: r[\"d_encuentro\"] ?? \"\",\r\n            direccionDestino: r[\"d_destino\"] ?? \"\", // Se requiere en el modelo\r\n            placa:\r\n                vehiculo[\"placa\"]?.toString() ??\r\n                \"N/A\", // Se requiere en el modelo\r\n            marca:\r\n                vehiculo[\"marca\"]?.toString() ??\r\n                \"N/A\", // Se requiere en el modelo\r\n            anioModelo:\r\n                vehiculo[\"a침o_modelo\"]?.toString() ??\r\n                \"N/A\", // Se requiere en el modelo\r\n            tiempoEspera:\r\n                r[\"tiempo_espera\"]?.toString() ??\r\n                \"N/A\", // Se requiere en el modelo\r\n          );\r\n\r\n          return ReservaCard(\r\n            key: ValueKey(idReserva),\r\n            reserva: reserva,\r\n            reservaId: idReserva,\r\n          );\r\n        })\r\n        .whereType<ReservaCard>()\r\n        .toList();\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[100],\r\n      body: Column(\r\n        children: [\r\n          const LogoHeader(titulo: 'Inicio', estiloLogin: false),\r\n          Expanded(\r\n            child: _isLoading\r\n                ? const Center(child: CircularProgressIndicator())\r\n                : RefreshIndicator(\r\n                    onRefresh: _loadDataFromApiAndPrefs,\r\n                    child: SingleChildScrollView(\r\n                      padding: const EdgeInsets.all(16.0),\r\n                      physics: const AlwaysScrollableScrollPhysics(),\r\n                      child: Column(\r\n                        children: [\r\n                          const StatusButtons(),\r\n                          const SizedBox(height: 16),\r\n\r\n                          if (_shouldShowNoReservasMessage)\r\n                            Container(\r\n                              padding: const EdgeInsets.all(20),\r\n                              margin: const EdgeInsets.only(bottom: 16),\r\n                              decoration: BoxDecoration(\r\n                                color: Colors.white,\r\n                                borderRadius: BorderRadius.circular(8),\r\n                                boxShadow: [\r\n                                  BoxShadow(\r\n                                    color: Colors.grey.withOpacity(0.2),\r\n                                    spreadRadius: 1,\r\n                                    blurRadius: 3,\r\n                                    offset: const Offset(0, 2),\r\n                                  ),\r\n                                ],\r\n                              ),\r\n                              child: const Center(\r\n                                child: Text(\r\n                                  \"No tienes reservas por el momento \uD83D\uDE97\\nDesliza hacia abajo para buscar nuevas reservas.\",\r\n                                  textAlign: TextAlign.center,\r\n                                  style: TextStyle(\r\n                                    fontSize: 14,\r\n                                    color: Colors.grey,\r\n                                    fontWeight: FontWeight.w500,\r\n                                  ),\r\n                                ),\r\n                              ),\r\n                            )\r\n                          else\r\n                            ..._buildReservaCards(),\r\n                        ],\r\n                      ),\r\n                    ),\r\n                  ),\r\n          ),\r\n        ],\r\n      ),\r\n      bottomNavigationBar: const CustomBottomNavBar(),\r\n    );\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Inicio/inicio_page.dart b/lib/Views/Inicio/inicio_page.dart
--- a/lib/Views/Inicio/inicio_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Inicio/inicio_page.dart	(date 1764211997028)
@@ -1,22 +1,17 @@
-// Archivo: 'inicio_page.dart'
-
 import 'dart:convert';
 import 'package:flutter/material.dart';
 import 'package:http/http.dart' as http;
+import '../Reservas/reservas_detalle.dart';
 import '../../Utils/session_manager.dart';
 import '../../Utils/reservas_service.dart';
-// IMPORTACI칍N CLAVE: Aqu칤 se define la clase ReservaDetalleModel
-import '../Reservas/reservas_detalle.dart';
-import '../Reservas/reservas_page.dart';
 import '../Historial/historial_page.dart';
 import '../widgets/header.dart';
 import '../widgets/bottom_navigation.dart';
 
 // ======================================================================
-// RESERVA CARD
+// WIDGET: ReservaCard (Ahora usa ReservaDetalleModel)
 // ======================================================================
 class ReservaCard extends StatelessWidget {
-  // CLASE CORREGIDA: Usar el nombre correcto del modelo
   final ReservaDetalleModel reserva;
   final int? reservaId;
   final Map<String, dynamic>? vehiculoData;
@@ -60,7 +55,6 @@
       );
     }
 
-    // Extraer datos del veh칤culo
     final placa = vehiculoData?['placa']?.toString() ?? 'N/A';
     final marca = vehiculoData?['marca']?.toString() ?? 'N/A';
     final modelo = vehiculoData?['a침o_modelo']?.toString() ?? 'N/A';
@@ -93,6 +87,27 @@
           children: [
             Row(
               children: [
+                Expanded(
+                  flex: 1,
+                  child: Container(
+                    padding: const EdgeInsets.symmetric(vertical: 8),
+                    decoration: const BoxDecoration(
+                      color: Color(0xFF1C1C1C),
+                      borderRadius: BorderRadius.only(
+                        topLeft: Radius.circular(8),
+                      ),
+                    ),
+                    child: const Text(
+                      'Auto',
+                      textAlign: TextAlign.center,
+                      style: TextStyle(
+                        color: Colors.white,
+                        fontWeight: FontWeight.w600,
+                        fontSize: 14,
+                      ),
+                    ),
+                  ),
+                ),
                 Expanded(
                   flex: 1,
                   child: Container(
@@ -100,7 +115,6 @@
                     decoration: const BoxDecoration(
                       color: Color.fromARGB(255, 255, 214, 10),
                       borderRadius: BorderRadius.only(
-                        topLeft: Radius.circular(8),
                         topRight: Radius.circular(8),
                       ),
                     ),
@@ -117,12 +131,64 @@
                 ),
               ],
             ),
-            // CONTENIDO
             Padding(
               padding: const EdgeInsets.all(16),
               child: Row(
                 crossAxisAlignment: CrossAxisAlignment.start,
                 children: [
+                  Expanded(
+                    flex: 1,
+                    child: Column(
+                      crossAxisAlignment: CrossAxisAlignment.start,
+                      children: [
+                        Container(
+                          width: 60,
+                          height: 40,
+                          decoration: BoxDecoration(
+                            color: Colors.grey[300],
+                            borderRadius: BorderRadius.circular(4),
+                          ),
+                          child: const Icon(
+                            Icons.directions_car,
+                            color: Colors.grey,
+                            size: 24,
+                          ),
+                        ),
+                        const SizedBox(height: 8),
+                        Text(
+                          'Placa: $placa',
+                          style: const TextStyle(
+                            fontSize: 10,
+                            color: Colors.black87,
+                            fontWeight: FontWeight.w600,
+                          ),
+                        ),
+                        Text(
+                          'Marca: $marca',
+                          style: const TextStyle(
+                            fontSize: 10,
+                            color: Colors.black87,
+                          ),
+                        ),
+                        Text(
+                          'Modelo: $modelo',
+                          style: const TextStyle(
+                            fontSize: 10,
+                            color: Colors.black87,
+                          ),
+                        ),
+                        const SizedBox(height: 4),
+                        const Text(
+                          'Toca para ver m치s detalles',
+                          style: TextStyle(
+                            fontSize: 9,
+                            color: Colors.blueGrey,
+                            fontStyle: FontStyle.italic,
+                          ),
+                        ),
+                      ],
+                    ),
+                  ),
                   const SizedBox(width: 8),
                   Expanded(
                     flex: 1,
@@ -147,7 +213,7 @@
 }
 
 // ======================================================================
-// BOT칍N DE ESTADO DEL CHOFER
+// WIDGET: EstadoChoferButton
 // ======================================================================
 class EstadoChoferButton extends StatefulWidget {
   const EstadoChoferButton({super.key});
@@ -159,16 +225,14 @@
 class _EstadoChoferButtonState extends State<EstadoChoferButton> {
   bool? activo;
   bool _isLoading = false;
-  static const String _baseUrl = "http://servidorcorman.dyndns.org:7019/api";
 
   @override
   void initState() {
     super.initState();
-    _fetchEstadoActual();
+    _fetchEstado();
   }
 
-  // 1. AL ENTRAR: Usa el endpoint NUEVO para obtener el estado actual
-  Future<void> _fetchEstadoActual() async {
+  Future<void> _fetchEstado() async {
     if (!mounted) return;
     setState(() => _isLoading = true);
 
@@ -185,7 +249,9 @@
       return;
     }
 
-    final url = Uri.parse("$_baseUrl/chofer/estado_actual");
+    final url = Uri.parse(
+      "http://servidorcorman.dyndns.org:7019/api/chofer/estado",
+    );
 
     try {
       final response = await http.post(
@@ -200,67 +266,19 @@
       if (response.statusCode == 200) {
         final data = jsonDecode(response.body);
         final estado = data["data"]?["estado"];
-
-        bool esActivo = false;
-        if (estado is int) esActivo = estado == 1;
-        if (estado is String) esActivo = estado == "1";
-
-        if (mounted) setState(() => activo = esActivo);
-      } else {
-        print("Error al obtener estado actual: ${response.statusCode}");
-      }
-    } catch (e) {
-      print("Excepci칩n fetching estado: $e");
-    } finally {
-      if (mounted) setState(() => _isLoading = false);
-    }
-  }
-
-  // 2. AL TOCAR: Usa el endpoint ANTERIOR para cambiar el estado
-  Future<void> _cambiarEstado() async {
-    if (_isLoading) return;
-    setState(() => _isLoading = true);
-
-    final token = await SessionManager.getToken();
-    final userId = await SessionManager.getUserId();
-
-    if (token == null || userId == null) {
-      setState(() => _isLoading = false);
-      return;
-    }
-
-    final url = Uri.parse("$_baseUrl/chofer/estado");
-
-    try {
-      final response = await http.post(
-        url,
-        headers: {
-          "Content-Type": "application/json",
-          "Authorization": "Bearer $token",
-        },
-        body: jsonEncode({"id_user": userId}),
-      );
-
-      if (response.statusCode == 200) {
-        // 칄xito: Volvemos a consultar el estado real para asegurar sincronizaci칩n
-        await _fetchEstadoActual();
-
-        if (mounted) {
-          ScaffoldMessenger.of(context).showSnackBar(
-            const SnackBar(content: Text("Estado actualizado correctamente")),
-          );
-        }
+        if (mounted) setState(() => activo = estado == 1);
+      } else if (response.statusCode == 404) {
+        if (mounted) setState(() => activo = false);
       } else {
         if (mounted) {
           ScaffoldMessenger.of(context).showSnackBar(
             SnackBar(
               content: Text(
-                "Error ${response.statusCode}: no se pudo cambiar estado",
+                "Error ${response.statusCode}: no se pudo obtener estado",
               ),
             ),
           );
         }
-        setState(() => _isLoading = false);
       }
     } catch (e) {
       if (mounted) {
@@ -268,28 +286,33 @@
           context,
         ).showSnackBar(SnackBar(content: Text("Error de conexi칩n: $e")));
       }
-      setState(() => _isLoading = false);
+    } finally {
+      if (mounted) setState(() => _isLoading = false);
+    }
+  }
+
+  void _toggleEstado() {
+    if (activo != null) {
+      setState(() {
+        activo = !activo!;
+      });
+      print(
+        'Simulando env칤o de estado a API: ${!activo! ? 'Activo' : 'Inactivo'}',
+      );
     }
   }
 
   @override
   Widget build(BuildContext context) {
-    if (_isLoading && activo == null) {
+    if (_isLoading) {
       return const Center(child: CircularProgressIndicator());
     }
-
     if (activo == null) {
-      return GestureDetector(
-        onTap: _fetchEstadoActual,
-        child: const Text(
-          "Estado no disponible. Toca para reintentar.",
-          style: TextStyle(color: Colors.red),
-        ),
-      );
+      return const Text("Estado no disponible. Intente de nuevo.");
     }
 
     return GestureDetector(
-      onTap: _cambiarEstado,
+      onTap: _toggleEstado,
       child: AnimatedContainer(
         duration: const Duration(milliseconds: 300),
         curve: Curves.easeInOut,
@@ -301,39 +324,29 @@
               : Colors.redAccent,
           borderRadius: BorderRadius.circular(8),
         ),
-        child: _isLoading
-            ? const SizedBox(
-                height: 20,
-                width: 20,
-                child: CircularProgressIndicator(
-                  strokeWidth: 2,
-                  color: Colors.white,
-                ),
-              )
-            : Text(
-                activo == true ? 'Activo' : 'Inactivo',
-                textAlign: TextAlign.center,
-                style: const TextStyle(
-                  color: Colors.black,
-                  fontSize: 14,
-                  fontWeight: FontWeight.w600,
-                ),
-              ),
+        child: Text(
+          activo == true ? 'Activo' : 'Inactivo',
+          textAlign: TextAlign.center,
+          style: const TextStyle(
+            color: Colors.black,
+            fontSize: 14,
+            fontWeight: FontWeight.w600,
+          ),
+        ),
       ),
     );
   }
 }
 
 // ======================================================================
-// WIDGET MODIFICADO: StatusButtons con t칤tulo e 칤cono de historial
+// WIDGET: StatusButtons
 // ======================================================================
 class StatusButtons extends StatelessWidget {
   const StatusButtons({super.key});
 
   @override
   Widget build(BuildContext context) {
-    // Widget para el t칤tulo de la secci칩n de Estado
-    Widget _buildEstadoTitle(String title, {bool isTop = true}) {
+    Widget _buildSectionTitle(String title, {bool isTop = true}) {
       return Container(
         width: double.infinity,
         padding: const EdgeInsets.symmetric(vertical: 12),
@@ -356,7 +369,6 @@
       );
     }
 
-    // Widget para "Resumen de hoy" con 칤cono de historial
     Widget _buildResumenConHistorial() {
       return Container(
         width: double.infinity,
@@ -364,17 +376,14 @@
         decoration: const BoxDecoration(
           color: Color.fromRGBO(255, 214, 10, 1),
           borderRadius: BorderRadius.only(
-            bottomLeft: Radius.circular(12), // Aplicamos el borde inferior aqu칤
-            bottomRight: Radius.circular(12),
+            topLeft: Radius.circular(12),
+            topRight: Radius.circular(12),
           ),
         ),
         child: Row(
           mainAxisAlignment: MainAxisAlignment.spaceBetween,
           children: [
-            // Espaciador para centrar el t칤tulo (simula el ancho del 칤cono)
             const SizedBox(width: 40),
-
-            // T칤tulo centrado
             const Expanded(
               child: Text(
                 'Resumen de hoy',
@@ -386,15 +395,11 @@
                 ),
               ),
             ),
-
-            // 칈cono de historial a la derecha
             GestureDetector(
               onTap: () {
                 Navigator.push(
                   context,
-                  MaterialPageRoute(
-                    builder: (context) => const HistorialPage(),
-                  ),
+                  MaterialPageRoute(builder: (context) => HistorialPage()),
                 );
               },
               child: Container(
@@ -417,16 +422,10 @@
 
     return Column(
       children: [
-        // T칤tulo de Estado
-        _buildEstadoTitle('Estado', isTop: true),
+        _buildSectionTitle('Estado'),
         const SizedBox(height: 8),
-
-        // Bot칩n de Estado
         const EstadoChoferButton(),
-        const SizedBox(
-          height: 16,
-        ), // Aumento el espacio para separar visualmente
-        // T칤tulo de Resumen con bot칩n de Historial
+        const SizedBox(height: 8),
         _buildResumenConHistorial(),
       ],
     );
@@ -434,9 +433,8 @@
 }
 
 // ======================================================================
-// PANTALLA PRINCIPAL (HOME)
+// PANTALLA PRINCIPAL (HomeScreen)
 // ======================================================================
-
 class HomeScreen extends StatefulWidget {
   final List reservas;
 
@@ -463,18 +461,10 @@
     List<dynamic> fetchedReservas = [];
 
     try {
-      // Usamos el servicio espec칤fico para Reservas del D칤a
-      fetchedReservas = await ReservasService.fetchReservasDia();
-
-      // NOTA: No guardamos en cach칠 aqu칤, asumimos que el servicio lo maneja o se guardar치 en otro lado.
+      fetchedReservas = await SessionManager.fetchReservasFromApi();
     } catch (e) {
-      print(
-        'Fallo al obtener reservas de la API: $e. Intentando cargar desde cache.',
-      );
-
-      // Si falla la conexi칩n, intentamos cargar las reservas guardadas localmente
+      print('Fallo API: $e. Intentando cache.');
       fetchedReservas = await SessionManager.getReservas();
-
       if (mounted && fetchedReservas.isEmpty) {
         ScaffoldMessenger.of(context).showSnackBar(
           const SnackBar(
@@ -515,51 +505,42 @@
 
     return validReservas
         .map((r) {
-          final cliente = r["cliente"] ?? {};
-          final vehiculo = r["vehiculo"] ?? {};
+      final cliente = r["cliente"] ?? {};
+      final vehiculo = r["vehiculo"] ?? {};
 
-          final int? idReserva = r["id"] is int
-              ? r["id"]
-              : int.tryParse(r["id"]?.toString() ?? '');
+      final int? idReserva = r["id"] is int
+          ? r["id"]
+          : int.tryParse(r["id"]?.toString() ?? '');
 
-          if (idReserva == null) {
-            return Container();
-          }
+      if (idReserva == null) {
+        return Container();
+      }
 
-          // USO CORREGIDO DEL MODELO
-          final reserva = ReservaDetalleModel(
-            id: idReserva, // El ID se necesita para el constructor del modelo
-            cliente: "${cliente["nombres"] ?? ""} ${cliente["apellidos"] ?? ""}"
-                .trim(),
-            fechaReserva: (r["fecha_hora"] ?? "").toString().split(" ")[0],
-            horaRecogida:
-                (r["fecha_hora"] ?? "").toString().split(" ").length > 1
-                ? (r["fecha_hora"] as String)
-                      .split(" ")[1]
-                      .substring(0, 5) // Ajustado para ser seguro
-                : "",
-            direccionEncuentro: r["d_encuentro"] ?? "",
-            direccionDestino: r["d_destino"] ?? "", // Se requiere en el modelo
-            placa:
-                vehiculo["placa"]?.toString() ??
-                "N/A", // Se requiere en el modelo
-            marca:
-                vehiculo["marca"]?.toString() ??
-                "N/A", // Se requiere en el modelo
-            anioModelo:
-                vehiculo["a침o_modelo"]?.toString() ??
-                "N/A", // Se requiere en el modelo
-            tiempoEspera:
-                r["tiempo_espera"]?.toString() ??
-                "N/A", // Se requiere en el modelo
-          );
+      // CREACI칍N CORRECTA DE ReservaDetalleModel
+      // Llenamos con "N/A" o "---" los campos que no tenemos en el resumen
+      final reserva = ReservaDetalleModel(
+        id: idReserva,
+        cliente: "${cliente["nombres"] ?? ""} ${cliente["apellidos"] ?? ""}".trim(),
+        fechaReserva: (r["fecha_hora"] ?? "").toString().split(" ")[0],
+        horaRecogida: (r["fecha_hora"] ?? "").toString().split(" ").length > 1
+            ? r["fecha_hora"].split(" ")[1]
+            : "",
+        // Campos que la API de lista no env칤a pero el modelo requiere:
+        tiempoEspera: "N/A",
+        direccionEncuentro: r["d_encuentro"] ?? "",
+        direccionDestino: "---", // No necesario en la tarjeta
+        placa: vehiculo["placa"]?.toString() ?? "N/A",
+        marca: vehiculo["marca"]?.toString() ?? "N/A",
+        anioModelo: vehiculo["a침o_modelo"]?.toString() ?? "N/A",
+      );
 
-          return ReservaCard(
-            key: ValueKey(idReserva),
-            reserva: reserva,
-            reservaId: idReserva,
-          );
-        })
+      return ReservaCard(
+        key: ValueKey(idReserva),
+        reserva: reserva,
+        reservaId: idReserva,
+        vehiculoData: vehiculo,
+      );
+    })
         .whereType<ReservaCard>()
         .toList();
   }
@@ -575,53 +556,52 @@
             child: _isLoading
                 ? const Center(child: CircularProgressIndicator())
                 : RefreshIndicator(
-                    onRefresh: _loadDataFromApiAndPrefs,
-                    child: SingleChildScrollView(
-                      padding: const EdgeInsets.all(16.0),
-                      physics: const AlwaysScrollableScrollPhysics(),
-                      child: Column(
-                        children: [
-                          const StatusButtons(),
-                          const SizedBox(height: 16),
-
-                          if (_shouldShowNoReservasMessage)
-                            Container(
-                              padding: const EdgeInsets.all(20),
-                              margin: const EdgeInsets.only(bottom: 16),
-                              decoration: BoxDecoration(
-                                color: Colors.white,
-                                borderRadius: BorderRadius.circular(8),
-                                boxShadow: [
-                                  BoxShadow(
-                                    color: Colors.grey.withOpacity(0.2),
-                                    spreadRadius: 1,
-                                    blurRadius: 3,
-                                    offset: const Offset(0, 2),
-                                  ),
-                                ],
-                              ),
-                              child: const Center(
-                                child: Text(
-                                  "No tienes reservas por el momento 游뚱\nDesliza hacia abajo para buscar nuevas reservas.",
-                                  textAlign: TextAlign.center,
-                                  style: TextStyle(
-                                    fontSize: 14,
-                                    color: Colors.grey,
-                                    fontWeight: FontWeight.w500,
-                                  ),
-                                ),
-                              ),
-                            )
-                          else
-                            ..._buildReservaCards(),
-                        ],
-                      ),
-                    ),
-                  ),
+              onRefresh: _loadDataFromApiAndPrefs,
+              child: SingleChildScrollView(
+                padding: const EdgeInsets.all(16.0),
+                physics: const AlwaysScrollableScrollPhysics(),
+                child: Column(
+                  children: [
+                    const StatusButtons(),
+                    const SizedBox(height: 16),
+                    if (_shouldShowNoReservasMessage)
+                      Container(
+                        padding: const EdgeInsets.all(20),
+                        margin: const EdgeInsets.only(bottom: 16),
+                        decoration: BoxDecoration(
+                          color: Colors.white,
+                          borderRadius: BorderRadius.circular(8),
+                          boxShadow: [
+                            BoxShadow(
+                              color: Colors.grey.withOpacity(0.2),
+                              spreadRadius: 1,
+                              blurRadius: 3,
+                              offset: const Offset(0, 2),
+                            ),
+                          ],
+                        ),
+                        child: const Center(
+                          child: Text(
+                            "No tienes reservas por el momento 游뚱\nDesliza hacia abajo para buscar nuevas reservas.",
+                            textAlign: TextAlign.center,
+                            style: TextStyle(
+                              fontSize: 14,
+                              color: Colors.grey,
+                              fontWeight: FontWeight.w500,
+                            ),
+                          ),
+                        ),
+                      )
+                    else
+                      ..._buildReservaCards(),
+                  ],
+                ),
+              ),
+            ),
           ),
         ],
       ),
       bottomNavigationBar: const CustomBottomNavBar(),
     );
   }
-}
+}
\ No newline at end of file
Index: lib/Views/Reservas/reservas_detalle.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Archivo: 'reservas_detalle.dart'\r\n\r\nimport 'package:flutter/material.dart';\r\nimport '/utils/reservas_service.dart'; // 춰USAMOS EL SERVICE CORREGIDO!\r\nimport '../widgets/header.dart';\r\nimport '../widgets/bottom_navigation.dart';\r\nimport '../Maps/maps_page.dart'; // Aseg칰rate de que esta ruta es correcta\r\n\r\n// =================================================================\r\n// CLASE MODELO (ReservaDetalleModel)\r\n// =================================================================\r\nclass ReservaDetalleModel {\r\n  final int id;\r\n  final String cliente;\r\n  final String fechaReserva;\r\n  final String horaRecogida;\r\n  final String tiempoEspera;\r\n  final String direccionEncuentro;\r\n  final String direccionDestino;\r\n\r\n  // Estos campos ahora son m치s tolerantes a la ausencia de datos\r\n  final String placa;\r\n  final String marca;\r\n  final String anioModelo;\r\n\r\n  // ... (Constructor sin cambios)\r\n  ReservaDetalleModel({\r\n    required this.id,\r\n    required this.cliente,\r\n    required this.fechaReserva,\r\n    required this.horaRecogida,\r\n    required this.tiempoEspera,\r\n    required this.direccionEncuentro,\r\n    required this.direccionDestino,\r\n    required this.placa,\r\n    required this.marca,\r\n    required this.anioModelo,\r\n  });\r\n\r\n  // M칠todo de f치brica para crear una instancia desde un mapa JSON (REFORZADO)\r\n  factory ReservaDetalleModel.fromJson(Map<String, dynamic> data) {\r\n    // 1. Manejo del Cliente: Si no es un Mapa<String, dynamic>, usamos un mapa vac칤o.\r\n    final cliente = (data[\"cliente\"] is Map)\r\n        ? data[\"cliente\"] as Map<String, dynamic>\r\n        : <String, dynamic>{};\r\n\r\n    // 2. Manejo del Veh칤culo: Si no es un Mapa<String, dynamic>, usamos un mapa vac칤o.\r\n    // Esto previene el _TypeError si \"vehiculo\" es null o de tipo incorrecto.\r\n    final vehiculo = (data[\"vehiculo\"] is Map)\r\n        ? data[\"vehiculo\"] as Map<String, dynamic>\r\n        : <String, dynamic>{};\r\n\r\n    final fechaHora = data[\"fecha_hora\"]?.toString() ?? \"\";\r\n\r\n    return ReservaDetalleModel(\r\n      id: data[\"id\"] ?? 0,\r\n      cliente: \"${cliente[\"nombres\"] ?? \"\"} ${cliente[\"apellidos\"] ?? \"\"}\"\r\n          .trim(),\r\n      fechaReserva: fechaHora.isNotEmpty ? fechaHora.split(\" \")[0] : \"---\",\r\n      horaRecogida: fechaHora.split(\" \").length > 1\r\n          ? fechaHora.split(\" \")[1].substring(0, 5)\r\n          : \"---\",\r\n      tiempoEspera: data[\"tiempo_espera\"]?.toString() ?? \"N/A\",\r\n      direccionEncuentro: data[\"d_encuentro\"]?.toString() ?? \"N/A\",\r\n      direccionDestino: data[\"d_destino\"]?.toString() ?? \"N/A\",\r\n\r\n      // Detalle del veh칤culo: Si el mapa vehiculo est치 vac칤o, usa N/A.\r\n      placa: vehiculo[\"placa\"]?.toString() ?? \"N/A\",\r\n      marca: vehiculo[\"marca\"]?.toString() ?? \"N/A\",\r\n      anioModelo: vehiculo[\"a침o_modelo\"]?.toString() ?? \"N/A\",\r\n    );\r\n  }\r\n}\r\n\r\n// =================================================================\r\n// PANTALLA DE DETALLE (ReservaDetalleCompletoScreen)\r\n// =================================================================\r\nclass ReservaDetalleCompletoScreen extends StatefulWidget {\r\n  final int reservaId;\r\n  const ReservaDetalleCompletoScreen({super.key, required this.reservaId});\r\n\r\n  @override\r\n  State<ReservaDetalleCompletoScreen> createState() =>\r\n      _ReservaDetalleCompletoScreenState();\r\n}\r\n\r\nclass _ReservaDetalleCompletoScreenState\r\n    extends State<ReservaDetalleCompletoScreen> {\r\n  ReservaDetalleModel? _reservaDetalle;\r\n  bool _isLoading = true;\r\n  String? _errorMessage;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _fetchDetail();\r\n  }\r\n\r\n  // Funci칩n de carga de datos para el detalle\r\n  Future<void> _fetchDetail() async {\r\n    setState(() {\r\n      _isLoading = true;\r\n      _errorMessage = null;\r\n    });\r\n\r\n    final data = await ReservasService.fetchReservaDetalle(widget.reservaId);\r\n\r\n    if (data != null && mounted) {\r\n      try {\r\n        final ReservaDetalleModel reservaCompleta =\r\n            ReservaDetalleModel.fromJson(data);\r\n\r\n        setState(() {\r\n          _reservaDetalle = reservaCompleta;\r\n        });\r\n      } catch (e) {\r\n        debugPrint(\"Error al parsear datos de detalle: $e\");\r\n        setState(() {\r\n          _errorMessage = \"Error al procesar los datos de la reserva.\";\r\n        });\r\n      }\r\n    } else if (mounted) {\r\n      setState(() {\r\n        _errorMessage =\r\n            \"No se pudo cargar el detalle de la reserva ID: ${widget.reservaId}.\";\r\n      });\r\n    }\r\n\r\n    if (mounted) {\r\n      setState(() {\r\n        _isLoading = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  Widget _buildInfoRow(String label, String value) {\r\n    return Padding(\r\n      padding: const EdgeInsets.only(bottom: 8.0),\r\n      child: RichText(\r\n        text: TextSpan(\r\n          style: const TextStyle(fontSize: 14, color: Colors.black87),\r\n          children: [\r\n            TextSpan(\r\n              text: '$label ',\r\n              style: const TextStyle(\r\n                fontWeight: FontWeight.w600,\r\n                color: Colors.black,\r\n              ),\r\n            ),\r\n            TextSpan(\r\n              text: value,\r\n              style: const TextStyle(color: Colors.black54),\r\n            ),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildSectionTitle(String title) {\r\n    return Padding(\r\n      padding: const EdgeInsets.only(bottom: 10, top: 5),\r\n      child: Text(\r\n        title,\r\n        style: const TextStyle(\r\n          fontWeight: FontWeight.bold,\r\n          fontSize: 16,\r\n          color: Color(0xFF1C1C1C),\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  // CONTENEDOR PRINCIPAL: Usa BoxDecoration\r\n  Widget _buildDetailContainer(ReservaDetalleModel reserva) {\r\n    return Container(\r\n      decoration: BoxDecoration(\r\n        color: Colors.white,\r\n        borderRadius: BorderRadius.circular(12),\r\n        boxShadow: [\r\n          BoxShadow(\r\n            color: Colors.grey.withOpacity(0.3),\r\n            spreadRadius: 1,\r\n            blurRadius: 3,\r\n            offset: const Offset(0, 2),\r\n          ),\r\n        ],\r\n      ),\r\n      child: Column(\r\n        crossAxisAlignment: CrossAxisAlignment.start,\r\n        children: [\r\n          // Header principal\r\n          Container(\r\n            width: double.infinity,\r\n            padding: const EdgeInsets.symmetric(vertical: 14),\r\n            decoration: const BoxDecoration(\r\n              color: Color(0xFF1C1C1C),\r\n              borderRadius: BorderRadius.only(\r\n                topLeft: Radius.circular(12),\r\n                topRight: Radius.circular(12),\r\n              ),\r\n            ),\r\n            child: Text(\r\n              'Reserva N춿 ${reserva.id.toString().padLeft(4, '0')}',\r\n              textAlign: TextAlign.center,\r\n              style: const TextStyle(\r\n                color: Colors.white,\r\n                fontWeight: FontWeight.w700,\r\n                fontSize: 18,\r\n              ),\r\n            ),\r\n          ),\r\n          Padding(\r\n            padding: const EdgeInsets.all(20),\r\n            child: Column(\r\n              crossAxisAlignment: CrossAxisAlignment.start,\r\n              children: [\r\n                // 1. Informaci칩n General\r\n                _buildSectionTitle('Informaci칩n de la Reserva'),\r\n                _buildInfoRow('Fecha:', reserva.fechaReserva),\r\n                _buildInfoRow('Hora:', reserva.horaRecogida),\r\n                _buildInfoRow('Tiempo de Espera:', reserva.tiempoEspera),\r\n\r\n                const Divider(height: 30),\r\n\r\n                // 2. Cliente y Ubicaciones\r\n                _buildSectionTitle('Cliente y Ubicaciones'),\r\n                _buildInfoRow('Cliente:', reserva.cliente),\r\n                _buildInfoRow(\r\n                  'Direcci칩n de Encuentro:',\r\n                  reserva.direccionEncuentro,\r\n                ),\r\n                _buildInfoRow(\r\n                  'Direcci칩n de Destino:',\r\n                  reserva.direccionDestino,\r\n                ),\r\n\r\n                const Divider(height: 30),\r\n\r\n                // 3. Auto Asignado\r\n                _buildSectionTitle('Detalles del Veh칤culo'),\r\n                Row(\r\n                  children: [\r\n                    const Icon(\r\n                      Icons.directions_car,\r\n                      color: Color.fromARGB(255, 0, 0, 0),\r\n                      size: 40,\r\n                    ),\r\n                    const SizedBox(width: 16),\r\n                    Column(\r\n                      crossAxisAlignment: CrossAxisAlignment.start,\r\n                      children: [\r\n                        Text(\r\n                          'Placa: ${reserva.placa}',\r\n                          style: const TextStyle(fontWeight: FontWeight.w600),\r\n                        ),\r\n                        Text(\r\n                          'Marca: ${reserva.marca}',\r\n                          style: const TextStyle(color: Colors.black54),\r\n                        ),\r\n                        Text(\r\n                          'Modelo/A침o: ${reserva.anioModelo}',\r\n                          style: const TextStyle(color: Colors.black54),\r\n                        ),\r\n                      ],\r\n                    ),\r\n                  ],\r\n                ),\r\n              ],\r\n            ),\r\n          ),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildActionButton(BuildContext context) {\r\n    return ElevatedButton.icon(\r\n      onPressed: () {\r\n        // Enviar a la pantalla de Mapas\r\n        Navigator.push(\r\n          context,\r\n          MaterialPageRoute(builder: (context) => const MapsScreen()),\r\n        );\r\n      },\r\n      icon: const Icon(Icons.navigation_sharp, size: 28),\r\n      label: const Text(\r\n        'Iniciar Viaje',\r\n        style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),\r\n      ),\r\n      style: ElevatedButton.styleFrom(\r\n        backgroundColor: const Color.fromARGB(255, 0, 0, 0),\r\n        foregroundColor: Colors.white,\r\n        minimumSize: const Size(double.infinity, 55),\r\n        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),\r\n        elevation: 5,\r\n      ),\r\n    );\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[100],\r\n      body: Column(\r\n        children: [\r\n          const LogoHeader(titulo: 'Detalle Reserva', estiloLogin: false),\r\n          Expanded(\r\n            child: _isLoading\r\n                ? const Center(\r\n                    child: CircularProgressIndicator(color: Color(0xFFFFD60A)),\r\n                  )\r\n                : _errorMessage != null\r\n                ? Center(\r\n                    child: Column(\r\n                      mainAxisAlignment: MainAxisAlignment.center,\r\n                      children: [\r\n                        Text(_errorMessage!),\r\n                        const SizedBox(height: 16),\r\n                        ElevatedButton(\r\n                          onPressed: _fetchDetail,\r\n                          child: const Text('Reintentar Carga'),\r\n                        ),\r\n                      ],\r\n                    ),\r\n                  )\r\n                : RefreshIndicator(\r\n                    onRefresh: _fetchDetail,\r\n                    child: SingleChildScrollView(\r\n                      physics: const AlwaysScrollableScrollPhysics(),\r\n                      padding: const EdgeInsets.all(16.0),\r\n                      child: Column(\r\n                        crossAxisAlignment: CrossAxisAlignment.stretch,\r\n                        children: [\r\n                          if (_reservaDetalle != null)\r\n                            _buildDetailContainer(_reservaDetalle!),\r\n                          const SizedBox(height: 20),\r\n                          _buildActionButton(context),\r\n                        ],\r\n                      ),\r\n                    ),\r\n                  ),\r\n          ),\r\n        ],\r\n      ),\r\n      bottomNavigationBar: const CustomBottomNavBar(),\r\n    );\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Reservas/reservas_detalle.dart b/lib/Views/Reservas/reservas_detalle.dart
--- a/lib/Views/Reservas/reservas_detalle.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Reservas/reservas_detalle.dart	(date 1764210933758)
@@ -1,10 +1,9 @@
-// Archivo: 'reservas_detalle.dart'
-
 import 'package:flutter/material.dart';
-import '/utils/reservas_service.dart'; // 춰USAMOS EL SERVICE CORREGIDO!
+// Aseg칰rate de que esta ruta a tu servicio sea correcta:
+import '../../Utils/reservas_service.dart';
 import '../widgets/header.dart';
 import '../widgets/bottom_navigation.dart';
-import '../Maps/maps_page.dart'; // Aseg칰rate de que esta ruta es correcta
+import '../Maps/maps_page.dart';
 
 // =================================================================
 // CLASE MODELO (ReservaDetalleModel)
@@ -18,12 +17,11 @@
   final String direccionEncuentro;
   final String direccionDestino;
 
-  // Estos campos ahora son m치s tolerantes a la ausencia de datos
+  // Campos del veh칤culo
   final String placa;
   final String marca;
   final String anioModelo;
 
-  // ... (Constructor sin cambios)
   ReservaDetalleModel({
     required this.id,
     required this.cliente,
@@ -37,15 +35,12 @@
     required this.anioModelo,
   });
 
-  // M칠todo de f치brica para crear una instancia desde un mapa JSON (REFORZADO)
+  // M칠todo factory robusto
   factory ReservaDetalleModel.fromJson(Map<String, dynamic> data) {
-    // 1. Manejo del Cliente: Si no es un Mapa<String, dynamic>, usamos un mapa vac칤o.
     final cliente = (data["cliente"] is Map)
         ? data["cliente"] as Map<String, dynamic>
         : <String, dynamic>{};
 
-    // 2. Manejo del Veh칤culo: Si no es un Mapa<String, dynamic>, usamos un mapa vac칤o.
-    // Esto previene el _TypeError si "vehiculo" es null o de tipo incorrecto.
     final vehiculo = (data["vehiculo"] is Map)
         ? data["vehiculo"] as Map<String, dynamic>
         : <String, dynamic>{};
@@ -53,9 +48,8 @@
     final fechaHora = data["fecha_hora"]?.toString() ?? "";
 
     return ReservaDetalleModel(
-      id: data["id"] ?? 0,
-      cliente: "${cliente["nombres"] ?? ""} ${cliente["apellidos"] ?? ""}"
-          .trim(),
+      id: data["id"] is int ? data["id"] : int.tryParse(data["id"].toString()) ?? 0,
+      cliente: "${cliente["nombres"] ?? ""} ${cliente["apellidos"] ?? ""}".trim(),
       fechaReserva: fechaHora.isNotEmpty ? fechaHora.split(" ")[0] : "---",
       horaRecogida: fechaHora.split(" ").length > 1
           ? fechaHora.split(" ")[1].substring(0, 5)
@@ -63,8 +57,6 @@
       tiempoEspera: data["tiempo_espera"]?.toString() ?? "N/A",
       direccionEncuentro: data["d_encuentro"]?.toString() ?? "N/A",
       direccionDestino: data["d_destino"]?.toString() ?? "N/A",
-
-      // Detalle del veh칤culo: Si el mapa vehiculo est치 vac칤o, usa N/A.
       placa: vehiculo["placa"]?.toString() ?? "N/A",
       marca: vehiculo["marca"]?.toString() ?? "N/A",
       anioModelo: vehiculo["a침o_modelo"]?.toString() ?? "N/A",
@@ -96,19 +88,19 @@
     _fetchDetail();
   }
 
-  // Funci칩n de carga de datos para el detalle
   Future<void> _fetchDetail() async {
     setState(() {
       _isLoading = true;
       _errorMessage = null;
     });
 
+    // Llama a tu servicio existente
     final data = await ReservasService.fetchReservaDetalle(widget.reservaId);
 
     if (data != null && mounted) {
       try {
         final ReservaDetalleModel reservaCompleta =
-            ReservaDetalleModel.fromJson(data);
+        ReservaDetalleModel.fromJson(data);
 
         setState(() {
           _reservaDetalle = reservaCompleta;
@@ -122,7 +114,7 @@
     } else if (mounted) {
       setState(() {
         _errorMessage =
-            "No se pudo cargar el detalle de la reserva ID: ${widget.reservaId}.";
+        "No se pudo cargar el detalle de la reserva ID: ${widget.reservaId}.";
       });
     }
 
@@ -171,7 +163,6 @@
     );
   }
 
-  // CONTENEDOR PRINCIPAL: Usa BoxDecoration
   Widget _buildDetailContainer(ReservaDetalleModel reserva) {
     return Container(
       decoration: BoxDecoration(
@@ -189,7 +180,6 @@
       child: Column(
         crossAxisAlignment: CrossAxisAlignment.start,
         children: [
-          // Header principal
           Container(
             width: double.infinity,
             padding: const EdgeInsets.symmetric(vertical: 14),
@@ -215,15 +205,11 @@
             child: Column(
               crossAxisAlignment: CrossAxisAlignment.start,
               children: [
-                // 1. Informaci칩n General
                 _buildSectionTitle('Informaci칩n de la Reserva'),
                 _buildInfoRow('Fecha:', reserva.fechaReserva),
                 _buildInfoRow('Hora:', reserva.horaRecogida),
                 _buildInfoRow('Tiempo de Espera:', reserva.tiempoEspera),
-
                 const Divider(height: 30),
-
-                // 2. Cliente y Ubicaciones
                 _buildSectionTitle('Cliente y Ubicaciones'),
                 _buildInfoRow('Cliente:', reserva.cliente),
                 _buildInfoRow(
@@ -234,10 +220,7 @@
                   'Direcci칩n de Destino:',
                   reserva.direccionDestino,
                 ),
-
                 const Divider(height: 30),
-
-                // 3. Auto Asignado
                 _buildSectionTitle('Detalles del Veh칤culo'),
                 Row(
                   children: [
@@ -277,7 +260,6 @@
   Widget _buildActionButton(BuildContext context) {
     return ElevatedButton.icon(
       onPressed: () {
-        // Enviar a la pantalla de Mapas
         Navigator.push(
           context,
           MaterialPageRoute(builder: (context) => const MapsScreen()),
@@ -308,42 +290,42 @@
           Expanded(
             child: _isLoading
                 ? const Center(
-                    child: CircularProgressIndicator(color: Color(0xFFFFD60A)),
-                  )
+              child: CircularProgressIndicator(color: Color(0xFFFFD60A)),
+            )
                 : _errorMessage != null
                 ? Center(
-                    child: Column(
-                      mainAxisAlignment: MainAxisAlignment.center,
-                      children: [
-                        Text(_errorMessage!),
-                        const SizedBox(height: 16),
-                        ElevatedButton(
-                          onPressed: _fetchDetail,
-                          child: const Text('Reintentar Carga'),
-                        ),
-                      ],
-                    ),
-                  )
+              child: Column(
+                mainAxisAlignment: MainAxisAlignment.center,
+                children: [
+                  Text(_errorMessage!),
+                  const SizedBox(height: 16),
+                  ElevatedButton(
+                    onPressed: _fetchDetail,
+                    child: const Text('Reintentar Carga'),
+                  ),
+                ],
+              ),
+            )
                 : RefreshIndicator(
-                    onRefresh: _fetchDetail,
-                    child: SingleChildScrollView(
-                      physics: const AlwaysScrollableScrollPhysics(),
-                      padding: const EdgeInsets.all(16.0),
-                      child: Column(
-                        crossAxisAlignment: CrossAxisAlignment.stretch,
-                        children: [
-                          if (_reservaDetalle != null)
-                            _buildDetailContainer(_reservaDetalle!),
-                          const SizedBox(height: 20),
-                          _buildActionButton(context),
-                        ],
-                      ),
-                    ),
-                  ),
+              onRefresh: _fetchDetail,
+              child: SingleChildScrollView(
+                physics: const AlwaysScrollableScrollPhysics(),
+                padding: const EdgeInsets.all(16.0),
+                child: Column(
+                  crossAxisAlignment: CrossAxisAlignment.stretch,
+                  children: [
+                    if (_reservaDetalle != null)
+                      _buildDetailContainer(_reservaDetalle!),
+                    const SizedBox(height: 20),
+                    _buildActionButton(context),
+                  ],
+                ),
+              ),
+            ),
           ),
         ],
       ),
       bottomNavigationBar: const CustomBottomNavBar(),
     );
   }
-}
+}
\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AndroidLayouts\">\r\n    <shared>\r\n      <config />\r\n    </shared>\r\n  </component>\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"NONE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"965ace54-6646-4649-9de4-8280f33cd901\" name=\"Changes\" comment=\"Cambios en vistas\">\r\n      <change afterPath=\"$PROJECT_DIR$/android/app/src/main/res/xml/network_security_config.xml\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/lib/Views/Viaje/viaje_page.dart\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/lib/utils/reservas_service.dart\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/lib/utils/solicitud_service.dart\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/caches/deviceStreaming.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/caches/deviceStreaming.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/android/app/src/main/AndroidManifest.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/android/app/src/main/AndroidManifest.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/Views/Login/login_page.dart\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/Views/Login/login_page.dart\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/Views/Reservas/reservas_page.dart\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/Views/Reservas/reservas_page.dart\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/Views/Solicitudes/solicitudes_page.dart\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/Views/Solicitudes/solicitudes_page.dart\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/Views/widgets/bottom_navigation.dart\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/Views/widgets/bottom_navigation.dart\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/lib/utils/session_manager.dart\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/lib/utils/session_manager.dart\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"ClangdSettings\">\r\n    <option name=\"formatViaClangd\" value=\"false\" />\r\n  </component>\r\n  <component name=\"FileEditorManager\">\r\n    <leaf>\r\n      <file leaf-file-name=\"main.dart\" pinned=\"false\" current-in-tab=\"true\">\r\n        <entry file=\"file://$PROJECT_DIR$/lib/main.dart\">\r\n          <provider selected=\"true\" editor-type-id=\"text-editor\">\r\n            <state relative-caret-position=\"0\">\r\n              <caret line=\"0\" column=\"0\" lean-forward=\"false\" selection-start-line=\"0\" selection-start-column=\"0\" selection-end-line=\"0\" selection-end-column=\"0\" />\r\n            </state>\r\n          </provider>\r\n        </entry>\r\n      </file>\r\n    </leaf>\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Class\" />\r\n        <option value=\"Dart File\" />\r\n        <option value=\"valueResourceFile\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\r\n      <map>\r\n        <entry key=\"$PROJECT_DIR$\" value=\"develop\" />\r\n      </map>\r\n    </option>\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n    <option name=\"UPDATE_TYPE\" value=\"REBASE\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;samircornejo&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/AndroidCodecta/app_movil_sistema_integral_de_reservas_y_gestion_de_taxis.git&quot;,\r\n    &quot;accountId&quot;: &quot;d3c6b854-f800-4eaa-bcaf-cb14b81e6d34&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 4\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"33Vsae9UkLNFI19VFfuGFabuH9k\" />\r\n  <component name=\"ProjectView\">\r\n    <navigator currentView=\"ProjectPane\" proportions=\"\" version=\"1\" />\r\n    <panes>\r\n      <pane id=\"ProjectPane\">\r\n        <option name=\"show-excluded-files\" value=\"false\" />\r\n      </pane>\r\n    </panes>\r\n  </component>\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\"><![CDATA[{\r\n  \"keyToString\": {\r\n    \"Flutter.main.dart.executor\": \"Run\",\r\n    \"ModuleVcsDetector.initialDetectionPerformed\": \"true\",\r\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\r\n    \"RunOnceActivity.cidr.known.project.marker\": \"true\",\r\n    \"RunOnceActivity.git.unshallow\": \"true\",\r\n    \"RunOnceActivity.readMode.enableVisualFormatting\": \"true\",\r\n    \"cf.first.check.clang-format\": \"false\",\r\n    \"cidr.known.project.marker\": \"true\",\r\n    \"com.google.services.firebase.aqiPopupShown\": \"true\",\r\n    \"dart.analysis.tool.window.visible\": \"false\",\r\n    \"git-widget-placeholder\": \"feature/Map-flow\",\r\n    \"ignore.virus.scanning.warn.message\": \"true\",\r\n    \"io.flutter.reload.alreadyRun\": \"true\",\r\n    \"last_opened_file_path\": \"C:/Users/samir/OneDrive/Escritorio/app_movil_sistema_integral_de_reservas_y_gestion_de_taxis\",\r\n    \"settings.editor.selected.configurable\": \"com.android.studio.ml.bot.mainConfigurable\",\r\n    \"show.migrate.to.gradle.popup\": \"false\"\r\n  }\r\n}]]></component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\samir\\OneDrive\\Escritorio\\app_movil_sistema_integral_de_reservas_y_gestion_de_taxis\\android\\app\\src\\main\\res\\xml\" />\r\n      <recent name=\"C:\\Users\\samir\\OneDrive\\Escritorio\\app_movil_sistema_integral_de_reservas_y_gestion_de_taxis\\android\\app\\src\\main\\res\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"965ace54-6646-4649-9de4-8280f33cd901\" name=\"Changes\" comment=\"\" />\r\n      <created>1759413639179</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1759413639179</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"Cambios en vistas\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1761059389105</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1761059389105</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"2\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"ToolWindowManager\">\r\n    <editor active=\"true\" />\r\n    <layout>\r\n      <window_info id=\"Project\" active=\"false\" anchor=\"left\" auto_hide=\"false\" internal_type=\"DOCKED\" type=\"DOCKED\" visible=\"true\" show_stripe_button=\"true\" weight=\"0.25\" sideWeight=\"0.5\" order=\"0\" side_tool=\"false\" content_ui=\"combo\" />\r\n    </layout>\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"Cambios en vistas\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"Cambios en vistas\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/.idea/workspace.xml	(date 1764209298830)
@@ -9,19 +9,21 @@
     <option name="autoReloadType" value="NONE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="965ace54-6646-4649-9de4-8280f33cd901" name="Changes" comment="Cambios en vistas">
-      <change afterPath="$PROJECT_DIR$/android/app/src/main/res/xml/network_security_config.xml" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/lib/Views/Viaje/viaje_page.dart" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/lib/utils/reservas_service.dart" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/lib/utils/solicitud_service.dart" afterDir="false" />
+    <list default="true" id="965ace54-6646-4649-9de4-8280f33cd901" name="Changes" comment="Se agregaron conexiones api ( Se necesitan ordenar)">
       <change beforePath="$PROJECT_DIR$/.idea/caches/deviceStreaming.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/caches/deviceStreaming.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/libraries/Dart_Packages.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/libraries/Dart_Packages.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/libraries/Flutter_Plugins.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/libraries/Flutter_Plugins.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/misc.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/android/app/src/main/AndroidManifest.xml" beforeDir="false" afterPath="$PROJECT_DIR$/android/app/src/main/AndroidManifest.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/Views/Historial/historial_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Historial/historial_page.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/Views/Inicio/inicio_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Inicio/inicio_page.dart" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/lib/Views/Login/login_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Login/login_page.dart" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/lib/Views/Reservas/reservas_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Reservas/reservas_page.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/Views/Maps/maps_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Maps/maps_page.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/Views/Reservas/reservas_detalle.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Reservas/reservas_detalle.dart" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/lib/Views/Solicitudes/solicitudes_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Solicitudes/solicitudes_page.dart" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/lib/Views/widgets/bottom_navigation.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/widgets/bottom_navigation.dart" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/lib/utils/session_manager.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/utils/session_manager.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/Views/Viaje/viaje_page.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/Views/Viaje/viaje_page.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/utils/reservas_service.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/utils/reservas_service.dart" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/lib/utils/solicitud_service.dart" beforeDir="false" afterPath="$PROJECT_DIR$/lib/utils/solicitud_service.dart" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -48,8 +50,8 @@
     <option name="RECENT_TEMPLATES">
       <list>
         <option value="Class" />
-        <option value="Dart File" />
         <option value="valueResourceFile" />
+        <option value="Dart File" />
       </list>
     </option>
   </component>
@@ -74,10 +76,16 @@
     &quot;accountId&quot;: &quot;d3c6b854-f800-4eaa-bcaf-cb14b81e6d34&quot;
   }
 }</component>
+  <component name="ProblemsViewState">
+    <option name="selectedTabId" value="CurrentFile" />
+  </component>
   <component name="ProjectColorInfo">{
   &quot;associatedIndex&quot;: 4
 }</component>
   <component name="ProjectId" id="33Vsae9UkLNFI19VFfuGFabuH9k" />
+  <component name="ProjectLevelVcsManager">
+    <ConfirmationsSetting value="2" id="Add" />
+  </component>
   <component name="ProjectView">
     <navigator currentView="ProjectPane" proportions="" version="1" />
     <panes>
@@ -90,26 +98,26 @@
     <option name="hideEmptyMiddlePackages" value="true" />
     <option name="showLibraryContents" value="true" />
   </component>
-  <component name="PropertiesComponent"><![CDATA[{
-  "keyToString": {
-    "Flutter.main.dart.executor": "Run",
-    "ModuleVcsDetector.initialDetectionPerformed": "true",
-    "RunOnceActivity.ShowReadmeOnStart": "true",
-    "RunOnceActivity.cidr.known.project.marker": "true",
-    "RunOnceActivity.git.unshallow": "true",
-    "RunOnceActivity.readMode.enableVisualFormatting": "true",
-    "cf.first.check.clang-format": "false",
-    "cidr.known.project.marker": "true",
-    "com.google.services.firebase.aqiPopupShown": "true",
-    "dart.analysis.tool.window.visible": "false",
-    "git-widget-placeholder": "feature/Map-flow",
-    "ignore.virus.scanning.warn.message": "true",
-    "io.flutter.reload.alreadyRun": "true",
-    "last_opened_file_path": "C:/Users/samir/OneDrive/Escritorio/app_movil_sistema_integral_de_reservas_y_gestion_de_taxis",
-    "settings.editor.selected.configurable": "com.android.studio.ml.bot.mainConfigurable",
-    "show.migrate.to.gradle.popup": "false"
+  <component name="PropertiesComponent">{
+  &quot;keyToString&quot;: {
+    &quot;Flutter.main.dart.executor&quot;: &quot;Run&quot;,
+    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.cidr.known.project.marker&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.readMode.enableVisualFormatting&quot;: &quot;true&quot;,
+    &quot;cf.first.check.clang-format&quot;: &quot;false&quot;,
+    &quot;cidr.known.project.marker&quot;: &quot;true&quot;,
+    &quot;com.google.services.firebase.aqiPopupShown&quot;: &quot;true&quot;,
+    &quot;dart.analysis.tool.window.visible&quot;: &quot;false&quot;,
+    &quot;git-widget-placeholder&quot;: &quot;feature/Map-flow&quot;,
+    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,
+    &quot;io.flutter.reload.alreadyRun&quot;: &quot;true&quot;,
+    &quot;last_opened_file_path&quot;: &quot;C:/Users/samir/OneDrive/Escritorio/app_movil_sistema_integral_de_reservas_y_gestion_de_taxis&quot;,
+    &quot;settings.editor.selected.configurable&quot;: &quot;com.android.studio.ml.bot.mainConfigurable&quot;,
+    &quot;show.migrate.to.gradle.popup&quot;: &quot;false&quot;
   }
-}]]></component>
+}</component>
   <component name="RecentsManager">
     <key name="MoveFile.RECENT_KEYS">
       <recent name="C:\Users\samir\OneDrive\Escritorio\app_movil_sistema_integral_de_reservas_y_gestion_de_taxis\android\app\src\main\res\xml" />
Index: lib/Views/Maps/maps_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Archivo: maps_screen.dart\r\nimport 'dart:async';\r\nimport 'package:flutter/material.dart';\r\n// import 'package:workmanager/workmanager.dart'; // Ya no se necesita Workmanager si el c치lculo se hace en SessionManager\r\nimport '../../Utils/session_manager.dart'; // Importa el TripStatus y SessionManager\r\nimport '../widgets/header.dart'; // Asumo que tienes esta ruta\r\nimport '../widgets/bottom_navigation.dart'; // Asumo que tienes esta ruta\r\n\r\n// ==========================================================\r\n// PANTALLA PRINCIPAL\r\n// ==========================================================\r\n\r\nclass TripEvent {\r\n  final TripStatus status;\r\n  final String description;\r\n  DateTime? timestamp;\r\n  TripEvent(this.status, this.description, {this.timestamp});\r\n}\r\n\r\nclass MapsScreen extends StatefulWidget {\r\n  const MapsScreen({super.key});\r\n  @override\r\n  State<MapsScreen> createState() => _MapsScreenState();\r\n}\r\n\r\nclass _MapsScreenState extends State<MapsScreen> with WidgetsBindingObserver {\r\n  late TripStatus _currentStatus;\r\n\r\n  // Los 4 eventos principales despu칠s de ASSIGNED_TO_DRIVER (0)\r\n  final List<TripEvent> _tripTimeline = [\r\n    TripEvent(\r\n      TripStatus.APPROACHING_PICKUP,\r\n      '1. Viajando a Direcci칩n de Recojo (Iniciado)',\r\n    ), // 칈ndice 0\r\n    TripEvent(\r\n      TripStatus.ARRIVED_PICKUP,\r\n      '2. Chofer llega al Punto de Encuentro',\r\n    ), // 칈ndice 1\r\n    TripEvent(\r\n      TripStatus.IN_TRANSIT,\r\n      '3. Inicio de Viaje (con Cliente)',\r\n    ), // 칈ndice 2\r\n    TripEvent(TripStatus.TRIP_FINISHED, '4. Viaje Finalizado'), // 칈ndice 3\r\n  ];\r\n\r\n  Duration _waitDuration = Duration.zero;\r\n  Duration _travelDuration = Duration.zero;\r\n  Timer? _timer;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    WidgetsBinding.instance.addObserver(this);\r\n    _currentStatus = TripStatus.ASSIGNED_TO_DRIVER;\r\n    _initializeTrip();\r\n  }\r\n\r\n  @override\r\n  void didChangeAppLifecycleState(AppLifecycleState state) {\r\n    if (state == AppLifecycleState.resumed) {\r\n      // Si la app vuelve a primer plano, forzamos la lectura de los tiempos\r\n      _updateTimes();\r\n    }\r\n  }\r\n\r\n  Future<void> _initializeTrip() async {\r\n    final isActive = await SessionManager.isTripActive();\r\n\r\n    if (!isActive) {\r\n      // Inicia un nuevo viaje en el estado base ASSIGNED_TO_DRIVER (0)\r\n      await SessionManager.startTrip();\r\n      _currentStatus = TripStatus.ASSIGNED_TO_DRIVER;\r\n    } else {\r\n      _currentStatus = await SessionManager.getCurrentTripPhase();\r\n\r\n      // Recuperar los timestamps para la l칤nea de tiempo.\r\n      final approached = await SessionManager.getTripTime(\r\n        'trip_approach_start_time',\r\n      ); // Nuevo timestamp\r\n      final arrived = await SessionManager.getTripTime('trip_arrived_time');\r\n      final started = await SessionManager.getTripTime(\r\n        'trip_started_transit_time',\r\n      );\r\n      final finished = await SessionManager.getTripTime('trip_finished_time');\r\n\r\n      if (approached != null) _tripTimeline[0].timestamp = approached;\r\n      if (arrived != null) _tripTimeline[1].timestamp = arrived;\r\n      if (started != null) _tripTimeline[2].timestamp = started;\r\n      if (finished != null) _tripTimeline[3].timestamp = finished;\r\n\r\n      // Recuperar contadores al inicio\r\n      _waitDuration = await SessionManager.getWaitPickupDuration();\r\n      _travelDuration = await SessionManager.getTravelDuration();\r\n    }\r\n\r\n    // Timer de 1 segundo para refrescar el UI de los tiempos m치s fluidamente\r\n    _timer = Timer.periodic(const Duration(seconds: 1), (_) => _updateTimes());\r\n    if (mounted) setState(() {});\r\n  }\r\n\r\n  // Corregido: Actualiza los contadores de tiempo en la UI leyendo el c치lculo en vivo\r\n  void _updateTimes() async {\r\n    if (_currentStatus == TripStatus.TRIP_FINISHED) {\r\n      _timer?.cancel();\r\n      return;\r\n    }\r\n\r\n    // Leemos los contadores que SessionManager calcula en vivo usando DateTime.now()\r\n    final wait = await SessionManager.getWaitPickupDuration();\r\n    final travel = await SessionManager.getTravelDuration();\r\n\r\n    if (mounted) {\r\n      setState(() {\r\n        _waitDuration = wait;\r\n        _travelDuration = travel;\r\n      });\r\n    }\r\n  }\r\n\r\n  String _formatDuration(Duration d) {\r\n    final h = d.inHours.toString().padLeft(2, '0');\r\n    final m = (d.inMinutes % 60).toString().padLeft(2, '0');\r\n    final s = (d.inSeconds % 60).toString().padLeft(2, '0');\r\n    return '$h:$m:$s';\r\n  }\r\n\r\n  void _advanceTripStatus() async {\r\n    if (_currentStatus == TripStatus.TRIP_FINISHED) return;\r\n\r\n    final nextIndex = _currentStatus.index + 1;\r\n    if (nextIndex >= TripStatus.values.length) return;\r\n\r\n    final nextStatus = TripStatus.values[nextIndex];\r\n    await SessionManager.updateTripPhase(nextStatus);\r\n\r\n    // Si el estado es APPROACHING_PICKUP o ARRIVED_PICKUP o IN_TRANSIT,\r\n    // el timestamp correspondiente en la l칤nea de tiempo se actualiza.\r\n    if (nextStatus.index > TripStatus.ASSIGNED_TO_DRIVER.index) {\r\n      // El 칤ndice de _tripTimeline es siempre el 칤ndice del enum - 1\r\n      _tripTimeline[nextStatus.index - 1].timestamp =\r\n          await SessionManager.getTripTime(\r\n            nextStatus == TripStatus.APPROACHING_PICKUP\r\n                ? 'trip_approach_start_time'\r\n                : nextStatus == TripStatus.ARRIVED_PICKUP\r\n                ? 'trip_arrived_time'\r\n                : nextStatus == TripStatus.IN_TRANSIT\r\n                ? 'trip_started_transit_time'\r\n                : 'trip_finished_time',\r\n          );\r\n    }\r\n\r\n    setState(() {\r\n      _currentStatus = nextStatus;\r\n      // Forzar la actualizaci칩n inmediata de los contadores con el nuevo tiempo fijo/cero\r\n      _updateTimes();\r\n    });\r\n\r\n    if (nextStatus == TripStatus.TRIP_FINISHED) {\r\n      // Finaliza el viaje\r\n      await SessionManager.endTrip();\r\n      _timer?.cancel();\r\n    }\r\n  }\r\n\r\n  Future<void> _showConfirmationDialog() async {\r\n    if (_currentStatus == TripStatus.TRIP_FINISHED) return;\r\n\r\n    // Define la descripci칩n del PR칍XIMO estado\r\n    String nextDesc = '';\r\n    if (_currentStatus == TripStatus.ASSIGNED_TO_DRIVER) {\r\n      nextDesc = '1. Iniciar Viaje (a Recojo)';\r\n    } else if (_currentStatus == TripStatus.APPROACHING_PICKUP) {\r\n      nextDesc = '2. Chofer llega al Punto de Encuentro';\r\n    } else if (_currentStatus == TripStatus.ARRIVED_PICKUP) {\r\n      nextDesc = '3. Iniciar Viaje con Pasajero (a Destino)';\r\n    } else if (_currentStatus == TripStatus.IN_TRANSIT) {\r\n      nextDesc = '4. Finalizar Viaje';\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    final confirm = await showDialog<bool>(\r\n      context: context,\r\n      barrierDismissible: false,\r\n      builder: (_) => AlertDialog(\r\n        title: const Text('Confirmar Avance'),\r\n        content: Column(\r\n          mainAxisSize: MainAxisSize.min,\r\n          children: [\r\n            const Text('쮼st치s seguro de avanzar al siguiente paso?'),\r\n            const SizedBox(height: 12),\r\n            Text(\r\n              'Pr칩ximo estado: \"$nextDesc\"',\r\n              style: const TextStyle(\r\n                fontWeight: FontWeight.bold,\r\n                color: Colors.blue,\r\n              ),\r\n            ),\r\n            const SizedBox(height: 8),\r\n            const Text('Esta acci칩n no se puede deshacer.'),\r\n          ],\r\n        ),\r\n        actions: [\r\n          TextButton(\r\n            onPressed: () => Navigator.pop(context, false),\r\n            child: const Text('Cancelar'),\r\n          ),\r\n          ElevatedButton(\r\n            onPressed: () => Navigator.pop(context, true),\r\n            style: ElevatedButton.styleFrom(\r\n              backgroundColor: Colors.blue.shade700,\r\n            ),\r\n            child: const Text('Avanzar'),\r\n          ),\r\n        ],\r\n      ),\r\n    );\r\n\r\n    if (confirm == true) _advanceTripStatus();\r\n  }\r\n\r\n  @override\r\n  void dispose() {\r\n    WidgetsBinding.instance.removeObserver(this);\r\n    _timer?.cancel();\r\n    super.dispose();\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[50],\r\n      body: Column(\r\n        children: [\r\n          const LogoHeader(\r\n            titulo: 'Viaje',\r\n            estiloLogin: false,\r\n          ), // Asumo este widget\r\n          Expanded(\r\n            child: SingleChildScrollView(\r\n              padding: const EdgeInsets.all(16.0),\r\n              child: Column(\r\n                crossAxisAlignment: CrossAxisAlignment.stretch,\r\n                children: [\r\n                  _buildStatusCard(),\r\n                  const SizedBox(height: 20),\r\n                  _buildTimeTrackers(),\r\n                  const SizedBox(height: 30),\r\n                  _buildSingleActionButton(),\r\n                  const SizedBox(height: 30),\r\n                  _buildTimeline(),\r\n                ],\r\n              ),\r\n            ),\r\n          ),\r\n        ],\r\n      ),\r\n      bottomNavigationBar: const CustomBottomNavBar(), // Asumo este widget\r\n    );\r\n  }\r\n\r\n  Widget _buildStatusCard() {\r\n    String text = '';\r\n    Color color = Colors.grey.shade600;\r\n\r\n    if (_currentStatus == TripStatus.ASSIGNED_TO_DRIVER) {\r\n      text = 'ASIGNADO - Pendiente de Iniciar Viaje';\r\n      color = Colors.grey.shade600;\r\n    } else if (_currentStatus == TripStatus.APPROACHING_PICKUP) {\r\n      text = 'EN RUTA - Viajando a la direcci칩n de recojo';\r\n      color = Colors.blue.shade800;\r\n    } else if (_currentStatus == TripStatus.ARRIVED_PICKUP) {\r\n      text = 'ESPERA - Esperando al pasajero en el punto de encuentro';\r\n      color = Colors.orange.shade800;\r\n    } else if (_currentStatus == TripStatus.IN_TRANSIT) {\r\n      text = 'EN VIAJE - Llevando al pasajero al destino';\r\n      color = Colors.green.shade800;\r\n    } else if (_currentStatus == TripStatus.TRIP_FINISHED) {\r\n      text = 'VIAJE FINALIZADO CON 칄XITO';\r\n      color = Colors.purple.shade800;\r\n    }\r\n\r\n    return Container(\r\n      padding: const EdgeInsets.all(16),\r\n      decoration: BoxDecoration(\r\n        color: Colors.white,\r\n        borderRadius: BorderRadius.circular(12),\r\n        boxShadow: [\r\n          BoxShadow(\r\n            color: color.withOpacity(0.1),\r\n            blurRadius: 10,\r\n            offset: const Offset(0, 5),\r\n          ),\r\n        ],\r\n        border: Border.all(color: color.withOpacity(0.5), width: 2),\r\n      ),\r\n      child: Column(\r\n        crossAxisAlignment: CrossAxisAlignment.start,\r\n        children: [\r\n          const Text(\r\n            'ESTADO ACTUAL:',\r\n            style: TextStyle(\r\n              fontSize: 14,\r\n              fontWeight: FontWeight.bold,\r\n              color: Colors.grey,\r\n            ),\r\n          ),\r\n          const SizedBox(height: 4),\r\n          Text(\r\n            text,\r\n            style: TextStyle(\r\n              fontSize: 18,\r\n              fontWeight: FontWeight.bold,\r\n              color: color,\r\n            ),\r\n          ),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildTimeTrackers() => Column(\r\n    children: [\r\n      // Contador de Espera (Amarillo)\r\n      _timeDisplay(\r\n        'Tiempo de Espera (al pasajero)',\r\n        _formatDuration(_waitDuration),\r\n        Colors.orange.shade100,\r\n        Colors.orange.shade800,\r\n      ),\r\n      const SizedBox(height: 10),\r\n      // Contador de Viaje (Verde)\r\n      _timeDisplay(\r\n        'Tiempo de Recorrido',\r\n        _formatDuration(_travelDuration),\r\n        Colors.green.shade100,\r\n        Colors.green.shade800,\r\n      ),\r\n    ],\r\n  );\r\n\r\n  Widget _timeDisplay(String title, String time, Color bg, Color fg) =>\r\n      Container(\r\n        padding: const EdgeInsets.symmetric(vertical: 12, horizontal: 16),\r\n        decoration: BoxDecoration(\r\n          color: bg,\r\n          borderRadius: BorderRadius.circular(8),\r\n        ),\r\n        child: Row(\r\n          mainAxisAlignment: MainAxisAlignment.spaceBetween,\r\n          children: [\r\n            Text(\r\n              title,\r\n              style: TextStyle(fontWeight: FontWeight.w600, color: fg),\r\n            ),\r\n            Text(\r\n              time,\r\n              style: TextStyle(\r\n                fontSize: 20,\r\n                fontWeight: FontWeight.bold,\r\n                color: fg,\r\n                fontFamily: 'RobotoMono',\r\n              ),\r\n            ),\r\n          ],\r\n        ),\r\n      );\r\n\r\n  Widget _buildSingleActionButton() {\r\n    final texts = {\r\n      TripStatus.ASSIGNED_TO_DRIVER: '1. Iniciar Viaje (a Recojo)',\r\n      TripStatus.APPROACHING_PICKUP: '2. Chofer llega al Punto de Encuentro',\r\n      TripStatus.ARRIVED_PICKUP: '3. Iniciar Viaje con Pasajero (a Destino)',\r\n      TripStatus.IN_TRANSIT: '4. Finalizar Viaje',\r\n      TripStatus.TRIP_FINISHED: 'VIAJE FINALIZADO',\r\n    };\r\n\r\n    final colors = {\r\n      TripStatus.ASSIGNED_TO_DRIVER: Colors.blue.shade700,\r\n      TripStatus.APPROACHING_PICKUP: Colors.orange.shade700,\r\n      TripStatus.ARRIVED_PICKUP: Colors.green.shade700,\r\n      TripStatus.IN_TRANSIT: Colors.purple.shade700,\r\n      TripStatus.TRIP_FINISHED: Colors.grey,\r\n    };\r\n\r\n    return ElevatedButton(\r\n      onPressed: _currentStatus == TripStatus.TRIP_FINISHED\r\n          ? null\r\n          : _showConfirmationDialog,\r\n      style: ElevatedButton.styleFrom(\r\n        minimumSize: const Size(double.infinity, 55),\r\n        backgroundColor: colors[_currentStatus],\r\n        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),\r\n      ),\r\n      child: Text(\r\n        texts[_currentStatus]!,\r\n        style: const TextStyle(\r\n          fontSize: 18,\r\n          fontWeight: FontWeight.bold,\r\n          color: Colors.white,\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildTimeline() {\r\n    return Container(\r\n      decoration: BoxDecoration(\r\n        color: Colors.white,\r\n        borderRadius: BorderRadius.circular(12),\r\n        border: Border.all(color: Colors.grey.shade200),\r\n      ),\r\n      padding: const EdgeInsets.all(16),\r\n      child: Column(\r\n        crossAxisAlignment: CrossAxisAlignment.start,\r\n        children: [\r\n          const Text(\r\n            'HISTORIAL DE VIAJE:',\r\n            style: TextStyle(\r\n              fontSize: 16,\r\n              fontWeight: FontWeight.bold,\r\n              color: Colors.black87,\r\n            ),\r\n          ),\r\n          const SizedBox(height: 10),\r\n          ..._tripTimeline.map((event) {\r\n            final completed = event.timestamp != null;\r\n            final isActive = _currentStatus == event.status;\r\n\r\n            Color iconColor;\r\n            IconData iconData;\r\n\r\n            if (completed) {\r\n              iconColor = Colors.green.shade700;\r\n              iconData = Icons.check_circle;\r\n            } else if (isActive) {\r\n              iconColor = Colors.orange.shade500;\r\n              iconData = Icons.adjust;\r\n            } else {\r\n              iconColor = Colors.grey.shade400;\r\n              iconData = Icons.radio_button_off;\r\n            }\r\n\r\n            return Column(\r\n              children: [\r\n                Row(\r\n                  children: [\r\n                    Container(\r\n                      width: 30,\r\n                      alignment: Alignment.center,\r\n                      child: Icon(iconData, color: iconColor, size: 20),\r\n                    ),\r\n                    const SizedBox(width: 8),\r\n                    Expanded(\r\n                      child: Column(\r\n                        crossAxisAlignment: CrossAxisAlignment.start,\r\n                        children: [\r\n                          Text(\r\n                            event.description,\r\n                            style: TextStyle(\r\n                              fontWeight: completed || isActive\r\n                                  ? FontWeight.bold\r\n                                  : FontWeight.normal,\r\n                              color: completed || isActive\r\n                                  ? Colors.black87\r\n                                  : Colors.grey.shade600,\r\n                            ),\r\n                          ),\r\n                          Text(\r\n                            completed\r\n                                ? 'Hora: ${event.timestamp!.toString().substring(11, 19)}'\r\n                                : isActive\r\n                                ? 'EN CURSO (Estado Actual)'\r\n                                : 'Pendiente',\r\n                            style: TextStyle(\r\n                              fontSize: 12,\r\n                              color: completed ? Colors.grey : iconColor,\r\n                              fontWeight: isActive\r\n                                  ? FontWeight.bold\r\n                                  : FontWeight.normal,\r\n                            ),\r\n                          ),\r\n                        ],\r\n                      ),\r\n                    ),\r\n                  ],\r\n                ),\r\n                if (event != _tripTimeline.last)\r\n                  _buildTimelineConnector(completed),\r\n              ],\r\n            );\r\n          }).toList(),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildTimelineConnector(bool completed) => Row(\r\n    children: [\r\n      Container(\r\n        width: 30,\r\n        alignment: Alignment.center,\r\n        child: Container(\r\n          margin: const EdgeInsets.symmetric(vertical: 4),\r\n          height: 25,\r\n          width: 2,\r\n          color: completed ? Colors.green.shade200 : Colors.grey.shade200,\r\n        ),\r\n      ),\r\n      const SizedBox(width: 8),\r\n      const Expanded(child: SizedBox.shrink()),\r\n    ],\r\n  );\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Maps/maps_page.dart b/lib/Views/Maps/maps_page.dart
--- a/lib/Views/Maps/maps_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Maps/maps_page.dart	(date 1764209271592)
@@ -1,48 +1,50 @@
-// Archivo: maps_screen.dart
 import 'dart:async';
 import 'package:flutter/material.dart';
-// import 'package:workmanager/workmanager.dart'; // Ya no se necesita Workmanager si el c치lculo se hace en SessionManager
-import '../../Utils/session_manager.dart'; // Importa el TripStatus y SessionManager
-import '../widgets/header.dart'; // Asumo que tienes esta ruta
-import '../widgets/bottom_navigation.dart'; // Asumo que tienes esta ruta
+// Dependencias de widgets externos, seg칰n la estructura de tu proyecto:
+import '../widgets/header.dart';
+import '../widgets/bottom_navigation.dart';
 
 // ==========================================================
-// PANTALLA PRINCIPAL
+// P츼GINA PRINCIPAL DE MAPAS
 // ==========================================================
 
+// Enum para manejar el estado del viaje
+enum TripStatus {
+  WAITING_INITIAL, // 0: Esperando en la ubicaci칩n inicial del conductor
+  ARRIVED_PICKUP, // 1: Conductor ha llegado al punto de encuentro
+  IN_TRANSIT, // 2: Viaje hacia el destino final iniciado
+  TRIP_FINISHED, // 3: Viaje completado
+}
+
+// Clase para representar un evento en la l칤nea de tiempo
 class TripEvent {
   final TripStatus status;
   final String description;
   DateTime? timestamp;
+
   TripEvent(this.status, this.description, {this.timestamp});
 }
 
 class MapsScreen extends StatefulWidget {
   const MapsScreen({super.key});
+
   @override
   State<MapsScreen> createState() => _MapsScreenState();
 }
 
-class _MapsScreenState extends State<MapsScreen> with WidgetsBindingObserver {
-  late TripStatus _currentStatus;
+class _MapsScreenState extends State<MapsScreen> {
+  TripStatus _currentStatus = TripStatus.WAITING_INITIAL;
 
-  // Los 4 eventos principales despu칠s de ASSIGNED_TO_DRIVER (0)
+  // Lista de eventos para la l칤nea de tiempo
   final List<TripEvent> _tripTimeline = [
-    TripEvent(
-      TripStatus.APPROACHING_PICKUP,
-      '1. Viajando a Direcci칩n de Recojo (Iniciado)',
-    ), // 칈ndice 0
-    TripEvent(
-      TripStatus.ARRIVED_PICKUP,
-      '2. Chofer llega al Punto de Encuentro',
-    ), // 칈ndice 1
-    TripEvent(
-      TripStatus.IN_TRANSIT,
-      '3. Inicio de Viaje (con Cliente)',
-    ), // 칈ndice 2
-    TripEvent(TripStatus.TRIP_FINISHED, '4. Viaje Finalizado'), // 칈ndice 3
+    TripEvent(TripStatus.WAITING_INITIAL, 'Asignaci칩n de Viaje Confirmada'),
+    TripEvent(TripStatus.ARRIVED_PICKUP, 'Llegada al Punto de Encuentro'),
+    TripEvent(TripStatus.IN_TRANSIT, 'Inicio de Viaje a Destino'),
+    TripEvent(TripStatus.TRIP_FINISHED, 'Destino Llegado - Viaje Finalizado'),
   ];
 
+  // Contadores de tiempo y l칩gica de cron칩metro (se mantiene)
+  final Stopwatch _totalStopwatch = Stopwatch();
   Duration _waitDuration = Duration.zero;
   Duration _travelDuration = Duration.zero;
   Timer? _timer;
@@ -50,181 +52,185 @@
   @override
   void initState() {
     super.initState();
-    WidgetsBinding.instance.addObserver(this);
-    _currentStatus = TripStatus.ASSIGNED_TO_DRIVER;
-    _initializeTrip();
+    _startStopwatch();
+    // Marcar el primer evento como completado y registrar su tiempo de inicio
+    _tripTimeline[0].timestamp = DateTime.now();
   }
 
   @override
-  void didChangeAppLifecycleState(AppLifecycleState state) {
-    if (state == AppLifecycleState.resumed) {
-      // Si la app vuelve a primer plano, forzamos la lectura de los tiempos
-      _updateTimes();
-    }
-  }
-
-  Future<void> _initializeTrip() async {
-    final isActive = await SessionManager.isTripActive();
-
-    if (!isActive) {
-      // Inicia un nuevo viaje en el estado base ASSIGNED_TO_DRIVER (0)
-      await SessionManager.startTrip();
-      _currentStatus = TripStatus.ASSIGNED_TO_DRIVER;
-    } else {
-      _currentStatus = await SessionManager.getCurrentTripPhase();
-
-      // Recuperar los timestamps para la l칤nea de tiempo.
-      final approached = await SessionManager.getTripTime(
-        'trip_approach_start_time',
-      ); // Nuevo timestamp
-      final arrived = await SessionManager.getTripTime('trip_arrived_time');
-      final started = await SessionManager.getTripTime(
-        'trip_started_transit_time',
-      );
-      final finished = await SessionManager.getTripTime('trip_finished_time');
-
-      if (approached != null) _tripTimeline[0].timestamp = approached;
-      if (arrived != null) _tripTimeline[1].timestamp = arrived;
-      if (started != null) _tripTimeline[2].timestamp = started;
-      if (finished != null) _tripTimeline[3].timestamp = finished;
-
-      // Recuperar contadores al inicio
-      _waitDuration = await SessionManager.getWaitPickupDuration();
-      _travelDuration = await SessionManager.getTravelDuration();
-    }
-
-    // Timer de 1 segundo para refrescar el UI de los tiempos m치s fluidamente
-    _timer = Timer.periodic(const Duration(seconds: 1), (_) => _updateTimes());
-    if (mounted) setState(() {});
-  }
-
-  // Corregido: Actualiza los contadores de tiempo en la UI leyendo el c치lculo en vivo
-  void _updateTimes() async {
-    if (_currentStatus == TripStatus.TRIP_FINISHED) {
-      _timer?.cancel();
-      return;
-    }
+  void dispose() {
+    _timer?.cancel();
+    _totalStopwatch.stop();
+    super.dispose();
+  }
 
-    // Leemos los contadores que SessionManager calcula en vivo usando DateTime.now()
-    final wait = await SessionManager.getWaitPickupDuration();
-    final travel = await SessionManager.getTravelDuration();
-
-    if (mounted) {
-      setState(() {
-        _waitDuration = wait;
-        _travelDuration = travel;
-      });
+  // --- L칩gica de Cron칩metro y Formato (sin cambios) ---
+  void _startStopwatch() {
+    _totalStopwatch.start();
+    _timer = Timer.periodic(const Duration(seconds: 1), (timer) {
+      if (_totalStopwatch.isRunning && mounted) {
+        setState(() {
+          _updateDurations();
+        });
+      }
+    });
+  }
+
+  void _updateDurations() {
+    if (_currentStatus == TripStatus.WAITING_INITIAL ||
+        _currentStatus == TripStatus.ARRIVED_PICKUP) {
+      // WAITING_INITIAL: el cron칩metro mide el tiempo de espera
+      _waitDuration = _totalStopwatch.elapsed;
+    } else if (_currentStatus == TripStatus.IN_TRANSIT) {
+      // IN_TRANSIT: el cron칩metro mide el tiempo de viaje desde el reinicio en ARRIVED_PICKUP
+      _travelDuration = _totalStopwatch.elapsed;
     }
   }
 
+  // Formatea una duraci칩n a HH:MM:SS
   String _formatDuration(Duration d) {
-    final h = d.inHours.toString().padLeft(2, '0');
-    final m = (d.inMinutes % 60).toString().padLeft(2, '0');
-    final s = (d.inSeconds % 60).toString().padLeft(2, '0');
-    return '$h:$m:$s';
+    String twoDigits(int n) => n.toString().padLeft(2, "0");
+    String hours = twoDigits(d.inHours);
+    String minutes = twoDigits(d.inMinutes.remainder(60));
+    String seconds = twoDigits(d.inSeconds.remainder(60));
+    return "$hours:$minutes:$seconds";
   }
 
-  void _advanceTripStatus() async {
-    if (_currentStatus == TripStatus.TRIP_FINISHED) return;
-
-    final nextIndex = _currentStatus.index + 1;
-    if (nextIndex >= TripStatus.values.length) return;
+  // --- L칩gica de Avance de Estado con Bot칩n 칔nico ---
+  void _advanceTripStatus() {
+    // Encuentra el 칤ndice del estado actual en el enum
+    final currentStatusIndex = _currentStatus.index;
 
-    final nextStatus = TripStatus.values[nextIndex];
-    await SessionManager.updateTripPhase(nextStatus);
+    // El siguiente estado es el 칤ndice actual + 1
+    final nextStatusIndex = currentStatusIndex + 1;
 
-    // Si el estado es APPROACHING_PICKUP o ARRIVED_PICKUP o IN_TRANSIT,
-    // el timestamp correspondiente en la l칤nea de tiempo se actualiza.
-    if (nextStatus.index > TripStatus.ASSIGNED_TO_DRIVER.index) {
-      // El 칤ndice de _tripTimeline es siempre el 칤ndice del enum - 1
-      _tripTimeline[nextStatus.index - 1].timestamp =
-          await SessionManager.getTripTime(
-            nextStatus == TripStatus.APPROACHING_PICKUP
-                ? 'trip_approach_start_time'
-                : nextStatus == TripStatus.ARRIVED_PICKUP
-                ? 'trip_arrived_time'
-                : nextStatus == TripStatus.IN_TRANSIT
-                ? 'trip_started_transit_time'
-                : 'trip_finished_time',
-          );
-    }
+    // Aseg칰rate de que no estamos m치s all치 del estado final
+    if (nextStatusIndex < TripStatus.values.length) {
+      final nextStatus = TripStatus.values[nextStatusIndex];
 
-    setState(() {
-      _currentStatus = nextStatus;
-      // Forzar la actualizaci칩n inmediata de los contadores con el nuevo tiempo fijo/cero
-      _updateTimes();
-    });
+      setState(() {
+        // 1. Actualiza el estado actual
+        _currentStatus = nextStatus;
 
-    if (nextStatus == TripStatus.TRIP_FINISHED) {
-      // Finaliza el viaje
-      await SessionManager.endTrip();
-      _timer?.cancel();
+        // 2. Registra el evento en la l칤nea de tiempo
+        _tripTimeline[nextStatusIndex].timestamp = DateTime.now();
+
+        // 3. Manejo de la l칩gica de tiempo/cron칩metro
+        if (nextStatus == TripStatus.ARRIVED_PICKUP) {
+          // El tiempo de espera est치 fijo. Reinicia y empieza a medir el tiempo de viaje.
+          _totalStopwatch.stop();
+          _waitDuration = _totalStopwatch.elapsed; // Fija el tiempo de espera
+          _totalStopwatch.reset();
+          _travelDuration = Duration.zero;
+          _totalStopwatch.start(); // Comienza a medir el tiempo de viaje
+        } else if (nextStatus == TripStatus.IN_TRANSIT) {
+          // En tr치nsito (puede que no sea necesario, pero asegura que el cron칩metro est칠 corriendo)
+          if (!_totalStopwatch.isRunning) {
+            _totalStopwatch.start();
+          }
+        } else if (nextStatus == TripStatus.TRIP_FINISHED) {
+          // Finalizado: detiene todo y fija el tiempo de viaje
+          _totalStopwatch.stop();
+          _travelDuration = _totalStopwatch.elapsed; // Fija el tiempo de viaje
+          _timer?.cancel();
+        }
+
+        _updateDurations();
+      });
     }
   }
 
+  // ==========================================================
+  // M칄TODO: POP-UP DE CONFIRMACI칍N (ACTUALIZADO)
+  // ==========================================================
   Future<void> _showConfirmationDialog() async {
+    // Si ya estamos en el 칰ltimo estado (TRIP_FINISHED), no hacemos nada
     if (_currentStatus == TripStatus.TRIP_FINISHED) return;
 
-    // Define la descripci칩n del PR칍XIMO estado
-    String nextDesc = '';
-    if (_currentStatus == TripStatus.ASSIGNED_TO_DRIVER) {
-      nextDesc = '1. Iniciar Viaje (a Recojo)';
-    } else if (_currentStatus == TripStatus.APPROACHING_PICKUP) {
-      nextDesc = '2. Chofer llega al Punto de Encuentro';
-    } else if (_currentStatus == TripStatus.ARRIVED_PICKUP) {
-      nextDesc = '3. Iniciar Viaje con Pasajero (a Destino)';
-    } else if (_currentStatus == TripStatus.IN_TRANSIT) {
-      nextDesc = '4. Finalizar Viaje';
-    } else {
-      return;
-    }
+    final nextStatusDescription =
+        _tripTimeline[_currentStatus.index + 1].description;
 
-    final confirm = await showDialog<bool>(
+    return showDialog<void>(
       context: context,
-      barrierDismissible: false,
-      builder: (_) => AlertDialog(
-        title: const Text('Confirmar Avance'),
-        content: Column(
-          mainAxisSize: MainAxisSize.min,
-          children: [
-            const Text('쮼st치s seguro de avanzar al siguiente paso?'),
-            const SizedBox(height: 12),
-            Text(
-              'Pr칩ximo estado: "$nextDesc"',
-              style: const TextStyle(
-                fontWeight: FontWeight.bold,
-                color: Colors.blue,
-              ),
-            ),
-            const SizedBox(height: 8),
-            const Text('Esta acci칩n no se puede deshacer.'),
-          ],
-        ),
-        actions: [
-          TextButton(
-            onPressed: () => Navigator.pop(context, false),
-            child: const Text('Cancelar'),
-          ),
-          ElevatedButton(
-            onPressed: () => Navigator.pop(context, true),
-            style: ElevatedButton.styleFrom(
-              backgroundColor: Colors.blue.shade700,
-            ),
-            child: const Text('Avanzar'),
-          ),
-        ],
-      ),
+      barrierDismissible: false, // El usuario debe tocar un bot칩n
+      builder: (BuildContext context) {
+        return AlertDialog(
+          title: const Text('Confirmar Avance'),
+          content: SingleChildScrollView(
+            child: ListBody(
+              children: <Widget>[
+                const Text('쮼st치s seguro de avanzar al siguiente paso?'),
+                const SizedBox(height: 8),
+                Text(
+                  'Pr칩ximo estado: "$nextStatusDescription"',
+                  style: const TextStyle(
+                    fontWeight: FontWeight.bold,
+                    color: Colors.blue,
+                  ),
+                ),
+                const SizedBox(height: 16),
+                const Text(
+                  'Esta acci칩n registrar치 el tiempo y no se podr치 deshacer.',
+                ),
+              ],
+            ),
+          ),
+          // MODIFICACI칍N: Se usa un Row y ElevatedButtons/TextButtons estilizados en Actions
+          actionsAlignment: MainAxisAlignment.end,
+          actions: <Widget>[
+            // Bot칩n CANCELAR (TextButton estilizado)
+            TextButton(
+              style: TextButton.styleFrom(
+                padding: const EdgeInsets.symmetric(
+                  horizontal: 16,
+                  vertical: 10,
+                ),
+                shape: RoundedRectangleBorder(
+                  borderRadius: BorderRadius.circular(8),
+                  side: BorderSide(color: Colors.grey.shade400, width: 1.5),
+                ),
+                foregroundColor: Colors.black87, // Color del texto
+              ),
+              child: const Text(
+                'Cancelar',
+                style: TextStyle(fontWeight: FontWeight.bold),
+              ),
+              onPressed: () {
+                // L칩gica de cierre para CANCELAR: YA IMPLEMENTADO
+                Navigator.of(context).pop(); // Cierra el pop-up
+              },
+            ),
+            const SizedBox(width: 8),
+            // Bot칩n AVANZAR (ElevatedButton)
+            ElevatedButton(
+              style: ElevatedButton.styleFrom(
+                padding: const EdgeInsets.symmetric(
+                  horizontal: 16,
+                  vertical: 10,
+                ),
+                backgroundColor: Colors.blue.shade700, // Fondo s칩lido azul
+                foregroundColor: Colors.white, // Texto blanco
+                shape: RoundedRectangleBorder(
+                  borderRadius: BorderRadius.circular(8), // Border radius
+                ),
+              ),
+              child: const Text(
+                'Avanzar',
+                style: TextStyle(fontWeight: FontWeight.bold),
+              ),
+              onPressed: () {
+                // L칩gica de cierre y avance para AVANZAR: YA IMPLEMENTADO
+                Navigator.of(context).pop(); // Cierra el pop-up
+                _advanceTripStatus(); // Ejecuta la l칩gica de avance
+              },
+            ),
+          ],
+        );
+      },
     );
+  }
 
-    if (confirm == true) _advanceTripStatus();
-  }
-
-  @override
-  void dispose() {
-    WidgetsBinding.instance.removeObserver(this);
-    _timer?.cancel();
-    super.dispose();
-  }
+  // --- M칠todos de Construcci칩n de Widgets (sin cambios) ---
 
   @override
   Widget build(BuildContext context) {
@@ -232,10 +238,8 @@
       backgroundColor: Colors.grey[50],
       body: Column(
         children: [
-          const LogoHeader(
-            titulo: 'Viaje',
-            estiloLogin: false,
-          ), // Asumo este widget
+          const LogoHeader(titulo: 'Viaje', estiloLogin: false),
+
           Expanded(
             child: SingleChildScrollView(
               padding: const EdgeInsets.all(16.0),
@@ -246,8 +250,10 @@
                   const SizedBox(height: 20),
                   _buildTimeTrackers(),
                   const SizedBox(height: 30),
+                  // Se reemplaza _buildActionButtons() por el bot칩n 칰nico
                   _buildSingleActionButton(),
                   const SizedBox(height: 30),
+                  // Nuevo widget para la l칤nea de tiempo
                   _buildTimeline(),
                 ],
               ),
@@ -255,29 +261,34 @@
           ),
         ],
       ),
-      bottomNavigationBar: const CustomBottomNavBar(), // Asumo este widget
+      bottomNavigationBar: const CustomBottomNavBar(),
     );
   }
 
+  // Construye la tarjeta que muestra el estado actual del viaje (sin cambios sustanciales)
   Widget _buildStatusCard() {
-    String text = '';
-    Color color = Colors.grey.shade600;
+    // ... (El c칩digo de _buildStatusCard se mantiene igual)
+    String statusText = '';
+    Color statusColor = Colors.grey;
 
-    if (_currentStatus == TripStatus.ASSIGNED_TO_DRIVER) {
-      text = 'ASIGNADO - Pendiente de Iniciar Viaje';
-      color = Colors.grey.shade600;
-    } else if (_currentStatus == TripStatus.APPROACHING_PICKUP) {
-      text = 'EN RUTA - Viajando a la direcci칩n de recojo';
-      color = Colors.blue.shade800;
-    } else if (_currentStatus == TripStatus.ARRIVED_PICKUP) {
-      text = 'ESPERA - Esperando al pasajero en el punto de encuentro';
-      color = Colors.orange.shade800;
-    } else if (_currentStatus == TripStatus.IN_TRANSIT) {
-      text = 'EN VIAJE - Llevando al pasajero al destino';
-      color = Colors.green.shade800;
-    } else if (_currentStatus == TripStatus.TRIP_FINISHED) {
-      text = 'VIAJE FINALIZADO CON 칄XITO';
-      color = Colors.purple.shade800;
+    switch (_currentStatus) {
+      case TripStatus.WAITING_INITIAL:
+        statusText =
+            'En Espera de Llegada al Punto de Encuentro (Tiempo Muerto)';
+        statusColor = Colors.orange.shade800;
+        break;
+      case TripStatus.ARRIVED_PICKUP:
+        statusText = 'Llegada Confirmada. Esperando a Iniciar el Viaje.';
+        statusColor = Colors.blue.shade800;
+        break;
+      case TripStatus.IN_TRANSIT:
+        statusText = 'VIAJE INICIADO - En Recorrido a Destino';
+        statusColor = Colors.green.shade800;
+        break;
+      case TripStatus.TRIP_FINISHED:
+        statusText = 'VIAJE FINALIZADO con 칠xito.';
+        statusColor = Colors.purple.shade800;
+        break;
     }
 
     return Container(
@@ -287,12 +298,12 @@
         borderRadius: BorderRadius.circular(12),
         boxShadow: [
           BoxShadow(
-            color: color.withOpacity(0.1),
+            color: statusColor.withOpacity(0.1),
             blurRadius: 10,
             offset: const Offset(0, 5),
           ),
         ],
-        border: Border.all(color: color.withOpacity(0.5), width: 2),
+        border: Border.all(color: statusColor.withOpacity(0.5), width: 2),
       ),
       child: Column(
         crossAxisAlignment: CrossAxisAlignment.start,
@@ -307,11 +318,11 @@
           ),
           const SizedBox(height: 4),
           Text(
-            text,
+            statusText,
             style: TextStyle(
               fontSize: 18,
               fontWeight: FontWeight.bold,
-              color: color,
+              color: statusColor,
             ),
           ),
         ],
@@ -319,90 +330,106 @@
     );
   }
 
-  Widget _buildTimeTrackers() => Column(
-    children: [
-      // Contador de Espera (Amarillo)
-      _timeDisplay(
-        'Tiempo de Espera (al pasajero)',
-        _formatDuration(_waitDuration),
-        Colors.orange.shade100,
-        Colors.orange.shade800,
-      ),
-      const SizedBox(height: 10),
-      // Contador de Viaje (Verde)
-      _timeDisplay(
-        'Tiempo de Recorrido',
-        _formatDuration(_travelDuration),
-        Colors.green.shade100,
-        Colors.green.shade800,
-      ),
-    ],
-  );
+  // Construye los indicadores de tiempo (Espera y Viaje) (sin cambios sustanciales)
+  Widget _buildTimeTrackers() {
+    // ... (El c칩digo de _buildTimeTrackers y _timeDisplay se mantiene igual)
+    return Column(
+      children: [
+        _timeDisplay(
+          'Tiempo de Espera ',
+          _formatDuration(_waitDuration),
+          Colors.orange.shade100,
+          Colors.orange.shade800,
+        ),
+        const SizedBox(height: 10),
+        _timeDisplay(
+          'Tiempo de Recorrido ',
+          _formatDuration(_travelDuration),
+          Colors.green.shade100,
+          Colors.green.shade800,
+        ),
+      ],
+    );
+  }
 
-  Widget _timeDisplay(String title, String time, Color bg, Color fg) =>
-      Container(
-        padding: const EdgeInsets.symmetric(vertical: 12, horizontal: 16),
-        decoration: BoxDecoration(
-          color: bg,
-          borderRadius: BorderRadius.circular(8),
-        ),
-        child: Row(
-          mainAxisAlignment: MainAxisAlignment.spaceBetween,
-          children: [
-            Text(
-              title,
-              style: TextStyle(fontWeight: FontWeight.w600, color: fg),
-            ),
-            Text(
-              time,
-              style: TextStyle(
-                fontSize: 20,
-                fontWeight: FontWeight.bold,
-                color: fg,
-                fontFamily: 'RobotoMono',
-              ),
-            ),
-          ],
-        ),
-      );
+  // Widget auxiliar para mostrar el tiempo (sin cambios sustanciales)
+  Widget _timeDisplay(String title, String time, Color bgColor, Color fgColor) {
+    return Container(
+      padding: const EdgeInsets.symmetric(vertical: 12, horizontal: 16),
+      decoration: BoxDecoration(
+        color: bgColor,
+        borderRadius: BorderRadius.circular(8),
+      ),
+      child: Row(
+        mainAxisAlignment: MainAxisAlignment.spaceBetween,
+        children: [
+          Text(
+            title,
+            style: TextStyle(fontWeight: FontWeight.w600, color: fgColor),
+          ),
+          Text(
+            time,
+            style: TextStyle(
+              fontSize: 20,
+              fontWeight: FontWeight.bold,
+              color: fgColor,
+              // Utiliza una fuente monoespaciada para mejor visualizaci칩n del tiempo
+              fontFamily: 'RobotoMono',
+            ),
+          ),
+        ],
+      ),
+    );
+  }
 
+  // --- Nuevo Widget: Bot칩n de Acci칩n 칔nico (sin cambios, ya llama al pop-up) ---
   Widget _buildSingleActionButton() {
-    final texts = {
-      TripStatus.ASSIGNED_TO_DRIVER: '1. Iniciar Viaje (a Recojo)',
-      TripStatus.APPROACHING_PICKUP: '2. Chofer llega al Punto de Encuentro',
-      TripStatus.ARRIVED_PICKUP: '3. Iniciar Viaje con Pasajero (a Destino)',
-      TripStatus.IN_TRANSIT: '4. Finalizar Viaje',
-      TripStatus.TRIP_FINISHED: 'VIAJE FINALIZADO',
-    };
+    String buttonText;
+    Color buttonColor;
+    bool isEnabled = true;
+    VoidCallback? onPressedAction;
 
-    final colors = {
-      TripStatus.ASSIGNED_TO_DRIVER: Colors.blue.shade700,
-      TripStatus.APPROACHING_PICKUP: Colors.orange.shade700,
-      TripStatus.ARRIVED_PICKUP: Colors.green.shade700,
-      TripStatus.IN_TRANSIT: Colors.purple.shade700,
-      TripStatus.TRIP_FINISHED: Colors.grey,
-    };
+    switch (_currentStatus) {
+      case TripStatus.WAITING_INITIAL:
+        buttonText = '1. Confirmar Llegada a Punto de Encuentro';
+        buttonColor = Colors.blue.shade700;
+        onPressedAction = _showConfirmationDialog; // Llama al Pop-up
+        break;
+      case TripStatus.ARRIVED_PICKUP:
+        buttonText = '2. Iniciar Viaje a Destino';
+        buttonColor = Colors.green.shade700;
+        onPressedAction = _showConfirmationDialog; // Llama al Pop-up
+        break;
+      case TripStatus.IN_TRANSIT:
+        buttonText = '3. Confirmar Destino Llegado';
+        buttonColor = Colors.purple.shade700;
+        onPressedAction = _showConfirmationDialog; // Llama al Pop-up
+        break;
+      case TripStatus.TRIP_FINISHED:
+        buttonText = 'VIAJE FINALIZADO';
+        buttonColor = Colors.grey;
+        isEnabled = false;
+        onPressedAction = null;
+        break;
+    }
 
+    // Usa onPressedAction si est치 habilitado, sino es null.
     return ElevatedButton(
-      onPressed: _currentStatus == TripStatus.TRIP_FINISHED
-          ? null
-          : _showConfirmationDialog,
+      onPressed: isEnabled ? onPressedAction : null,
       style: ElevatedButton.styleFrom(
         minimumSize: const Size(double.infinity, 55),
-        backgroundColor: colors[_currentStatus],
+        backgroundColor: buttonColor,
+        foregroundColor: Colors.white,
         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
       ),
       child: Text(
-        texts[_currentStatus]!,
-        style: const TextStyle(
-          fontSize: 18,
-          fontWeight: FontWeight.bold,
-          color: Colors.white,
-        ),
+        buttonText,
+        style: const TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
       ),
     );
   }
 
+  // --- Nuevo Widget: L칤nea de Tiempo de Eventos (sin cambios) ---
   Widget _buildTimeline() {
     return Container(
       decoration: BoxDecoration(
@@ -423,92 +450,98 @@
             ),
           ),
           const SizedBox(height: 10),
-          ..._tripTimeline.map((event) {
-            final completed = event.timestamp != null;
-            final isActive = _currentStatus == event.status;
-
-            Color iconColor;
-            IconData iconData;
-
-            if (completed) {
-              iconColor = Colors.green.shade700;
-              iconData = Icons.check_circle;
-            } else if (isActive) {
-              iconColor = Colors.orange.shade500;
-              iconData = Icons.adjust;
-            } else {
-              iconColor = Colors.grey.shade400;
-              iconData = Icons.radio_button_off;
-            }
+          // Lista de eventos
+          ..._tripTimeline.asMap().entries.map((entry) {
+            int index = entry.key;
+            TripEvent event = entry.value;
+            bool isCompleted = event.timestamp != null;
+            bool isCurrent = event.status == _currentStatus && isCompleted;
+            bool isLast = index == _tripTimeline.length - 1;
 
             return Column(
+              crossAxisAlignment: CrossAxisAlignment.start,
               children: [
-                Row(
-                  children: [
-                    Container(
-                      width: 30,
-                      alignment: Alignment.center,
-                      child: Icon(iconData, color: iconColor, size: 20),
-                    ),
-                    const SizedBox(width: 8),
-                    Expanded(
-                      child: Column(
-                        crossAxisAlignment: CrossAxisAlignment.start,
-                        children: [
-                          Text(
-                            event.description,
-                            style: TextStyle(
-                              fontWeight: completed || isActive
-                                  ? FontWeight.bold
-                                  : FontWeight.normal,
-                              color: completed || isActive
-                                  ? Colors.black87
-                                  : Colors.grey.shade600,
-                            ),
-                          ),
-                          Text(
-                            completed
-                                ? 'Hora: ${event.timestamp!.toString().substring(11, 19)}'
-                                : isActive
-                                ? 'EN CURSO (Estado Actual)'
-                                : 'Pendiente',
-                            style: TextStyle(
-                              fontSize: 12,
-                              color: completed ? Colors.grey : iconColor,
-                              fontWeight: isActive
-                                  ? FontWeight.bold
-                                  : FontWeight.normal,
-                            ),
-                          ),
-                        ],
-                      ),
-                    ),
-                  ],
-                ),
-                if (event != _tripTimeline.last)
-                  _buildTimelineConnector(completed),
-              ],
-            );
-          }).toList(),
-        ],
-      ),
+                _buildTimelineItem(event, isCompleted, isCurrent),
+                // Solo dibuja la l칤nea si no es el 칰ltimo elemento
+                if (!isLast) _buildTimelineConnector(isCompleted),
+              ],
+            );
+          }).toList(),
+        ],
+      ),
+    );
+  }
+
+  // Widget para un elemento de la l칤nea de tiempo
+  Widget _buildTimelineItem(TripEvent event, bool isCompleted, bool isCurrent) {
+    String formattedTime = event.timestamp != null
+        ? event.timestamp!.toLocal().toString().substring(11, 16) // HH:MM
+        : 'Pendiente';
+
+    Color iconColor = isCompleted
+        ? Colors.green.shade700
+        : Colors.grey.shade400;
+
+    return Row(
+      crossAxisAlignment: CrossAxisAlignment.start,
+      children: [
+        // 칈cono de estado
+        Container(
+          width: 30,
+          alignment: Alignment.center,
+          child: Icon(
+            isCompleted ? Icons.check_circle : Icons.radio_button_off,
+            color: iconColor,
+            size: 20,
+          ),
+        ),
+        const SizedBox(width: 8),
+        // Descripci칩n y tiempo
+        Expanded(
+          child: Column(
+            crossAxisAlignment: CrossAxisAlignment.start,
+            children: [
+              Text(
+                event.description,
+                style: TextStyle(
+                  fontWeight: isCurrent || isCompleted
+                      ? FontWeight.bold
+                      : FontWeight.normal,
+                  color: isCompleted ? Colors.black87 : Colors.grey.shade600,
+                ),
+              ),
+              Text(
+                '${isCompleted ? 'Hora: $formattedTime' : 'Esperando...'}',
+                style: TextStyle(
+                  fontSize: 12,
+                  color: isCompleted ? Colors.black54 : Colors.grey.shade500,
+                ),
+              ),
+            ],
+          ),
+        ),
+      ],
     );
   }
 
-  Widget _buildTimelineConnector(bool completed) => Row(
-    children: [
-      Container(
-        width: 30,
-        alignment: Alignment.center,
-        child: Container(
-          margin: const EdgeInsets.symmetric(vertical: 4),
-          height: 25,
-          width: 2,
-          color: completed ? Colors.green.shade200 : Colors.grey.shade200,
-        ),
-      ),
-      const SizedBox(width: 8),
-      const Expanded(child: SizedBox.shrink()),
-    ],
-  );
+  // Widget para la l칤nea conectora
+  Widget _buildTimelineConnector(bool isCompleted) {
+    return Row(
+      children: [
+        Container(
+          width: 30,
+          alignment: Alignment.center,
+          child: Container(
+            margin: const EdgeInsets.symmetric(vertical: 4),
+            height: 25,
+            width: 2,
+            color: isCompleted ? Colors.green.shade200 : Colors.grey.shade200,
+          ),
+        ),
+        const SizedBox(width: 8),
+        // Espacio vac칤o para la l칤nea
+        const Expanded(child: SizedBox.shrink()),
+      ],
+    );
+  }
 }
Index: lib/Views/Login/login_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import 'dart:convert';\r\nimport 'package:flutter/material.dart';\r\nimport 'package:http/http.dart' as http;\r\n\r\nimport '../Inicio/inicio_page.dart';\r\nimport '/utils/session_manager.dart';\r\nimport '../widgets/header.dart';\r\nimport 'forgot_password_page.dart';\r\n\r\nclass LoginPage extends StatefulWidget {\r\n  const LoginPage({super.key});\r\n\r\n  @override\r\n  _LoginPageState createState() => _LoginPageState();\r\n}\r\n\r\nclass _LoginPageState extends State<LoginPage> {\r\n  final _formKey = GlobalKey<FormState>();\r\n  final _emailController = TextEditingController();\r\n  final _passwordController = TextEditingController();\r\n  bool _obscurePassword = true;\r\n  bool _isLoading = false;\r\n\r\n  @override\r\n  void dispose() {\r\n    _emailController.dispose();\r\n    _passwordController.dispose();\r\n    super.dispose();\r\n  }\r\n\r\n  Future<void> _handleLogin() async {\r\n    if (_formKey.currentState!.validate()) {\r\n      setState(() => _isLoading = true);\r\n\r\n      final url = Uri.parse(\r\n        \"http://servidorcorman.dyndns.org:7019/api/login_movil\",\r\n      );\r\n\r\n      final stopwatch = Stopwatch()..start();\r\n\r\n      try {\r\n        // Use a timeout to avoid hanging long requests; Postman might be faster\r\n        // due to network/local conditions, but a timeout here gives better UX.\r\n        final response = await http\r\n            .post(\r\n              url,\r\n              headers: {\"Content-Type\": \"application/json\"},\r\n              body: jsonEncode({\r\n                \"email\": _emailController.text.trim(),\r\n                \"password\": _passwordController.text.trim(),\r\n              }),\r\n            )\r\n            .timeout(const Duration(seconds: 30));\r\n\r\n        stopwatch.stop();\r\n        // ignore: avoid_print\r\n        print('Login request time: ${stopwatch.elapsedMilliseconds} ms');\r\n\r\n        if (response.statusCode == 200) {\r\n          final data = jsonDecode(response.body);\r\n\r\n          if (data[\"success\"] == true) {\r\n            final token = data[\"token\"];\r\n            final user = data[\"user\"] ?? {};\r\n            final userId = user[\"id\"] ?? 0;\r\n\r\n            final reservasData = data[\"reservas_dia\"];\r\n            final reservas = reservasData is List\r\n                ? reservasData\r\n                : (reservasData is Map ? [reservasData] : []);\r\n\r\n            final solicitudesData = data[\"solicitudes\"];\r\n            final solicitudes = solicitudesData is List\r\n                ? solicitudesData\r\n                : (solicitudesData is Map ? [solicitudesData] : []);\r\n\r\n            // Persist token and userId quickly so UI can proceed, then store the rest in background\r\n            await SessionManager.saveSessionFast(\r\n              token: token,\r\n              userId: userId,\r\n              user: user,\r\n              reservas: reservas,\r\n              solicitudes: solicitudes,\r\n            );\r\n\r\n            // Navegar inmediatamente a HomeScreen (percepci칩n de velocidad)\r\n            Navigator.pushReplacement(\r\n              context,\r\n              MaterialPageRoute(\r\n                builder: (context) => HomeScreen(reservas: reservas),\r\n              ),\r\n            );\r\n          } else {\r\n            ScaffoldMessenger.of(context).showSnackBar(\r\n              const SnackBar(content: Text(\"Credenciales incorrectas\")),\r\n            );\r\n          }\r\n        } else if (response.statusCode == 404) {\r\n          final data = jsonDecode(response.body);\r\n          ScaffoldMessenger.of(context).showSnackBar(\r\n            SnackBar(\r\n              content: Text(\r\n                \"Sin resultados: ${data[\"data\"] ?? \"ning칰n registro encontrado\"}\",\r\n              ),\r\n            ),\r\n          );\r\n        } else if (response.statusCode == 500) {\r\n          ScaffoldMessenger.of(context).showSnackBar(\r\n            const SnackBar(content: Text(\"Error en el servidor (500)\")),\r\n          );\r\n        } else {\r\n          ScaffoldMessenger.of(context).showSnackBar(\r\n            SnackBar(content: Text(\"Error inesperado: ${response.statusCode}\")),\r\n          );\r\n        }\r\n      } catch (e) {\r\n        ScaffoldMessenger.of(\r\n          context,\r\n        ).showSnackBar(SnackBar(content: Text(\"Error de conexi칩n: $e\")));\r\n      } finally {\r\n        setState(() => _isLoading = false);\r\n      }\r\n    }\r\n  }\r\n\r\n  void _forgotPassword() {\r\n    Navigator.push(\r\n      context,\r\n      MaterialPageRoute(builder: (context) => ForgotPasswordPage()),\r\n    );\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[100],\r\n      body: SafeArea(\r\n        child: Column(\r\n          children: [\r\n            const LogoHeader(estiloLogin: true),\r\n            const SizedBox(height: 16),\r\n            Expanded(\r\n              child: SingleChildScrollView(\r\n                padding: const EdgeInsets.fromLTRB(24, 12, 24, 24),\r\n                child: Form(\r\n                  key: _formKey,\r\n                  child: Column(\r\n                    crossAxisAlignment: CrossAxisAlignment.stretch,\r\n                    children: [\r\n                      Container(\r\n                        margin: const EdgeInsets.only(top: 2),\r\n                        padding: const EdgeInsets.symmetric(vertical: 16),\r\n                        decoration: BoxDecoration(\r\n                          color: Colors.grey[800],\r\n                          borderRadius: BorderRadius.circular(8),\r\n                        ),\r\n                        child: const Center(\r\n                          child: Text(\r\n                            'Inicia sesi칩n',\r\n                            style: TextStyle(\r\n                              color: Colors.white,\r\n                              fontSize: 18,\r\n                              fontWeight: FontWeight.w500,\r\n                            ),\r\n                          ),\r\n                        ),\r\n                      ),\r\n                      const SizedBox(height: 24),\r\n                      _buildLabel(\"Correo electr칩nico\"),\r\n                      const SizedBox(height: 8),\r\n                      TextFormField(\r\n                        controller: _emailController,\r\n                        keyboardType: TextInputType.emailAddress,\r\n                        decoration: _inputDecoration(\r\n                          \"Ingrese su correo electr칩nico\",\r\n                        ),\r\n                        validator: (value) {\r\n                          if (value == null || value.isEmpty) {\r\n                            return 'Por favor ingrese su correo electr칩nico';\r\n                          }\r\n                          if (!RegExp(\r\n                            r'^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$',\r\n                          ).hasMatch(value)) {\r\n                            return 'Ingrese un correo v치lido';\r\n                          }\r\n                          return null;\r\n                        },\r\n                      ),\r\n                      const SizedBox(height: 24),\r\n                      _buildLabel(\"Contrase침a\"),\r\n                      const SizedBox(height: 8),\r\n                      TextFormField(\r\n                        controller: _passwordController,\r\n                        obscureText: _obscurePassword,\r\n                        decoration: _inputDecoration(\"Ingrese su contrase침a\")\r\n                            .copyWith(\r\n                              suffixIcon: IconButton(\r\n                                icon: Icon(\r\n                                  _obscurePassword\r\n                                      ? Icons.visibility\r\n                                      : Icons.visibility_off,\r\n                                  color: Colors.grey[600],\r\n                                ),\r\n                                onPressed: () {\r\n                                  setState(() {\r\n                                    _obscurePassword = !_obscurePassword;\r\n                                  });\r\n                                },\r\n                              ),\r\n                            ),\r\n                        validator: (value) {\r\n                          if (value == null || value.isEmpty) {\r\n                            return 'Por favor ingrese su contrase침a';\r\n                          }\r\n                          if (value.length < 3) {\r\n                            return 'La contrase침a debe tener al menos 3 caracteres';\r\n                          }\r\n                          return null;\r\n                        },\r\n                      ),\r\n                      const SizedBox(height: 32),\r\n                      SizedBox(\r\n                        height: 50,\r\n                        child: ElevatedButton(\r\n                          onPressed: _isLoading ? null : _handleLogin,\r\n                          style: ElevatedButton.styleFrom(\r\n                            backgroundColor: Colors.grey[800],\r\n                            foregroundColor: Colors.white,\r\n                            shape: RoundedRectangleBorder(\r\n                              borderRadius: BorderRadius.circular(25),\r\n                            ),\r\n                            elevation: 2,\r\n                          ),\r\n                          child: _isLoading\r\n                              ? const SizedBox(\r\n                                  height: 20,\r\n                                  width: 20,\r\n                                  child: CircularProgressIndicator(\r\n                                    color: Colors.white,\r\n                                    strokeWidth: 2,\r\n                                  ),\r\n                                )\r\n                              : const Text(\r\n                                  'Iniciar sesi칩n',\r\n                                  style: TextStyle(\r\n                                    fontSize: 16,\r\n                                    fontWeight: FontWeight.w600,\r\n                                  ),\r\n                                ),\r\n                        ),\r\n                      ),\r\n                      const SizedBox(height: 24),\r\n                      Center(\r\n                        child: TextButton(\r\n                          onPressed: _forgotPassword,\r\n                          child: const Text(\r\n                            '춰쯆lvidaste tu cuenta?!',\r\n                            style: TextStyle(\r\n                              color: Colors.black,\r\n                              fontSize: 16,\r\n                              fontWeight: FontWeight.w500,\r\n                            ),\r\n                          ),\r\n                        ),\r\n                      ),\r\n                    ],\r\n                  ),\r\n                ),\r\n              ),\r\n            ),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildLabel(String text) {\r\n    return Container(\r\n      decoration: BoxDecoration(\r\n        color: Colors.amber,\r\n        borderRadius: BorderRadius.circular(8),\r\n      ),\r\n      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 4),\r\n      child: Text(\r\n        text,\r\n        style: const TextStyle(\r\n          color: Colors.black,\r\n          fontSize: 16,\r\n          fontWeight: FontWeight.w500,\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n\r\n  InputDecoration _inputDecoration(String hint) {\r\n    return InputDecoration(\r\n      hintText: hint,\r\n      hintStyle: TextStyle(color: Colors.grey[600]),\r\n      filled: true,\r\n      fillColor: Colors.white,\r\n      border: OutlineInputBorder(\r\n        borderRadius: BorderRadius.circular(8),\r\n        borderSide: BorderSide.none,\r\n      ),\r\n      contentPadding: const EdgeInsets.symmetric(horizontal: 16, vertical: 16),\r\n    );\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Login/login_page.dart b/lib/Views/Login/login_page.dart
--- a/lib/Views/Login/login_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Login/login_page.dart	(date 1764209271641)
@@ -43,13 +43,13 @@
         // due to network/local conditions, but a timeout here gives better UX.
         final response = await http
             .post(
-              url,
-              headers: {"Content-Type": "application/json"},
-              body: jsonEncode({
-                "email": _emailController.text.trim(),
-                "password": _passwordController.text.trim(),
-              }),
-            )
+          url,
+          headers: {"Content-Type": "application/json"},
+          body: jsonEncode({
+            "email": _emailController.text.trim(),
+            "password": _passwordController.text.trim(),
+          }),
+        )
             .timeout(const Duration(seconds: 30));
 
         stopwatch.stop();
@@ -194,20 +194,20 @@
                         obscureText: _obscurePassword,
                         decoration: _inputDecoration("Ingrese su contrase침a")
                             .copyWith(
-                              suffixIcon: IconButton(
-                                icon: Icon(
-                                  _obscurePassword
-                                      ? Icons.visibility
-                                      : Icons.visibility_off,
-                                  color: Colors.grey[600],
-                                ),
-                                onPressed: () {
-                                  setState(() {
-                                    _obscurePassword = !_obscurePassword;
-                                  });
-                                },
-                              ),
-                            ),
+                          suffixIcon: IconButton(
+                            icon: Icon(
+                              _obscurePassword
+                                  ? Icons.visibility
+                                  : Icons.visibility_off,
+                              color: Colors.grey[600],
+                            ),
+                            onPressed: () {
+                              setState(() {
+                                _obscurePassword = !_obscurePassword;
+                              });
+                            },
+                          ),
+                        ),
                         validator: (value) {
                           if (value == null || value.isEmpty) {
                             return 'Por favor ingrese su contrase침a';
@@ -233,20 +233,20 @@
                           ),
                           child: _isLoading
                               ? const SizedBox(
-                                  height: 20,
-                                  width: 20,
-                                  child: CircularProgressIndicator(
-                                    color: Colors.white,
-                                    strokeWidth: 2,
-                                  ),
-                                )
+                            height: 20,
+                            width: 20,
+                            child: CircularProgressIndicator(
+                              color: Colors.white,
+                              strokeWidth: 2,
+                            ),
+                          )
                               : const Text(
-                                  'Iniciar sesi칩n',
-                                  style: TextStyle(
-                                    fontSize: 16,
-                                    fontWeight: FontWeight.w600,
-                                  ),
-                                ),
+                            'Iniciar sesi칩n',
+                            style: TextStyle(
+                              fontSize: 16,
+                              fontWeight: FontWeight.w600,
+                            ),
+                          ),
                         ),
                       ),
                       const SizedBox(height: 24),
Index: .idea/caches/deviceStreaming.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"DeviceStreaming\">\r\n    <option name=\"deviceSelectionList\">\r\n      <list>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"Sony\" />\r\n          <option name=\"codename\" value=\"A402SO\" />\r\n          <option name=\"id\" value=\"A402SO\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Sony\" />\r\n          <option name=\"name\" value=\"Xperia 10\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2520\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"27\" />\r\n          <option name=\"brand\" value=\"DOCOMO\" />\r\n          <option name=\"codename\" value=\"F01L\" />\r\n          <option name=\"id\" value=\"F01L\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"FUJITSU\" />\r\n          <option name=\"name\" value=\"F-01L\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1280\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"OnePlus\" />\r\n          <option name=\"codename\" value=\"OP535DL1\" />\r\n          <option name=\"id\" value=\"OP535DL1\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"OnePlus\" />\r\n          <option name=\"name\" value=\"CPH2409\" />\r\n          <option name=\"screenDensity\" value=\"401\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2412\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"OnePlus\" />\r\n          <option name=\"codename\" value=\"OP5552L1\" />\r\n          <option name=\"id\" value=\"OP5552L1\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"OnePlus\" />\r\n          <option name=\"name\" value=\"CPH2415\" />\r\n          <option name=\"screenDensity\" value=\"480\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2412\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"OnePlus\" />\r\n          <option name=\"codename\" value=\"OP5552L1\" />\r\n          <option name=\"id\" value=\"OP5552L1\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"OnePlus\" />\r\n          <option name=\"name\" value=\"CPH2415\" />\r\n          <option name=\"screenDensity\" value=\"480\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2412\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"OPPO\" />\r\n          <option name=\"codename\" value=\"OP573DL1\" />\r\n          <option name=\"id\" value=\"OP573DL1\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"OPPO\" />\r\n          <option name=\"name\" value=\"CPH2557\" />\r\n          <option name=\"screenDensity\" value=\"480\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"28\" />\r\n          <option name=\"brand\" value=\"DOCOMO\" />\r\n          <option name=\"codename\" value=\"SH-01L\" />\r\n          <option name=\"id\" value=\"SH-01L\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"SHARP\" />\r\n          <option name=\"name\" value=\"AQUOS sense2 SH-01L\" />\r\n          <option name=\"screenDensity\" value=\"480\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2160\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"Lenovo\" />\r\n          <option name=\"codename\" value=\"TB330FU\" />\r\n          <option name=\"formFactor\" value=\"Tablet\" />\r\n          <option name=\"id\" value=\"TB330FU\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Lenovo\" />\r\n          <option name=\"name\" value=\"Tab M11\" />\r\n          <option name=\"screenDensity\" value=\"240\" />\r\n          <option name=\"screenX\" value=\"1200\" />\r\n          <option name=\"screenY\" value=\"1920\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a14m\" />\r\n          <option name=\"id\" value=\"a14m\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-A145R\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2408\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a15\" />\r\n          <option name=\"id\" value=\"a15\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"A15\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a15x\" />\r\n          <option name=\"id\" value=\"a15x\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"A15 5G\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a16\" />\r\n          <option name=\"id\" value=\"a16\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-A165M\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a16x\" />\r\n          <option name=\"id\" value=\"a16x\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"A16 5G\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a35x\" />\r\n          <option name=\"id\" value=\"a35x\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"A35\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"a36xq\" />\r\n          <option name=\"id\" value=\"a36xq\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-A366E\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"akita\" />\r\n          <option name=\"id\" value=\"akita\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 8a\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"akita\" />\r\n          <option name=\"id\" value=\"akita\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 8a\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"arcfox\" />\r\n          <option name=\"id\" value=\"arcfox\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"razr plus 2024\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"1272\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"austin\" />\r\n          <option name=\"id\" value=\"austin\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g 5G (2022)\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1600\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"b0q\" />\r\n          <option name=\"id\" value=\"b0q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S22 Ultra\" />\r\n          <option name=\"screenDensity\" value=\"600\" />\r\n          <option name=\"screenX\" value=\"1440\" />\r\n          <option name=\"screenY\" value=\"3088\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"b6q\" />\r\n          <option name=\"id\" value=\"b6q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Flip 6\" />\r\n          <option name=\"screenDensity\" value=\"340\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2640\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"36\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"blazer\" />\r\n          <option name=\"id\" value=\"blazer\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 10 Pro\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2410\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"32\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"bluejay\" />\r\n          <option name=\"id\" value=\"bluejay\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 6a\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"caiman\" />\r\n          <option name=\"id\" value=\"caiman\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"960\" />\r\n          <option name=\"screenY\" value=\"2142\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"caiman\" />\r\n          <option name=\"id\" value=\"caiman\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"960\" />\r\n          <option name=\"screenY\" value=\"2142\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"comet\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"comet\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro Fold\" />\r\n          <option name=\"screenDensity\" value=\"390\" />\r\n          <option name=\"screenX\" value=\"2076\" />\r\n          <option name=\"screenY\" value=\"2152\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"comet\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"comet\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro Fold\" />\r\n          <option name=\"screenDensity\" value=\"390\" />\r\n          <option name=\"screenX\" value=\"2076\" />\r\n          <option name=\"screenY\" value=\"2152\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"29\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"crownqlteue\" />\r\n          <option name=\"id\" value=\"crownqlteue\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Note9\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"2220\" />\r\n          <option name=\"screenY\" value=\"1080\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"dm2q\" />\r\n          <option name=\"id\" value=\"dm2q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"S23 Plus\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"dm3q\" />\r\n          <option name=\"id\" value=\"dm3q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S23 Ultra\" />\r\n          <option name=\"screenDensity\" value=\"600\" />\r\n          <option name=\"screenX\" value=\"1440\" />\r\n          <option name=\"screenY\" value=\"3088\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"dubai\" />\r\n          <option name=\"id\" value=\"dubai\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"edge 30\" />\r\n          <option name=\"screenDensity\" value=\"405\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"e1q\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"e1q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S24\" />\r\n          <option name=\"screenDensity\" value=\"480\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"e3q\" />\r\n          <option name=\"id\" value=\"e3q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S24 Ultra\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1440\" />\r\n          <option name=\"screenY\" value=\"3120\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"eos\" />\r\n          <option name=\"id\" value=\"eos\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Eos\" />\r\n          <option name=\"screenDensity\" value=\"320\" />\r\n          <option name=\"screenX\" value=\"384\" />\r\n          <option name=\"screenY\" value=\"384\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"felix\" />\r\n          <option name=\"id\" value=\"felix\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel Fold\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"2208\" />\r\n          <option name=\"screenY\" value=\"1840\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"felix\" />\r\n          <option name=\"id\" value=\"felix\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel Fold\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"2208\" />\r\n          <option name=\"screenY\" value=\"1840\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"felix_camera\" />\r\n          <option name=\"id\" value=\"felix_camera\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel Fold (Camera-enabled)\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"2208\" />\r\n          <option name=\"screenY\" value=\"1840\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"fogona\" />\r\n          <option name=\"id\" value=\"fogona\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g play - 2024\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1600\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"fogos\" />\r\n          <option name=\"id\" value=\"fogos\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g34 5G\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1600\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"36\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"frankel\" />\r\n          <option name=\"id\" value=\"frankel\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 10\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2424\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"g0q\" />\r\n          <option name=\"id\" value=\"g0q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-S906U1\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gta9pwifi\" />\r\n          <option name=\"id\" value=\"gta9pwifi\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-X210\" />\r\n          <option name=\"screenDensity\" value=\"240\" />\r\n          <option name=\"screenX\" value=\"1200\" />\r\n          <option name=\"screenY\" value=\"1920\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts7lwifi\" />\r\n          <option name=\"id\" value=\"gts7lwifi\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-T870\" />\r\n          <option name=\"screenDensity\" value=\"340\" />\r\n          <option name=\"screenX\" value=\"1600\" />\r\n          <option name=\"screenY\" value=\"2560\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts7xllite\" />\r\n          <option name=\"id\" value=\"gts7xllite\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-T738U\" />\r\n          <option name=\"screenDensity\" value=\"340\" />\r\n          <option name=\"screenX\" value=\"1600\" />\r\n          <option name=\"screenY\" value=\"2560\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts8uwifi\" />\r\n          <option name=\"formFactor\" value=\"Tablet\" />\r\n          <option name=\"id\" value=\"gts8uwifi\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Tab S8 Ultra\" />\r\n          <option name=\"screenDensity\" value=\"320\" />\r\n          <option name=\"screenX\" value=\"1848\" />\r\n          <option name=\"screenY\" value=\"2960\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts8wifi\" />\r\n          <option name=\"formFactor\" value=\"Tablet\" />\r\n          <option name=\"id\" value=\"gts8wifi\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Tab S8\" />\r\n          <option name=\"screenDensity\" value=\"274\" />\r\n          <option name=\"screenX\" value=\"1600\" />\r\n          <option name=\"screenY\" value=\"2560\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts9fe\" />\r\n          <option name=\"id\" value=\"gts9fe\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Tab S9 FE 5G\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"1440\" />\r\n          <option name=\"screenY\" value=\"2304\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"gts9wifi\" />\r\n          <option name=\"id\" value=\"gts9wifi\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-X710\" />\r\n          <option name=\"screenDensity\" value=\"340\" />\r\n          <option name=\"screenX\" value=\"1600\" />\r\n          <option name=\"screenY\" value=\"2560\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"husky\" />\r\n          <option name=\"id\" value=\"husky\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 8 Pro\" />\r\n          <option name=\"screenDensity\" value=\"390\" />\r\n          <option name=\"screenX\" value=\"1008\" />\r\n          <option name=\"screenY\" value=\"2244\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"30\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"java\" />\r\n          <option name=\"id\" value=\"java\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"G20\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1600\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"kansas\" />\r\n          <option name=\"id\" value=\"kansas\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g - 2025\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1604\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"komodo\" />\r\n          <option name=\"id\" value=\"komodo\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro XL\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"1008\" />\r\n          <option name=\"screenY\" value=\"2244\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"komodo\" />\r\n          <option name=\"id\" value=\"komodo\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9 Pro XL\" />\r\n          <option name=\"screenDensity\" value=\"360\" />\r\n          <option name=\"screenX\" value=\"1008\" />\r\n          <option name=\"screenY\" value=\"2244\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"lion\" />\r\n          <option name=\"id\" value=\"lion\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g04\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1612\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"lynx\" />\r\n          <option name=\"id\" value=\"lynx\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 7a\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"lyriq\" />\r\n          <option name=\"id\" value=\"lyriq\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"edge 40\" />\r\n          <option name=\"screenDensity\" value=\"400\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"manaus\" />\r\n          <option name=\"id\" value=\"manaus\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"edge 40 neo\" />\r\n          <option name=\"screenDensity\" value=\"400\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"motorola\" />\r\n          <option name=\"codename\" value=\"maui\" />\r\n          <option name=\"id\" value=\"maui\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Motorola\" />\r\n          <option name=\"name\" value=\"moto g play - 2023\" />\r\n          <option name=\"screenDensity\" value=\"280\" />\r\n          <option name=\"screenX\" value=\"720\" />\r\n          <option name=\"screenY\" value=\"1600\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"36\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"mustang\" />\r\n          <option name=\"id\" value=\"mustang\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 10 Pro XL\" />\r\n          <option name=\"screenDensity\" value=\"390\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2404\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"o1q\" />\r\n          <option name=\"id\" value=\"o1q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S21\" />\r\n          <option name=\"screenDensity\" value=\"421\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"31\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"oriole\" />\r\n          <option name=\"id\" value=\"oriole\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 6\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"pa3q\" />\r\n          <option name=\"id\" value=\"pa3q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S25 Ultra\" />\r\n          <option name=\"screenDensity\" value=\"600\" />\r\n          <option name=\"screenX\" value=\"1440\" />\r\n          <option name=\"screenY\" value=\"3120\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"panther\" />\r\n          <option name=\"id\" value=\"panther\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 7\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"q5q\" />\r\n          <option name=\"id\" value=\"q5q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Z Fold5\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1812\" />\r\n          <option name=\"screenY\" value=\"2176\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"q6q\" />\r\n          <option name=\"id\" value=\"q6q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy Z Fold6\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1856\" />\r\n          <option name=\"screenY\" value=\"2160\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"30\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"r11\" />\r\n          <option name=\"formFactor\" value=\"Wear OS\" />\r\n          <option name=\"id\" value=\"r11\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel Watch\" />\r\n          <option name=\"screenDensity\" value=\"320\" />\r\n          <option name=\"screenX\" value=\"384\" />\r\n          <option name=\"screenY\" value=\"384\" />\r\n          <option name=\"type\" value=\"WEAR_OS\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"r11q\" />\r\n          <option name=\"id\" value=\"r11q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-S711U\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"36\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"rango\" />\r\n          <option name=\"id\" value=\"rango\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 10 Pro Fold\" />\r\n          <option name=\"screenDensity\" value=\"390\" />\r\n          <option name=\"screenX\" value=\"2076\" />\r\n          <option name=\"screenY\" value=\"2152\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"30\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"redfin\" />\r\n          <option name=\"id\" value=\"redfin\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 5\" />\r\n          <option name=\"screenDensity\" value=\"440\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2340\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"shiba\" />\r\n          <option name=\"id\" value=\"shiba\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 8\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"t2q\" />\r\n          <option name=\"id\" value=\"t2q\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"Galaxy S21 Plus\" />\r\n          <option name=\"screenDensity\" value=\"394\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2400\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"33\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"tangorpro\" />\r\n          <option name=\"formFactor\" value=\"Tablet\" />\r\n          <option name=\"id\" value=\"tangorpro\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel Tablet\" />\r\n          <option name=\"screenDensity\" value=\"320\" />\r\n          <option name=\"screenX\" value=\"1600\" />\r\n          <option name=\"screenY\" value=\"2560\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"tegu\" />\r\n          <option name=\"id\" value=\"tegu\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9a\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2424\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"tokay\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"tokay\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2424\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"35\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"tokay\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"tokay\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2424\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"36\" />\r\n          <option name=\"brand\" value=\"google\" />\r\n          <option name=\"codename\" value=\"tokay\" />\r\n          <option name=\"default\" value=\"true\" />\r\n          <option name=\"id\" value=\"tokay\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Google\" />\r\n          <option name=\"name\" value=\"Pixel 9\" />\r\n          <option name=\"screenDensity\" value=\"420\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2424\" />\r\n        </PersistentDeviceSelectionData>\r\n        <PersistentDeviceSelectionData>\r\n          <option name=\"api\" value=\"34\" />\r\n          <option name=\"brand\" value=\"samsung\" />\r\n          <option name=\"codename\" value=\"xcover7\" />\r\n          <option name=\"id\" value=\"xcover7\" />\r\n          <option name=\"labId\" value=\"google\" />\r\n          <option name=\"manufacturer\" value=\"Samsung\" />\r\n          <option name=\"name\" value=\"SM-G556B\" />\r\n          <option name=\"screenDensity\" value=\"450\" />\r\n          <option name=\"screenX\" value=\"1080\" />\r\n          <option name=\"screenY\" value=\"2408\" />\r\n        </PersistentDeviceSelectionData>\r\n      </list>\r\n    </option>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/caches/deviceStreaming.xml b/.idea/caches/deviceStreaming.xml
--- a/.idea/caches/deviceStreaming.xml	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/.idea/caches/deviceStreaming.xml	(date 1764209298848)
@@ -101,6 +101,18 @@
           <option name="screenY" value="1920" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="a06" />
+          <option name="id" value="a06" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="Galaxy A06" />
+          <option name="screenDensity" value="300" />
+          <option name="screenX" value="720" />
+          <option name="screenY" value="1600" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
           <option name="api" value="34" />
           <option name="brand" value="samsung" />
           <option name="codename" value="a14m" />
@@ -161,6 +173,18 @@
           <option name="screenY" value="2340" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
+          <option name="api" value="36" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="a26x" />
+          <option name="id" value="a26x" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="SM-A266B" />
+          <option name="screenDensity" value="450" />
+          <option name="screenX" value="1080" />
+          <option name="screenY" value="2340" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
           <option name="api" value="34" />
           <option name="brand" value="samsung" />
           <option name="codename" value="a35x" />
@@ -175,11 +199,35 @@
         <PersistentDeviceSelectionData>
           <option name="api" value="35" />
           <option name="brand" value="samsung" />
+          <option name="codename" value="a35x" />
+          <option name="id" value="a35x" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="A35" />
+          <option name="screenDensity" value="450" />
+          <option name="screenX" value="1080" />
+          <option name="screenY" value="2340" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="samsung" />
           <option name="codename" value="a36xq" />
           <option name="id" value="a36xq" />
           <option name="labId" value="google" />
           <option name="manufacturer" value="Samsung" />
           <option name="name" value="SM-A366E" />
+          <option name="screenDensity" value="450" />
+          <option name="screenX" value="1080" />
+          <option name="screenY" value="2340" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="a56x" />
+          <option name="id" value="a56x" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="SM-A566E" />
           <option name="screenDensity" value="450" />
           <option name="screenX" value="1080" />
           <option name="screenY" value="2340" />
@@ -341,6 +389,18 @@
           <option name="screenDensity" value="420" />
           <option name="screenX" value="2220" />
           <option name="screenY" value="1080" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="dm1q" />
+          <option name="id" value="dm1q" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="S23" />
+          <option name="screenDensity" value="480" />
+          <option name="screenX" value="1080" />
+          <option name="screenY" value="2340" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
           <option name="api" value="34" />
@@ -646,6 +706,18 @@
           <option name="screenY" value="2244" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="motorola" />
+          <option name="codename" value="lamul" />
+          <option name="id" value="lamul" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Motorola" />
+          <option name="name" value="moto g05" />
+          <option name="screenDensity" value="280" />
+          <option name="screenX" value="720" />
+          <option name="screenY" value="1604" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
           <option name="api" value="34" />
           <option name="brand" value="motorola" />
           <option name="codename" value="lion" />
@@ -742,6 +814,18 @@
           <option name="screenY" value="2400" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
+          <option name="api" value="36" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="pa2q" />
+          <option name="id" value="pa2q" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="S25+" />
+          <option name="screenDensity" value="450" />
+          <option name="screenX" value="1080" />
+          <option name="screenY" value="2340" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
           <option name="api" value="35" />
           <option name="brand" value="samsung" />
           <option name="codename" value="pa3q" />
@@ -764,6 +848,18 @@
           <option name="screenDensity" value="420" />
           <option name="screenX" value="1080" />
           <option name="screenY" value="2400" />
+        </PersistentDeviceSelectionData>
+        <PersistentDeviceSelectionData>
+          <option name="api" value="35" />
+          <option name="brand" value="samsung" />
+          <option name="codename" value="psq" />
+          <option name="id" value="psq" />
+          <option name="labId" value="google" />
+          <option name="manufacturer" value="Samsung" />
+          <option name="name" value="Galaxy S25 Edge" />
+          <option name="screenDensity" value="450" />
+          <option name="screenX" value="1440" />
+          <option name="screenY" value="3120" />
         </PersistentDeviceSelectionData>
         <PersistentDeviceSelectionData>
           <option name="api" value="34" />
Index: lib/Views/Solicitudes/solicitudes_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Archivo: 'solicitudes_page.dart'\r\nimport 'package:flutter/material.dart';\r\nimport '../../utils/session_manager.dart'; // Importaciones originales\r\nimport '../../utils/solicitud_service.dart';\r\nimport '../widgets/header.dart';\r\nimport '../widgets/bottom_navigation.dart';\r\n\r\nclass SolicitudesPage extends StatefulWidget {\r\n  const SolicitudesPage({super.key});\r\n\r\n  @override\r\n  State<SolicitudesPage> createState() => _SolicitudesPageState();\r\n}\r\n\r\nclass _SolicitudesPageState extends State<SolicitudesPage> {\r\n  // Las solicitudes ahora contienen la data de la RESERVA (que incluye cliente, etc.)\r\n  List<Map<String, dynamic>> solicitudes = [];\r\n  bool _isLoading = true;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _loadSolicitudes();\r\n  }\r\n\r\n  // Funci칩n de carga de solicitudes (ahora m치s simple gracias al SolicitudService corregido)\r\n  Future<void> _loadSolicitudes() async {\r\n    if (solicitudes.isEmpty) {\r\n      setState(() {\r\n        _isLoading = true;\r\n      });\r\n    }\r\n\r\n    try {\r\n      await Future.delayed(const Duration(milliseconds: 300));\r\n\r\n      // 1. Llamamos al servicio (que ahora extrae 'reservas_solicitudes'['data'])\r\n      final rawData = await SolicitudService.listarSolicitudes();\r\n\r\n      // 2. Convertimos la data limpia\r\n      final List<Map<String, dynamic>> registros =\r\n          List<Map<String, dynamic>>.from(rawData);\r\n\r\n      if (mounted) {\r\n        setState(() {\r\n          solicitudes = registros;\r\n          _isLoading = false;\r\n        });\r\n      }\r\n    } catch (e) {\r\n      debugPrint(\"Error cargando solicitudes: $e\");\r\n      if (mounted) {\r\n        setState(() {\r\n          _isLoading = false;\r\n        });\r\n        // Muestra el error al usuario\r\n        ScaffoldMessenger.of(context).showSnackBar(\r\n          SnackBar(\r\n            content: Text('Error al cargar solicitudes: ${e.toString()}'),\r\n            backgroundColor: Colors.red,\r\n          ),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  Future<void> _responderSolicitud(int solicitudChoferId, int estado) async {\r\n    try {\r\n      await SolicitudService.responderSolicitud(\r\n        solicitudChoferId: solicitudChoferId,\r\n        estado: estado,\r\n      );\r\n\r\n      final mensaje = estado == 1\r\n          ? 'Solicitud aceptada correctamente'\r\n          : 'Solicitud rechazada';\r\n\r\n      ScaffoldMessenger.of(context).showSnackBar(\r\n        SnackBar(\r\n          content: Text(mensaje),\r\n          backgroundColor: estado == 1 ? Colors.green : Colors.red,\r\n        ),\r\n      );\r\n\r\n      // El ID de la solicitud de chofer est치 ANIDADO\r\n      // Lo que se debe eliminar de la lista local es la RESERVA,\r\n      // cuyo ID es el 'id' del elemento de la lista.\r\n      setState(() {\r\n        // Usamos el id de la SOLICITUD_CHOFER para la condici칩n de eliminaci칩n\r\n        solicitudes.removeWhere((s) {\r\n          final solicitudChofer =\r\n              s['solicitud_chofer'] as Map<String, dynamic>?;\r\n          final idSolicitudChofer = solicitudChofer?['id'];\r\n\r\n          // Compara el ID de la solicitud_chofer con el ID que se acaba de responder\r\n          return idSolicitudChofer != null &&\r\n              idSolicitudChofer.toString() == solicitudChoferId.toString();\r\n        });\r\n      });\r\n    } catch (e) {\r\n      ScaffoldMessenger.of(context).showSnackBar(\r\n        SnackBar(\r\n          content: Text('Error: ${e.toString()}'),\r\n          backgroundColor: Colors.red,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  // Widget para el estado de lista vac칤a que permite recargar\r\n  Widget _buildEmptyStateWithRefresh(BuildContext context) {\r\n    return RefreshIndicator(\r\n      onRefresh: _loadSolicitudes, // Conecta la funci칩n de recarga\r\n      child: LayoutBuilder(\r\n        builder: (context, constraints) {\r\n          return SingleChildScrollView(\r\n            physics: const AlwaysScrollableScrollPhysics(),\r\n            child: ConstrainedBox(\r\n              constraints: BoxConstraints(minHeight: constraints.maxHeight),\r\n              child: const Center(child: Text('No hay solicitudes pendientes')),\r\n            ),\r\n          );\r\n        },\r\n      ),\r\n    );\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[100],\r\n      body: SafeArea(\r\n        child: Column(\r\n          children: [\r\n            const LogoHeader(titulo: 'Asignaciones', estiloLogin: false),\r\n            Expanded(\r\n              child: _isLoading\r\n                  ? const Center(child: CircularProgressIndicator())\r\n                  : solicitudes.isEmpty\r\n                  ? _buildEmptyStateWithRefresh(context)\r\n                  : RefreshIndicator(\r\n                      onRefresh: _loadSolicitudes,\r\n                      child: ListView.builder(\r\n                        physics: const AlwaysScrollableScrollPhysics(),\r\n                        padding: const EdgeInsets.all(16),\r\n                        itemCount: solicitudes.length,\r\n                        itemBuilder: (context, index) {\r\n                          final s = solicitudes[index];\r\n\r\n                          // La data de la reserva es 's' misma en este endpoint, pero\r\n                          // tu c칩digo original usaba 'reserva', lo corrijo para usar 's' directamente.\r\n                          // Pero lo m치s importante: extraemos la SOLICITUD_CHOFER para obtener el ID de respuesta.\r\n                          final reserva = s; // s es la reserva\r\n                          final cliente = reserva['cliente'] ?? {};\r\n                          final solicitudChofer =\r\n                              reserva['solicitud_chofer'] ?? {};\r\n\r\n                          // ESTA ES LA CLAVE PARA PASAR EL ID CORRECTO A LA FUNCI칍N DE RESPUESTA\r\n                          final idSolicitudChofer =\r\n                              int.tryParse(\r\n                                solicitudChofer['id']?.toString() ?? '0',\r\n                              ) ??\r\n                              0;\r\n\r\n                          final nombreCliente =\r\n                              '${cliente['nombres'] ?? ''} ${cliente['apellidos'] ?? ''}'\r\n                                  .trim()\r\n                                  .isEmpty\r\n                              ? 'Usuario'\r\n                              : '${cliente['nombres']} ${cliente['apellidos']}';\r\n\r\n                          final fechaCompleta =\r\n                              reserva['fecha_hora']?.toString() ?? '---';\r\n                          final partesFechaHora = fechaCompleta.split(' ');\r\n                          final fecha = partesFechaHora.isNotEmpty\r\n                              ? partesFechaHora[0]\r\n                              : '---';\r\n                          final hora = partesFechaHora.length > 1\r\n                              ? partesFechaHora[1]\r\n                              : '---';\r\n\r\n                          final espera =\r\n                              reserva['tiempo_espera']?.toString() ?? '---';\r\n                          final direccion =\r\n                              reserva['d_encuentro']?.toString() ?? '---';\r\n\r\n                          return Column(\r\n                            children: [\r\n                              _SolicitudCard(\r\n                                cliente: nombreCliente,\r\n                                fecha: fecha,\r\n                                hora: hora,\r\n                                espera: espera,\r\n                                direccion: direccion,\r\n                                // Pasamos el ID de la solicitud_chofer ANIDADA\r\n                                onAceptar: () =>\r\n                                    _responderSolicitud(idSolicitudChofer, 1),\r\n                                onRechazar: () =>\r\n                                    _responderSolicitud(idSolicitudChofer, 0),\r\n                              ),\r\n                              const SizedBox(height: 16),\r\n                            ],\r\n                          );\r\n                        },\r\n                      ),\r\n                    ),\r\n            ),\r\n            const CustomBottomNavBar(),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\nclass _SolicitudCard extends StatelessWidget {\r\n  // ... (El c칩digo de _SolicitudCard se mantiene igual)\r\n  final String cliente;\r\n  final String fecha;\r\n  final String hora;\r\n  final String espera;\r\n  final String direccion;\r\n  final VoidCallback onAceptar;\r\n  final VoidCallback onRechazar;\r\n\r\n  const _SolicitudCard({\r\n    required this.cliente,\r\n    required this.fecha,\r\n    required this.hora,\r\n    required this.espera,\r\n    required this.direccion,\r\n    required this.onAceptar,\r\n    required this.onRechazar,\r\n  });\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Card(\r\n      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)),\r\n      elevation: 3,\r\n      child: Padding(\r\n        padding: const EdgeInsets.all(12),\r\n        child: Column(\r\n          crossAxisAlignment: CrossAxisAlignment.start,\r\n          children: [\r\n            Container(\r\n              width: double.infinity,\r\n              padding: const EdgeInsets.symmetric(vertical: 6),\r\n              decoration: BoxDecoration(\r\n                color: Colors.amber,\r\n                borderRadius: BorderRadius.circular(8),\r\n              ),\r\n              child: const Center(\r\n                child: Text(\r\n                  'Asignaci칩n',\r\n                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 18),\r\n                ),\r\n              ),\r\n            ),\r\n            const SizedBox(height: 8),\r\n            Text(\r\n              'Cliente: $cliente',\r\n              style: const TextStyle(fontWeight: FontWeight.bold),\r\n            ),\r\n            const SizedBox(height: 4),\r\n            Text('Fecha de reserva: $fecha'),\r\n            const SizedBox(height: 4),\r\n            Row(children: [Text('Hora Recogida: $hora')]),\r\n            Row(\r\n              children: [\r\n                const Text(\r\n                  'Tiempo de espera: ',\r\n                  style: TextStyle(fontWeight: FontWeight.bold),\r\n                ),\r\n                Text(\r\n                  espera,\r\n                  style: const TextStyle(fontWeight: FontWeight.bold),\r\n                ),\r\n              ],\r\n            ),\r\n            const SizedBox(height: 4),\r\n            Text('Direcci칩n de encuentro: $direccion'),\r\n            const SizedBox(height: 12),\r\n            Row(\r\n              mainAxisAlignment: MainAxisAlignment.spaceEvenly,\r\n              children: [\r\n                Expanded(\r\n                  child: ElevatedButton(\r\n                    style: ElevatedButton.styleFrom(\r\n                      backgroundColor: Colors.green,\r\n                      foregroundColor: Colors.white,\r\n                      shape: RoundedRectangleBorder(\r\n                        borderRadius: BorderRadius.circular(16),\r\n                      ),\r\n                    ),\r\n                    onPressed: onAceptar,\r\n                    child: const Text('Aceptar'),\r\n                  ),\r\n                ),\r\n                const SizedBox(width: 16),\r\n                Expanded(\r\n                  child: ElevatedButton(\r\n                    style: ElevatedButton.styleFrom(\r\n                      backgroundColor: Colors.red,\r\n                      foregroundColor: Colors.white,\r\n                      shape: RoundedRectangleBorder(\r\n                        borderRadius: BorderRadius.circular(16),\r\n                      ),\r\n                    ),\r\n                    onPressed: onRechazar,\r\n                    child: const Text('Rechazar'),\r\n                  ),\r\n                ),\r\n              ],\r\n            ),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Solicitudes/solicitudes_page.dart b/lib/Views/Solicitudes/solicitudes_page.dart
--- a/lib/Views/Solicitudes/solicitudes_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Solicitudes/solicitudes_page.dart	(date 1764209281812)
@@ -1,6 +1,5 @@
-// Archivo: 'solicitudes_page.dart'
 import 'package:flutter/material.dart';
-import '../../utils/session_manager.dart'; // Importaciones originales
+import '../../utils/session_manager.dart';
 import '../../utils/solicitud_service.dart';
 import '../widgets/header.dart';
 import '../widgets/bottom_navigation.dart';
@@ -13,7 +12,6 @@
 }
 
 class _SolicitudesPageState extends State<SolicitudesPage> {
-  // Las solicitudes ahora contienen la data de la RESERVA (que incluye cliente, etc.)
   List<Map<String, dynamic>> solicitudes = [];
   bool _isLoading = true;
 
@@ -23,45 +21,27 @@
     _loadSolicitudes();
   }
 
-  // Funci칩n de carga de solicitudes (ahora m치s simple gracias al SolicitudService corregido)
+  // Funci칩n de carga de solicitudes que se usa para la carga inicial y el refresh
   Future<void> _loadSolicitudes() async {
-    if (solicitudes.isEmpty) {
-      setState(() {
-        _isLoading = true;
-      });
-    }
-
-    try {
-      await Future.delayed(const Duration(milliseconds: 300));
+    // Simula un tiempo de carga breve para que el RefreshIndicator se vea
+    await Future.delayed(const Duration(milliseconds: 300));
 
-      // 1. Llamamos al servicio (que ahora extrae 'reservas_solicitudes'['data'])
-      final rawData = await SolicitudService.listarSolicitudes();
+    final data = await SessionManager.getSolicitudes();
+    List<Map<String, dynamic>> registros = [];
 
-      // 2. Convertimos la data limpia
-      final List<Map<String, dynamic>> registros =
-          List<Map<String, dynamic>>.from(rawData);
+    if (data.isNotEmpty) {
+      final primer = data.first;
+      if (primer.containsKey('data') && primer['data'] is List) {
+        registros = List<Map<String, dynamic>>.from(primer['data']);
+      } else if (data is List) {
+        registros = List<Map<String, dynamic>>.from(data);
+      }
+    }
 
-      if (mounted) {
-        setState(() {
-          solicitudes = registros;
-          _isLoading = false;
-        });
-      }
-    } catch (e) {
-      debugPrint("Error cargando solicitudes: $e");
-      if (mounted) {
-        setState(() {
-          _isLoading = false;
-        });
-        // Muestra el error al usuario
-        ScaffoldMessenger.of(context).showSnackBar(
-          SnackBar(
-            content: Text('Error al cargar solicitudes: ${e.toString()}'),
-            backgroundColor: Colors.red,
-          ),
-        );
-      }
-    }
+    setState(() {
+      solicitudes = registros;
+      _isLoading = false;
+    });
   }
 
   Future<void> _responderSolicitud(int solicitudChoferId, int estado) async {
@@ -71,53 +51,48 @@
         estado: estado,
       );
 
-      final mensaje = estado == 1
-          ? 'Solicitud aceptada correctamente'
-          : 'Solicitud rechazada';
-
       ScaffoldMessenger.of(context).showSnackBar(
         SnackBar(
-          content: Text(mensaje),
+          content: Text(
+            estado == 1
+                ? 'Solicitud aceptada correctamente'
+                : 'Solicitud rechazada',
+          ),
           backgroundColor: estado == 1 ? Colors.green : Colors.red,
         ),
       );
 
-      // El ID de la solicitud de chofer est치 ANIDADO
-      // Lo que se debe eliminar de la lista local es la RESERVA,
-      // cuyo ID es el 'id' del elemento de la lista.
+      // eliminar la solicitud de la lista local
       setState(() {
-        // Usamos el id de la SOLICITUD_CHOFER para la condici칩n de eliminaci칩n
-        solicitudes.removeWhere((s) {
-          final solicitudChofer =
-              s['solicitud_chofer'] as Map<String, dynamic>?;
-          final idSolicitudChofer = solicitudChofer?['id'];
-
-          // Compara el ID de la solicitud_chofer con el ID que se acaba de responder
-          return idSolicitudChofer != null &&
-              idSolicitudChofer.toString() == solicitudChoferId.toString();
-        });
+        solicitudes.removeWhere(
+          (s) =>
+              s['id'] == solicitudChoferId ||
+              s['solicitud_chofer_id'] == solicitudChoferId,
+        );
       });
     } catch (e) {
       ScaffoldMessenger.of(context).showSnackBar(
-        SnackBar(
-          content: Text('Error: ${e.toString()}'),
-          backgroundColor: Colors.red,
-        ),
+        SnackBar(content: Text('Error: $e'), backgroundColor: Colors.red),
       );
     }
   }
 
   // Widget para el estado de lista vac칤a que permite recargar
+  // Se usa LayoutBuilder para calcular la altura restante de forma din치mica y correcta.
   Widget _buildEmptyStateWithRefresh(BuildContext context) {
     return RefreshIndicator(
       onRefresh: _loadSolicitudes, // Conecta la funci칩n de recarga
       child: LayoutBuilder(
         builder: (context, constraints) {
+          // El SingleChildScrollView asegura que la f칤sica del scroll sea siempre activa
           return SingleChildScrollView(
             physics: const AlwaysScrollableScrollPhysics(),
             child: ConstrainedBox(
-              constraints: BoxConstraints(minHeight: constraints.maxHeight),
-              child: const Center(child: Text('No hay solicitudes pendientes')),
+              constraints: BoxConstraints(
+                // Usa la altura disponible para centrar correctamente el mensaje
+                minHeight: constraints.maxHeight,
+              ),
+              child: const Center(child: Text('No hay solicitudes')),
             ),
           );
         },
@@ -137,30 +112,23 @@
               child: _isLoading
                   ? const Center(child: CircularProgressIndicator())
                   : solicitudes.isEmpty
-                  ? _buildEmptyStateWithRefresh(context)
+                  ? _buildEmptyStateWithRefresh(
+                      context,
+                    ) // Usa la funci칩n corregida
                   : RefreshIndicator(
-                      onRefresh: _loadSolicitudes,
+                      onRefresh:
+                          _loadSolicitudes, // Implementaci칩n del RefreshIndicator
                       child: ListView.builder(
-                        physics: const AlwaysScrollableScrollPhysics(),
+                        physics:
+                            const AlwaysScrollableScrollPhysics(), // Esencial para el RefreshIndicator
                         padding: const EdgeInsets.all(16),
                         itemCount: solicitudes.length,
                         itemBuilder: (context, index) {
                           final s = solicitudes[index];
-
-                          // La data de la reserva es 's' misma en este endpoint, pero
-                          // tu c칩digo original usaba 'reserva', lo corrijo para usar 's' directamente.
-                          // Pero lo m치s importante: extraemos la SOLICITUD_CHOFER para obtener el ID de respuesta.
-                          final reserva = s; // s es la reserva
+                          final reserva = s['reserva'] ?? {};
                           final cliente = reserva['cliente'] ?? {};
-                          final solicitudChofer =
-                              reserva['solicitud_chofer'] ?? {};
-
-                          // ESTA ES LA CLAVE PARA PASAR EL ID CORRECTO A LA FUNCI칍N DE RESPUESTA
-                          final idSolicitudChofer =
-                              int.tryParse(
-                                solicitudChofer['id']?.toString() ?? '0',
-                              ) ??
-                              0;
+                          final idSolicitud =
+                              s['id'] ?? s['solicitud_chofer_id'] ?? 0;
 
                           final nombreCliente =
                               '${cliente['nombres'] ?? ''} ${cliente['apellidos'] ?? ''}'
@@ -171,12 +139,9 @@
 
                           final fechaCompleta =
                               reserva['fecha_hora']?.toString() ?? '---';
-                          final partesFechaHora = fechaCompleta.split(' ');
-                          final fecha = partesFechaHora.isNotEmpty
-                              ? partesFechaHora[0]
-                              : '---';
-                          final hora = partesFechaHora.length > 1
-                              ? partesFechaHora[1]
+                          final fecha = fechaCompleta.split(' ')[0];
+                          final hora = fechaCompleta.split(' ').length > 1
+                              ? fechaCompleta.split(' ')[1]
                               : '---';
 
                           final espera =
@@ -192,11 +157,10 @@
                                 hora: hora,
                                 espera: espera,
                                 direccion: direccion,
-                                // Pasamos el ID de la solicitud_chofer ANIDADA
                                 onAceptar: () =>
-                                    _responderSolicitud(idSolicitudChofer, 1),
+                                    _responderSolicitud(idSolicitud, 1),
                                 onRechazar: () =>
-                                    _responderSolicitud(idSolicitudChofer, 0),
+                                    _responderSolicitud(idSolicitud, 0),
                               ),
                               const SizedBox(height: 16),
                             ],
@@ -214,7 +178,8 @@
 }
 
 class _SolicitudCard extends StatelessWidget {
-  // ... (El c칩digo de _SolicitudCard se mantiene igual)
+  // ... (C칩digo de _SolicitudCard sin cambios)
+  // Este c칩digo es id칠ntico a tu original
   final String cliente;
   final String fecha;
   final String hora;
Index: lib/Views/Viaje/viaje_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Viaje/viaje_page.dart b/lib/Views/Viaje/viaje_page.dart
--- a/lib/Views/Viaje/viaje_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Viaje/viaje_page.dart	(date 1764209281855)
@@ -1,0 +1,1 @@
+//Pagina
\ No newline at end of file
Index: .idea/libraries/Flutter_Plugins.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><component name=\"libraryTable\">\r\n  <library name=\"Flutter Plugins\" type=\"FlutterPluginsLibraryType\">\r\n    <CLASSES>\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_windows-2.4.1\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_android-2.4.13\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_foundation-2.5.4\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_web-2.4.3\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences-2.5.3\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_windows-2.3.0\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_linux-2.4.1\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_linux-2.2.1\" />\r\n    </CLASSES>\r\n    <JAVADOC />\r\n    <SOURCES />\r\n  </library>\r\n</component>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/libraries/Flutter_Plugins.xml b/.idea/libraries/Flutter_Plugins.xml
--- a/.idea/libraries/Flutter_Plugins.xml	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/.idea/libraries/Flutter_Plugins.xml	(date 1764209298858)
@@ -3,7 +3,10 @@
     <CLASSES>
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_windows-2.4.1" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_android-2.4.13" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_android-0.9.0+2" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_apple-0.9.1+2" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_foundation-2.5.4" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager-0.9.0+3" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_web-2.4.3" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences-2.5.3" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_windows-2.3.0" />
Index: .idea/libraries/Dart_Packages.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><component name=\"libraryTable\">\r\n  <library name=\"Dart Packages\" type=\"DartPackagesLibraryType\">\r\n    <properties>\r\n      <option name=\"packageNameToDirsMap\">\r\n        <entry key=\"async\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/async-2.13.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"boolean_selector\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/boolean_selector-2.1.2/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"characters\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/characters-1.4.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"clock\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/clock-1.1.2/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"collection\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/collection-1.19.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"cupertino_icons\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/cupertino_icons-1.0.8/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"fake_async\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/fake_async-1.3.3/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"ffi\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/ffi-2.1.4/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"file\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/file-7.0.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"flutter\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$PROJECT_DIR$/../../../../../flutter/packages/flutter/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"flutter_lints\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/flutter_lints-5.0.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"flutter_test\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$PROJECT_DIR$/../../../../../flutter/packages/flutter_test/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"flutter_web_plugins\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$PROJECT_DIR$/../../../../../flutter/packages/flutter_web_plugins/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"http\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.5.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"http_parser\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http_parser-4.1.2/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"leak_tracker\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker-10.0.9/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"leak_tracker_flutter_testing\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker_flutter_testing-3.0.9/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"leak_tracker_testing\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker_testing-3.0.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"lints\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/lints-5.1.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"matcher\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/matcher-0.12.17/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"material_color_utilities\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/material_color_utilities-0.11.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"meta\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/meta-1.16.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"path\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path-1.9.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"path_provider_linux\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_linux-2.2.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"path_provider_platform_interface\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_platform_interface-2.1.2/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"path_provider_windows\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_windows-2.3.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"platform\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/platform-3.1.6/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"plugin_platform_interface\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/plugin_platform_interface-2.1.8/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences-2.5.3/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_android\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_android-2.4.13/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_foundation\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_foundation-2.5.4/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_linux\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_linux-2.4.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_platform_interface\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_platform_interface-2.4.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_web\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_web-2.4.3/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"shared_preferences_windows\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_windows-2.4.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"sky_engine\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$PROJECT_DIR$/../../../../../flutter/bin/cache/pkg/sky_engine/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"source_span\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/source_span-1.10.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"stack_trace\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/stack_trace-1.12.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"stream_channel\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/stream_channel-2.1.4/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"string_scanner\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/string_scanner-1.4.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"term_glyph\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/term_glyph-1.2.2/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"test_api\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/test_api-0.7.4/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"typed_data\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/typed_data-1.4.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"vector_math\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vector_math-2.1.4/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"vm_service\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vm_service-15.0.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"web\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/web-1.1.1/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"xdg_directories\">\r\n          <value>\r\n            <list>\r\n              <option value=\"$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/xdg_directories-1.1.0/lib\" />\r\n            </list>\r\n          </value>\r\n        </entry>\r\n      </option>\r\n    </properties>\r\n    <CLASSES>\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/async-2.13.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/boolean_selector-2.1.2/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/characters-1.4.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/clock-1.1.2/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/collection-1.19.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/cupertino_icons-1.0.8/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/fake_async-1.3.3/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/ffi-2.1.4/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/file-7.0.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/flutter_lints-5.0.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.5.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http_parser-4.1.2/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker-10.0.9/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker_flutter_testing-3.0.9/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker_testing-3.0.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/lints-5.1.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/matcher-0.12.17/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/material_color_utilities-0.11.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/meta-1.16.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path-1.9.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_linux-2.2.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_platform_interface-2.1.2/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/path_provider_windows-2.3.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/platform-3.1.6/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/plugin_platform_interface-2.1.8/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences-2.5.3/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_android-2.4.13/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_foundation-2.5.4/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_linux-2.4.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_platform_interface-2.4.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_web-2.4.3/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/shared_preferences_windows-2.4.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/source_span-1.10.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/stack_trace-1.12.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/stream_channel-2.1.4/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/string_scanner-1.4.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/term_glyph-1.2.2/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/test_api-0.7.4/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/typed_data-1.4.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vector_math-2.1.4/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vm_service-15.0.0/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/web-1.1.1/lib\" />\r\n      <root url=\"file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/xdg_directories-1.1.0/lib\" />\r\n      <root url=\"file://$PROJECT_DIR$/../../../../../flutter/bin/cache/pkg/sky_engine/lib\" />\r\n      <root url=\"file://$PROJECT_DIR$/../../../../../flutter/packages/flutter/lib\" />\r\n      <root url=\"file://$PROJECT_DIR$/../../../../../flutter/packages/flutter_test/lib\" />\r\n      <root url=\"file://$PROJECT_DIR$/../../../../../flutter/packages/flutter_web_plugins/lib\" />\r\n    </CLASSES>\r\n    <JAVADOC />\r\n    <SOURCES />\r\n  </library>\r\n</component>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/libraries/Dart_Packages.xml b/.idea/libraries/Dart_Packages.xml
--- a/.idea/libraries/Dart_Packages.xml	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/.idea/libraries/Dart_Packages.xml	(date 1764209298874)
@@ -96,7 +96,7 @@
         <entry key="http">
           <value>
             <list>
-              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.5.0/lib" />
+              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.6.0/lib" />
             </list>
           </value>
         </entry>
@@ -324,6 +324,34 @@
             </list>
           </value>
         </entry>
+        <entry key="workmanager">
+          <value>
+            <list>
+              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager-0.9.0+3/lib" />
+            </list>
+          </value>
+        </entry>
+        <entry key="workmanager_android">
+          <value>
+            <list>
+              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_android-0.9.0+2/lib" />
+            </list>
+          </value>
+        </entry>
+        <entry key="workmanager_apple">
+          <value>
+            <list>
+              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_apple-0.9.1+2/lib" />
+            </list>
+          </value>
+        </entry>
+        <entry key="workmanager_platform_interface">
+          <value>
+            <list>
+              <option value="$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_platform_interface-0.9.1+1/lib" />
+            </list>
+          </value>
+        </entry>
         <entry key="xdg_directories">
           <value>
             <list>
@@ -344,7 +372,7 @@
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/ffi-2.1.4/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/file-7.0.1/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/flutter_lints-5.0.0/lib" />
-      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.5.0/lib" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http-1.6.0/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/http_parser-4.1.2/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker-10.0.9/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/leak_tracker_flutter_testing-3.0.9/lib" />
@@ -376,6 +404,10 @@
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vector_math-2.1.4/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/vm_service-15.0.0/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/web-1.1.1/lib" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager-0.9.0+3/lib" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_android-0.9.0+2/lib" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_apple-0.9.1+2/lib" />
+      <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/workmanager_platform_interface-0.9.1+1/lib" />
       <root url="file://$USER_HOME$/AppData/Local/Pub/Cache/hosted/pub.dev/xdg_directories-1.1.0/lib" />
       <root url="file://$PROJECT_DIR$/../../../../../flutter/bin/cache/pkg/sky_engine/lib" />
       <root url="file://$PROJECT_DIR$/../../../../../flutter/packages/flutter/lib" />
Index: lib/utils/solicitud_service.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import 'dart:convert';\r\nimport 'package:http/http.dart' as http;\r\nimport 'package:shared_preferences/shared_preferences.dart';\r\n\r\nclass SolicitudService {\r\n  static const String _baseUrl = \"http://servidorcorman.dyndns.org:7019/api\";\r\n\r\n  static Future<Map<String, dynamic>> responderSolicitud({\r\n    required int solicitudChoferId,\r\n    required int estado, // 0 = declinar, 1 = aceptar\r\n  }) async {\r\n    final prefs = await SharedPreferences.getInstance();\r\n    final token = prefs.getString(\"auth_token\");\r\n    final idUser = prefs.getInt(\"user_id\");\r\n\r\n    if (token == null || idUser == null) {\r\n      throw Exception(\"Faltan datos de sesi칩n (token o user_id)\");\r\n    }\r\n\r\n    final url = Uri.parse(\r\n      \"$_baseUrl/reservas/chofer/asignacion/$solicitudChoferId\",\r\n    );\r\n\r\n    final body = jsonEncode({\r\n      \"id_user\": idUser,\r\n      \"solicitud_chofer_id\": solicitudChoferId,\r\n      \"estado\": estado,\r\n    });\r\n\r\n    final response = await http.post(\r\n      url,\r\n      headers: {\r\n        \"Authorization\": \"Bearer $token\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: body,\r\n    );\r\n\r\n    if (response.statusCode == 200) {\r\n      final data = jsonDecode(response.body);\r\n      if (data[\"status\"] == \"success\") {\r\n        return data[\"data\"];\r\n      } else {\r\n        throw Exception(\"Error l칩gico: ${data[\"status\"]}\");\r\n      }\r\n    } else if (response.statusCode == 404) {\r\n      throw Exception(\"Usuario no encontrado (404)\");\r\n    } else if (response.statusCode == 500) {\r\n      throw Exception(\"Error del servidor (500)\");\r\n    } else {\r\n      throw Exception(\"Error ${response.statusCode}: ${response.body}\");\r\n    }\r\n  }\r\n\r\n  static Future<List<dynamic>> listarSolicitudes() async {\r\n    final prefs = await SharedPreferences.getInstance();\r\n    final token = prefs.getString(\"auth_token\");\r\n    final idUser = prefs.getInt(\"user_id\"); // Recuperamos el ID del usuario\r\n\r\n    if (token == null || idUser == null) {\r\n      throw Exception(\"Faltan datos de sesi칩n (token o user_id)\");\r\n    }\r\n\r\n    final url = Uri.parse(\"$_baseUrl/chofer/reservas_solicitudes\");\r\n\r\n    // CAMBIO IMPORTANTE: Ahora es POST y enviamos el body\r\n    final response = await http.post(\r\n      url,\r\n      headers: {\r\n        \"Authorization\": \"Bearer $token\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: jsonEncode({\r\n        \"id_user\": idUser, // Enviamos el ID como pide tu API\r\n      }),\r\n    );\r\n\r\n    if (response.statusCode == 200) {\r\n      final responseBody = jsonDecode(response.body);\r\n\r\n      // CAMBIO DE ESTRUCTURA:\r\n      // Tu API devuelve: { \"success\": true, \"reservas_solicitudes\": { \"data\": [...] } }\r\n      if (responseBody['success'] == true &&\r\n          responseBody['reservas_solicitudes'] != null) {\r\n        // Entramos a 'reservas_solicitudes' y luego a 'data'\r\n        return responseBody['reservas_solicitudes']['data'] ?? [];\r\n      } else {\r\n        return []; // Si no hay 칠xito o datos, retornamos lista vac칤a\r\n      }\r\n    } else {\r\n      throw Exception(\"Error ${response.statusCode}: ${response.body}\");\r\n    }\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/utils/solicitud_service.dart b/lib/utils/solicitud_service.dart
--- a/lib/utils/solicitud_service.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/utils/solicitud_service.dart	(date 1764209290040)
@@ -17,9 +17,7 @@
       throw Exception("Faltan datos de sesi칩n (token o user_id)");
     }
 
-    final url = Uri.parse(
-      "$_baseUrl/reservas/chofer/asignacion/$solicitudChoferId",
-    );
+    final url = Uri.parse("$_baseUrl/reservas/chofer/asignacion/$solicitudChoferId");
 
     final body = jsonEncode({
       "id_user": idUser,
@@ -52,43 +50,4 @@
     }
   }
 
-  static Future<List<dynamic>> listarSolicitudes() async {
-    final prefs = await SharedPreferences.getInstance();
-    final token = prefs.getString("auth_token");
-    final idUser = prefs.getInt("user_id"); // Recuperamos el ID del usuario
-
-    if (token == null || idUser == null) {
-      throw Exception("Faltan datos de sesi칩n (token o user_id)");
-    }
-
-    final url = Uri.parse("$_baseUrl/chofer/reservas_solicitudes");
-
-    // CAMBIO IMPORTANTE: Ahora es POST y enviamos el body
-    final response = await http.post(
-      url,
-      headers: {
-        "Authorization": "Bearer $token",
-        "Content-Type": "application/json",
-      },
-      body: jsonEncode({
-        "id_user": idUser, // Enviamos el ID como pide tu API
-      }),
-    );
-
-    if (response.statusCode == 200) {
-      final responseBody = jsonDecode(response.body);
-
-      // CAMBIO DE ESTRUCTURA:
-      // Tu API devuelve: { "success": true, "reservas_solicitudes": { "data": [...] } }
-      if (responseBody['success'] == true &&
-          responseBody['reservas_solicitudes'] != null) {
-        // Entramos a 'reservas_solicitudes' y luego a 'data'
-        return responseBody['reservas_solicitudes']['data'] ?? [];
-      } else {
-        return []; // Si no hay 칠xito o datos, retornamos lista vac칤a
-      }
-    } else {
-      throw Exception("Error ${response.statusCode}: ${response.body}");
-    }
-  }
 }
Index: lib/Views/Historial/historial_page.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import 'package:flutter/material.dart';\r\n// 丘\uFE0F IMPORTACIONES REQUERIDAS\r\n// Asumiendo que ReservaDetalle est치 en la siguiente ruta (ajusta si es necesario)\r\nimport '../Reservas/reservas_detalle.dart';\r\nimport '../widgets/header.dart';\r\nimport '../widgets/bottom_navigation.dart';\r\n\r\n// =======================================================\r\n// MODELO DE DATOS PARA EL HISTORIAL (Ampliado de ReservaDetalle)\r\n// =======================================================\r\nclass ReservaHistorial {\r\n  final String id;\r\n  final String cliente;\r\n  final String fechaReserva;\r\n  final String horaRecogida;\r\n  final String direccionEncuentro;\r\n  final double costoTotal;\r\n  final int? calificacion;\r\n\r\n  ReservaHistorial({\r\n    required this.id,\r\n    required this.cliente,\r\n    required this.fechaReserva,\r\n    required this.horaRecogida,\r\n    required this.direccionEncuentro,\r\n    required this.costoTotal,\r\n    this.calificacion,\r\n  });\r\n\r\n  factory ReservaHistorial.fromMap(Map<String, dynamic> map) {\r\n    return ReservaHistorial(\r\n      id: map['id']?.toString() ?? 'N/A',\r\n      cliente: map['cliente']?.toString() ?? 'Usuario Desconocido',\r\n      fechaReserva: map['fechaReserva']?.toString() ?? '---',\r\n      horaRecogida: map['horaRecogida']?.toString() ?? '---',\r\n      direccionEncuentro: map['direccionEncuentro']?.toString() ?? '---',\r\n      costoTotal: (map['costoTotal'] as num?)?.toDouble() ?? 0.00,\r\n      calificacion: map['calificacion'] as int?,\r\n    );\r\n  }\r\n}\r\n\r\n// =======================================================\r\n// PANTALLA DE HISTORIAL CON REFRESH\r\n// =======================================================\r\nclass HistorialPage extends StatefulWidget {\r\n  const HistorialPage({super.key});\r\n\r\n  @override\r\n  State<HistorialPage> createState() => _HistorialPageState();\r\n}\r\n\r\nclass _HistorialPageState extends State<HistorialPage> {\r\n  List<ReservaHistorial> _finishedReservations = [];\r\n  bool _isLoading = false;\r\n\r\n  @override\r\n  void initState() {\r\n    super.initState();\r\n    _loadHistorial();\r\n  }\r\n\r\n  // Funci칩n para cargar el historial (simulada con datos de ejemplo)\r\n  Future<void> _loadHistorial() async {\r\n    if (!mounted) return;\r\n    setState(() => _isLoading = true);\r\n\r\n    // Simula una petici칩n a la API\r\n    await Future.delayed(const Duration(seconds: 1));\r\n\r\n    // TODO: Aqu칤 deber칤as llamar a tu API real para obtener el historial\r\n    // Ejemplo: final historial = await SessionManager.fetchHistorialFromApi();\r\n\r\n    if (mounted) {\r\n      setState(() {\r\n        _finishedReservations = [\r\n          ReservaHistorial(\r\n            id: '001',\r\n            cliente: 'Laura V치squez',\r\n            fechaReserva: '2025-09-20',\r\n            horaRecogida: '17:30',\r\n            direccionEncuentro: 'Av. Libertador 456',\r\n            costoTotal: 15.75,\r\n            calificacion: 5,\r\n          ),\r\n          ReservaHistorial(\r\n            id: '002',\r\n            cliente: 'Pedro Torres',\r\n            fechaReserva: '2025-09-18',\r\n            horaRecogida: '10:00',\r\n            direccionEncuentro: 'Jr. Los 츼lamos 301',\r\n            costoTotal: 8.90,\r\n            calificacion: 4,\r\n          ),\r\n          ReservaHistorial(\r\n            id: '003',\r\n            cliente: 'Ana Jim칠nez',\r\n            fechaReserva: '2025-09-17',\r\n            horaRecogida: '21:00',\r\n            direccionEncuentro: 'Plaza Mayor',\r\n            costoTotal: 22.50,\r\n            calificacion: null,\r\n          ),\r\n        ];\r\n        _isLoading = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Scaffold(\r\n      backgroundColor: Colors.grey[100],\r\n      body: Column(\r\n        children: [\r\n          const LogoHeader(titulo: 'Historial', estiloLogin: false),\r\n          Expanded(\r\n            child: _isLoading\r\n                ? const Center(child: CircularProgressIndicator())\r\n                : RefreshIndicator(\r\n                    onRefresh: _loadHistorial,\r\n                    child: _finishedReservations.isEmpty\r\n                        ? ListView(\r\n                            physics: const AlwaysScrollableScrollPhysics(),\r\n                            children: const [\r\n                              SizedBox(height: 100),\r\n                              Center(\r\n                                child: Text(\r\n                                  'No hay viajes finalizados en tu historial.\\n\\nDesliza hacia abajo para actualizar.',\r\n                                  textAlign: TextAlign.center,\r\n                                  style: TextStyle(\r\n                                    fontSize: 16,\r\n                                    color: Colors.grey,\r\n                                  ),\r\n                                ),\r\n                              ),\r\n                            ],\r\n                          )\r\n                        : ListView.builder(\r\n                            physics: const AlwaysScrollableScrollPhysics(),\r\n                            padding: const EdgeInsets.all(16),\r\n                            itemCount: _finishedReservations.length,\r\n                            itemBuilder: (context, index) {\r\n                              final reserva = _finishedReservations[index];\r\n                              return Padding(\r\n                                padding: const EdgeInsets.only(bottom: 16.0),\r\n                                child: HistorialCard(reserva: reserva),\r\n                              );\r\n                            },\r\n                          ),\r\n                  ),\r\n          ),\r\n          const CustomBottomNavBar(),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n}\r\n\r\n// =======================================================\r\n// TARJETA DE HISTORIAL (ACTUALIZADA sin Calificaci칩n)\r\n// =======================================================\r\nclass HistorialCard extends StatelessWidget {\r\n  final ReservaHistorial reserva;\r\n\r\n  const HistorialCard({super.key, required this.reserva});\r\n\r\n  @override\r\n  Widget build(BuildContext context) {\r\n    return Container(\r\n      decoration: BoxDecoration(\r\n        color: Colors.white,\r\n        borderRadius: BorderRadius.circular(12),\r\n        boxShadow: [\r\n          BoxShadow(\r\n            color: Colors.grey.withOpacity(0.3),\r\n            spreadRadius: 1,\r\n            blurRadius: 3,\r\n            offset: const Offset(0, 2),\r\n          ),\r\n        ],\r\n      ),\r\n      child: Column(\r\n        crossAxisAlignment: CrossAxisAlignment.stretch,\r\n        children: [\r\n          // 1. HEADER AMARILLO: ID de Viaje y Costo\r\n          Container(\r\n            padding: const EdgeInsets.symmetric(vertical: 10, horizontal: 16),\r\n            decoration: BoxDecoration(\r\n              color: Colors.amber.shade300,\r\n              borderRadius: const BorderRadius.only(\r\n                topLeft: Radius.circular(12),\r\n                topRight: Radius.circular(12),\r\n              ),\r\n            ),\r\n            child: Row(\r\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\r\n              children: [\r\n                Text(\r\n                  'Viaje Nro: ${reserva.id}',\r\n                  style: const TextStyle(\r\n                    fontWeight: FontWeight.w800,\r\n                    fontSize: 16,\r\n                    color: Colors.black87,\r\n                  ),\r\n                ),\r\n                Text(\r\n                  '\\S/${reserva.costoTotal.toStringAsFixed(2)}',\r\n                  style: const TextStyle(\r\n                    fontWeight: FontWeight.w900,\r\n                    fontSize: 20,\r\n                    color: Color.fromARGB(255, 11, 102, 35),\r\n                  ),\r\n                ),\r\n              ],\r\n            ),\r\n          ),\r\n\r\n          // 2. CUERPO DE DETALLES\r\n          Padding(\r\n            padding: const EdgeInsets.all(16),\r\n            child: Column(\r\n              crossAxisAlignment: CrossAxisAlignment.start,\r\n              children: [\r\n                // Info principal del viaje\r\n                const Text(\r\n                  'Detalles del Viaje',\r\n                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),\r\n                ),\r\n                const SizedBox(height: 6),\r\n                _buildInfoRow('Cliente:', reserva.cliente),\r\n                _buildInfoRow('Fecha:', reserva.fechaReserva),\r\n                _buildInfoRow('Hora:', reserva.horaRecogida),\r\n                _buildInfoRow('Direcci칩n:', reserva.direccionEncuentro),\r\n\r\n                const Divider(height: 24),\r\n\r\n                // Auto asignado (datos fijos de ejemplo)\r\n                const Text(\r\n                  'Auto utilizado',\r\n                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),\r\n                ),\r\n                const SizedBox(height: 6),\r\n                Row(\r\n                  children: [\r\n                    const Icon(\r\n                      Icons.directions_car,\r\n                      size: 40,\r\n                      color: Colors.grey,\r\n                    ),\r\n                    const SizedBox(width: 16),\r\n                    Column(\r\n                      crossAxisAlignment: CrossAxisAlignment.start,\r\n                      children: const [\r\n                        Text('Placa: ABC-123', style: TextStyle(fontSize: 14)),\r\n                        Text('Marca: Mazda', style: TextStyle(fontSize: 14)),\r\n                      ],\r\n                    ),\r\n                  ],\r\n                ),\r\n              ],\r\n            ),\r\n          ),\r\n        ],\r\n      ),\r\n    );\r\n  }\r\n\r\n  Widget _buildInfoRow(String label, String value) {\r\n    return Padding(\r\n      padding: const EdgeInsets.only(bottom: 4),\r\n      child: RichText(\r\n        text: TextSpan(\r\n          style: const TextStyle(fontSize: 14, color: Colors.black87),\r\n          children: [\r\n            TextSpan(\r\n              text: label,\r\n              style: const TextStyle(fontWeight: FontWeight.w600),\r\n            ),\r\n            TextSpan(text: ' $value'),\r\n          ],\r\n        ),\r\n      ),\r\n    );\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/Views/Historial/historial_page.dart b/lib/Views/Historial/historial_page.dart
--- a/lib/Views/Historial/historial_page.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/Views/Historial/historial_page.dart	(date 1764209290088)
@@ -118,37 +118,37 @@
             child: _isLoading
                 ? const Center(child: CircularProgressIndicator())
                 : RefreshIndicator(
-                    onRefresh: _loadHistorial,
-                    child: _finishedReservations.isEmpty
-                        ? ListView(
-                            physics: const AlwaysScrollableScrollPhysics(),
-                            children: const [
-                              SizedBox(height: 100),
-                              Center(
-                                child: Text(
-                                  'No hay viajes finalizados en tu historial.\n\nDesliza hacia abajo para actualizar.',
-                                  textAlign: TextAlign.center,
-                                  style: TextStyle(
-                                    fontSize: 16,
-                                    color: Colors.grey,
-                                  ),
-                                ),
-                              ),
-                            ],
-                          )
-                        : ListView.builder(
-                            physics: const AlwaysScrollableScrollPhysics(),
-                            padding: const EdgeInsets.all(16),
-                            itemCount: _finishedReservations.length,
-                            itemBuilder: (context, index) {
-                              final reserva = _finishedReservations[index];
-                              return Padding(
-                                padding: const EdgeInsets.only(bottom: 16.0),
-                                child: HistorialCard(reserva: reserva),
-                              );
-                            },
-                          ),
-                  ),
+              onRefresh: _loadHistorial,
+              child: _finishedReservations.isEmpty
+                  ? ListView(
+                physics: const AlwaysScrollableScrollPhysics(),
+                children: const [
+                  SizedBox(height: 100),
+                  Center(
+                    child: Text(
+                      'No hay viajes finalizados en tu historial.\n\nDesliza hacia abajo para actualizar.',
+                      textAlign: TextAlign.center,
+                      style: TextStyle(
+                        fontSize: 16,
+                        color: Colors.grey,
+                      ),
+                    ),
+                  ),
+                ],
+              )
+                  : ListView.builder(
+                physics: const AlwaysScrollableScrollPhysics(),
+                padding: const EdgeInsets.all(16),
+                itemCount: _finishedReservations.length,
+                itemBuilder: (context, index) {
+                  final reserva = _finishedReservations[index];
+                  return Padding(
+                    padding: const EdgeInsets.only(bottom: 16.0),
+                    child: HistorialCard(reserva: reserva),
+                  );
+                },
+              ),
+            ),
           ),
           const CustomBottomNavBar(),
         ],
@@ -225,7 +225,10 @@
                 // Info principal del viaje
                 const Text(
                   'Detalles del Viaje',
-                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
+                  style: TextStyle(
+                    fontWeight: FontWeight.bold,
+                    fontSize: 16,
+                  ),
                 ),
                 const SizedBox(height: 6),
                 _buildInfoRow('Cliente:', reserva.cliente),
@@ -238,16 +241,15 @@
                 // Auto asignado (datos fijos de ejemplo)
                 const Text(
                   'Auto utilizado',
-                  style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16),
+                  style: TextStyle(
+                    fontWeight: FontWeight.bold,
+                    fontSize: 16,
+                  ),
                 ),
                 const SizedBox(height: 6),
                 Row(
                   children: [
-                    const Icon(
-                      Icons.directions_car,
-                      size: 40,
-                      color: Colors.grey,
-                    ),
+                    const Icon(Icons.directions_car, size: 40, color: Colors.grey),
                     const SizedBox(width: 16),
                     Column(
                       crossAxisAlignment: CrossAxisAlignment.start,
@@ -283,4 +285,4 @@
       ),
     );
   }
-}
+}
\ No newline at end of file
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_21\" default=\"true\" project-jdk-name=\"jbr-21\" project-jdk-type=\"JavaSDK\" />\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/misc.xml b/.idea/misc.xml
--- a/.idea/misc.xml	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/.idea/misc.xml	(date 1764209298885)
@@ -1,4 +1,3 @@
-<?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="jbr-21" project-jdk-type="JavaSDK" />
 </project>
\ No newline at end of file
Index: lib/utils/reservas_service.dart
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Archivo: 'utils/reservas_service.dart'\r\n\r\nimport 'dart:convert';\r\nimport 'package:http/http.dart' as http;\r\n// Aseg칰rate de que la ruta a SessionManager es correcta\r\nimport 'session_manager.dart';\r\n\r\nclass ReservasService {\r\n  // Constante de la URL base\r\n  static const String BASE_URL = 'http://servidorcorman.dyndns.org:7019/api';\r\n\r\n  // Funci칩n interna para realizar la petici칩n POST con autenticaci칩n\r\n  static Future<Map<String, dynamic>?> _performPost(\r\n    String endpoint, {\r\n    int? reservaId,\r\n  }) async {\r\n    final token = await SessionManager.getToken();\r\n    final idUser = await SessionManager.getUserId();\r\n\r\n    if (token == null || idUser == null) {\r\n      print(\"Error Service: Token o User ID no disponible.\");\r\n      return null;\r\n    }\r\n\r\n    final url = Uri.parse('$BASE_URL/$endpoint');\r\n    final body = {\"id_user\": idUser};\r\n\r\n    try {\r\n      final response = await http.post(\r\n        url,\r\n        headers: {\r\n          'Authorization': 'Bearer $token',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: jsonEncode(body),\r\n      );\r\n\r\n      if (response.statusCode == 200) {\r\n        return jsonDecode(response.body);\r\n      } else {\r\n        print('Error del servidor (${response.statusCode}) en $endpoint.');\r\n        return null;\r\n      }\r\n    } catch (e) {\r\n      print(\"Excepci칩n al cargar $endpoint: $e\");\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // ============================================================\r\n  // 1. OBTENER LA LISTA COMPLETA (Endpoint: /chofer/reservas)\r\n  // ============================================================\r\n  static Future<List<Map<String, dynamic>>> fetchReservasList() async {\r\n    final jsonData = await _performPost('chofer/reservas');\r\n\r\n    if (jsonData != null &&\r\n        jsonData['status'] == 'success' &&\r\n        jsonData['reservas'] != null &&\r\n        jsonData['reservas']['data'] is List) {\r\n      return List<Map<String, dynamic>>.from(jsonData['reservas']['data']);\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // ============================================================\r\n  // 2. OBTENER RESERVAS DEL D칈A (Endpoint: /chofer/reservas_dia)\r\n  // ============================================================\r\n  static Future<List<Map<String, dynamic>>> fetchReservasDia() async {\r\n    final jsonData = await _performPost('chofer/reservas_dia');\r\n\r\n    if (jsonData != null &&\r\n        jsonData['success'] == true &&\r\n        jsonData['reservas_dia'] != null &&\r\n        jsonData['reservas_dia']['data'] is List) {\r\n      return List<Map<String, dynamic>>.from(jsonData['reservas_dia']['data']);\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // ============================================================\r\n  // 3. OBTENER EL DETALLE COMPLETO DE UNA RESERVA POR ID\r\n  //    (Llama a la lista del d칤a y la filtra. Usa el endpoint con la data m치s rica)\r\n  // ============================================================\r\n  static Future<Map<String, dynamic>?> fetchReservaDetalle(\r\n    int reservaId,\r\n  ) async {\r\n    // Usamos el endpoint que parece tener el detalle m치s rico (como reservas_dia)\r\n    final jsonData = await _performPost('chofer/reservas_dia');\r\n\r\n    if (jsonData != null &&\r\n        jsonData['success'] == true &&\r\n        jsonData['reservas_dia'] != null &&\r\n        jsonData['reservas_dia']['data'] is List) {\r\n      final List<Map<String, dynamic>> listaReservas =\r\n          List<Map<String, dynamic>>.from(jsonData['reservas_dia']['data']);\r\n\r\n      // Buscar la reserva por ID\r\n      final Map<String, dynamic>? reservaEncontrada = listaReservas.firstWhere(\r\n        (reserva) => (reserva['id'] as int?) == reservaId,\r\n        orElse: () => {},\r\n      );\r\n\r\n      return reservaEncontrada != null && reservaEncontrada.isNotEmpty\r\n          ? reservaEncontrada\r\n          : null;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/lib/utils/reservas_service.dart b/lib/utils/reservas_service.dart
--- a/lib/utils/reservas_service.dart	(revision c2e52bd85f94757230af82dfa3bea98e542502af)
+++ b/lib/utils/reservas_service.dart	(date 1764258607769)
@@ -1,28 +1,25 @@
-// Archivo: 'utils/reservas_service.dart'
-
 import 'dart:convert';
 import 'package:http/http.dart' as http;
-// Aseg칰rate de que la ruta a SessionManager es correcta
+// Importa SessionManager para obtener Token/ID
 import 'session_manager.dart';
 
 class ReservasService {
   // Constante de la URL base
   static const String BASE_URL = 'http://servidorcorman.dyndns.org:7019/api';
 
-  // Funci칩n interna para realizar la petici칩n POST con autenticaci칩n
-  static Future<Map<String, dynamic>?> _performPost(
-    String endpoint, {
-    int? reservaId,
-  }) async {
+  // --- 1. OBTENER LA LISTA DE RESERVAS ---
+  // Retorna una lista de Map<String, dynamic>
+  static Future<List<Map<String, dynamic>>> fetchReservasList() async {
     final token = await SessionManager.getToken();
     final idUser = await SessionManager.getUserId();
 
     if (token == null || idUser == null) {
       print("Error Service: Token o User ID no disponible.");
-      return null;
+      // Devolvemos una lista vac칤a en lugar de lanzar una excepci칩n para que la app no crashee.
+      return [];
     }
 
-    final url = Uri.parse('$BASE_URL/$endpoint');
+    final url = Uri.parse('$BASE_URL/chofer/reservas');
     final body = {"id_user": idUser};
 
     try {
@@ -36,76 +33,73 @@
       );
 
       if (response.statusCode == 200) {
-        return jsonDecode(response.body);
-      } else {
-        print('Error del servidor (${response.statusCode}) en $endpoint.');
-        return null;
-      }
-    } catch (e) {
-      print("Excepci칩n al cargar $endpoint: $e");
-      return null;
-    }
-  }
+        final jsonData = jsonDecode(response.body);
 
-  // ============================================================
-  // 1. OBTENER LA LISTA COMPLETA (Endpoint: /chofer/reservas)
-  // ============================================================
-  static Future<List<Map<String, dynamic>>> fetchReservasList() async {
-    final jsonData = await _performPost('chofer/reservas');
-
-    if (jsonData != null &&
-        jsonData['status'] == 'success' &&
-        jsonData['reservas'] != null &&
-        jsonData['reservas']['data'] is List) {
-      return List<Map<String, dynamic>>.from(jsonData['reservas']['data']);
-    } else {
-      return [];
-    }
-  }
-
-  // ============================================================
-  // 2. OBTENER RESERVAS DEL D칈A (Endpoint: /chofer/reservas_dia)
-  // ============================================================
-  static Future<List<Map<String, dynamic>>> fetchReservasDia() async {
-    final jsonData = await _performPost('chofer/reservas_dia');
-
-    if (jsonData != null &&
-        jsonData['success'] == true &&
-        jsonData['reservas_dia'] != null &&
-        jsonData['reservas_dia']['data'] is List) {
-      return List<Map<String, dynamic>>.from(jsonData['reservas_dia']['data']);
-    } else {
+        if (jsonData['status'] == 'success' &&
+            jsonData['reservas'] != null &&
+            jsonData['reservas']['data'] is List) {
+          // EXTRACCI칍N CORRECTA: Retorna el array 'data'
+          return List<Map<String, dynamic>>.from(jsonData['reservas']['data']);
+        } else {
+          print('API Error: Formato de datos inesperado o sin 칠xito.');
+          return [];
+        }
+      } else {
+        print('Error del servidor (${response.statusCode}) al cargar lista.');
+        return [];
+      }
+    } catch (e) {
+      print("Excepci칩n al cargar la lista de reservas: $e");
       return [];
     }
   }
 
-  // ============================================================
-  // 3. OBTENER EL DETALLE COMPLETO DE UNA RESERVA POR ID
-  //    (Llama a la lista del d칤a y la filtra. Usa el endpoint con la data m치s rica)
-  // ============================================================
+  // --- 2. OBTENER EL DETALLE COMPLETO DE LA RESERVA ---
+  // Retorna un Map<String, dynamic> con todos los datos del detalle
   static Future<Map<String, dynamic>?> fetchReservaDetalle(
     int reservaId,
   ) async {
-    // Usamos el endpoint que parece tener el detalle m치s rico (como reservas_dia)
-    final jsonData = await _performPost('chofer/reservas_dia');
+    final token = await SessionManager.getToken();
+    final idUser = await SessionManager.getUserId();
+
+    if (token == null || idUser == null) {
+      return null;
+    }
 
-    if (jsonData != null &&
-        jsonData['success'] == true &&
-        jsonData['reservas_dia'] != null &&
-        jsonData['reservas_dia']['data'] is List) {
-      final List<Map<String, dynamic>> listaReservas =
-          List<Map<String, dynamic>>.from(jsonData['reservas_dia']['data']);
+    // URL: /api/reservas_detalle/{id}
+    final url = Uri.parse('$BASE_URL/chofer/reservas_detalle/$reservaId');
 
-      // Buscar la reserva por ID
-      final Map<String, dynamic>? reservaEncontrada = listaReservas.firstWhere(
-        (reserva) => (reserva['id'] as int?) == reservaId,
-        orElse: () => {},
+    try {
+      final response = await http.post(
+        url,
+        headers: {
+          'Content-Type': 'application/json',
+          'Authorization': 'Bearer $token',
+        },
+        body: jsonEncode({"id_user": idUser}),
       );
 
-      return reservaEncontrada != null && reservaEncontrada.isNotEmpty
-          ? reservaEncontrada
-          : null;
-    }
-    return null;
+      if (response.statusCode == 200) {
+        final Map<String, dynamic> responseData = jsonDecode(response.body);
+
+        if (responseData['status'] == 'success' &&
+            responseData['data'] != null) {
+          // Retorna el objeto 'data'
+          return responseData['data'] as Map<String, dynamic>;
+        } else {
+          return null;
+        }
+      } else {
+        print(
+          "Error HTTP ${response.statusCode}: Fallo al cargar el detalle de la reserva $reservaId.",
+        );
+        return null;
+      }
+    } catch (e) {
+      print(
+        "Excepci칩n al realizar la llamada HTTP para detalle de reserva: $e",
+      );
+      return null;
+    }
   }
 }
